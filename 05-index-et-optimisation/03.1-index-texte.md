üîù Retour au [Sommaire](/SOMMAIRE.md)

# 5.3.1 Index Texte (Text)

## Introduction

Un **index texte** (ou **Text Index**) est un type d'index sp√©cialis√© dans MongoDB con√ßu pour effectuer des **recherches full-text** (recherche en texte int√©gral) efficaces sur du contenu textuel. Il permet de rechercher des mots ou des phrases dans des champs contenant du texte de mani√®re similaire aux moteurs de recherche traditionnels.

Les index texte utilisent des techniques avanc√©es de traitement du langage naturel comme le **stemming** (r√©duction des mots √† leur racine), la **tokenisation** (d√©coupage en mots), et l'**√©limination des mots vides** (stop words) pour fournir des r√©sultats de recherche pertinents.

---

## Le Probl√®me : Recherche Textuelle Classique

### Limitation des Recherches Simples

Avec une recherche classique utilisant l'√©galit√© ou les expressions r√©guli√®res, les limitations sont nombreuses :

**Exemple avec √©galit√©** :
```javascript
// Recherche exacte - trouve seulement "MongoDB"
db.articles.find({ title: "MongoDB" })
```

‚ùå Ne trouve pas : "Introduction √† MongoDB", "Guide MongoDB", etc.

**Exemple avec regex** :
```javascript
// Recherche avec regex
db.articles.find({ title: { $regex: /mongodb/i } })
```

‚ùå **Probl√®mes** :
- Ne peut pas utiliser efficacement les index
- Tr√®s lent sur grandes collections
- Ne g√®re pas le stemming (singulier/pluriel, conjugaisons)
- Ne classe pas par pertinence
- Sensible √† la casse (sauf avec options)

### Besoin d'une Recherche Full-Text

Dans de nombreux cas d'usage (blogs, e-commerce, documentation, etc.), nous avons besoin de :

- ‚úÖ Rechercher des **mots-cl√©s** dans du texte
- ‚úÖ G√©rer les **variations linguistiques** (pluriel, conjugaisons)
- ‚úÖ Ignorer les **mots vides** ("le", "la", "de", "√†", etc.)
- ‚úÖ Classer les r√©sultats par **pertinence**
- ‚úÖ Performances **rapides** m√™me sur grandes collections

**Solution** : Les **index texte** de MongoDB ! üéØ

---

## Qu'est-ce qu'un Index Texte ?

### Fonctionnement

Un index texte effectue plusieurs op√©rations de traitement du texte :

1. **Tokenisation** : D√©coupe le texte en mots individuels
2. **Normalisation** : Conversion en minuscules
3. **Stemming** : R√©duction des mots √† leur racine
4. **Stop Words** : √âlimination des mots courants sans signification
5. **Indexation** : Cr√©ation d'un index invers√© pour recherche rapide

**Exemple de traitement** :

```
Texte original :
"Les d√©veloppeurs utilisent MongoDB pour cr√©er des applications"

Apr√®s traitement :
- Tokenisation : ["Les", "d√©veloppeurs", "utilisent", "MongoDB", "pour", "cr√©er", "des", "applications"]
- Normalisation : ["les", "d√©veloppeurs", "utilisent", "mongodb", "pour", "cr√©er", "des", "applications"]
- Stop words : ["d√©veloppeurs", "utilisent", "mongodb", "cr√©er", "applications"]
- Stemming : ["d√©velopp", "utilis", "mongodb", "cr√©", "applic"]

Index cr√©√© sur ces termes racines
```

### Index Invers√©

MongoDB cr√©e un **index invers√©** qui mappe chaque terme aux documents qui le contiennent :

```
Index Invers√©
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Terme       ‚Üí Documents        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ "mongodb"   ‚Üí Doc #1, #5, #12  ‚îÇ
‚îÇ "d√©velopp"  ‚Üí Doc #1, #3, #8   ‚îÇ
‚îÇ "applic"    ‚Üí Doc #1, #2, #9   ‚îÇ
‚îÇ ...                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## Syntaxe de Cr√©ation

### Index Texte Simple

```javascript
db.collection.createIndex({ champ: "text" })
```

**Exemple** :
```javascript
// Index texte sur le champ "description"
db.articles.createIndex({ description: "text" })
```

### Index Texte sur Plusieurs Champs

```javascript
db.collection.createIndex({
  champ1: "text",
  champ2: "text",
  champ3: "text"
})
```

**Exemple** :
```javascript
// Index texte sur titre, description et contenu
db.articles.createIndex({
  title: "text",
  description: "text",
  content: "text"
})
```

### Index Texte Wildcard (Tous les Champs)

```javascript
db.collection.createIndex({ "$**": "text" })
```

**Exemple** :
```javascript
// Index texte sur TOUS les champs textuels du document
db.articles.createIndex({ "$**": "text" })
```

‚ö†Ô∏è **Attention** : Un seul index texte par collection maximum !

---

## Limitation Importante : Un Seul Index Texte

### R√®gle Stricte

MongoDB autorise **un seul index texte par collection**.

**Permis** ‚úÖ :
```javascript
// Un seul index texte couvrant plusieurs champs
db.articles.createIndex({
  title: "text",
  content: "text",
  tags: "text"
})
```

**Interdit** ‚ùå :
```javascript
// Premier index texte
db.articles.createIndex({ title: "text" })

// Tentative de cr√©er un second index texte
db.articles.createIndex({ description: "text" })
// ERREUR : only one text index per collection allowed
```

### Solution : Combiner les Champs

Si vous devez indexer plusieurs champs, incluez-les tous dans le m√™me index texte :

```javascript
db.articles.createIndex({
  title: "text",
  subtitle: "text",
  description: "text",
  content: "text",
  author: "text",
  tags: "text"
})
```

---

## Recherche avec $text

### Syntaxe de Base

```javascript
db.collection.find({ $text: { $search: "terme recherch√©" } })
```

### Exemples de Recherche

#### Exemple 1 : Recherche Simple

```javascript
// Documents
{
  _id: 1,
  title: "Introduction √† MongoDB",
  content: "MongoDB est une base de donn√©es NoSQL..."
}
{
  _id: 2,
  title: "Guide MongoDB Avanc√©",
  content: "Techniques avanc√©es pour MongoDB..."
}

// Index texte
db.articles.createIndex({ title: "text", content: "text" })

// Recherche
db.articles.find({ $text: { $search: "MongoDB" } })
```

**R√©sultat** : Trouve les documents #1 et #2

#### Exemple 2 : Recherche Multi-Mots

```javascript
// Recherche avec plusieurs mots (op√©rateur OU par d√©faut)
db.articles.find({ $text: { $search: "MongoDB database" } })
```

**Trouve** : Documents contenant "MongoDB" **OU** "database"

#### Exemple 3 : Recherche de Phrase Exacte

```javascript
// Recherche de phrase exacte avec guillemets
db.articles.find({ $text: { $search: "\"base de donn√©es\"" } })
```

**Trouve** : Documents contenant exactement "base de donn√©es"

#### Exemple 4 : Exclusion de Termes

```javascript
// Recherche avec exclusion (op√©rateur -)
db.articles.find({ $text: { $search: "MongoDB -SQL" } })
```

**Trouve** : Documents contenant "MongoDB" mais **PAS** "SQL"

#### Exemple 5 : Combinaison Complexe

```javascript
// Combinaison de techniques
db.articles.find({
  $text: {
    $search: "\"MongoDB Atlas\" cloud -deprecated"
  }
})
```

**Trouve** : Documents contenant la phrase "MongoDB Atlas" ET le mot "cloud", mais PAS "deprecated"

---

## Op√©rateurs de Recherche Texte

### Tableau R√©capitulatif

| Op√©rateur | Syntaxe | Description | Exemple |
|-----------|---------|-------------|---------|
| **OU logique** | `terme1 terme2` | Documents contenant terme1 OU terme2 | `"MongoDB database"` |
| **Phrase exacte** | `"phrase"` | Documents contenant la phrase exacte | `"\"NoSQL database\""` |
| **Exclusion** | `-terme` | Exclut les documents contenant le terme | `"MongoDB -SQL"` |
| **Combinaison** | M√©lange | Combine plusieurs op√©rateurs | `"\"MongoDB Atlas\" -deprecated"` |

### Exemples Pratiques

```javascript
// OU : MongoDB OU database OU NoSQL
db.articles.find({ $text: { $search: "MongoDB database NoSQL" } })

// Phrase exacte : "NoSQL database"
db.articles.find({ $text: { $search: "\"NoSQL database\"" } })

// Exclusion : MongoDB mais PAS SQL
db.articles.find({ $text: { $search: "MongoDB -SQL" } })

// Combinaison : "MongoDB Atlas" ET cloud, mais PAS deprecated
db.articles.find({ $text: { $search: "\"MongoDB Atlas\" cloud -deprecated" } })
```

---

## Score de Pertinence

### Concept

MongoDB calcule un **score de pertinence** pour chaque document trouv√©, indiquant √† quel point le document correspond √† la recherche.

**Facteurs influen√ßant le score** :
- Fr√©quence du terme dans le document
- Raret√© du terme dans la collection
- Longueur du document
- Poids des champs (weights)

### Obtenir le Score

Utilisez le m√©tachamp `$meta: "textScore"` :

```javascript
db.articles.find(
  { $text: { $search: "MongoDB" } },
  { score: { $meta: "textScore" } }
)
```

**R√©sultat** :
```json
[
  {
    "_id": 1,
    "title": "Introduction √† MongoDB",
    "content": "MongoDB est une base de donn√©es...",
    "score": 1.5
  },
  {
    "_id": 2,
    "title": "Guide Complet",
    "content": "Ce guide couvre MongoDB en d√©tail...",
    "score": 0.75
  }
]
```

### Trier par Pertinence

Triez les r√©sultats par score d√©croissant :

```javascript
db.articles.find(
  { $text: { $search: "MongoDB database" } },
  { score: { $meta: "textScore" } }
).sort({ score: { $meta: "textScore" } })
```

Les documents les plus pertinents apparaissent en premier ! üéØ

---

## Poids des Champs (Weights)

### Concept

Les **poids** (weights) permettent de donner plus ou moins d'importance √† certains champs dans le calcul du score de pertinence.

**Par d√©faut** : Tous les champs ont un poids de **1**.

### Syntaxe

```javascript
db.collection.createIndex(
  { champ1: "text", champ2: "text" },
  { weights: { champ1: poids1, champ2: poids2 } }
)
```

### Exemple Pratique

```javascript
// Le titre est 3x plus important que le contenu
db.articles.createIndex(
  {
    title: "text",
    content: "text"
  },
  {
    weights: {
      title: 3,      // Poids 3
      content: 1     // Poids 1 (d√©faut)
    }
  }
)
```

**Impact** :
- Un mot dans le **titre** compte **3 fois plus** qu'un mot dans le **contenu**
- Documents avec le terme dans le titre ont un score plus √©lev√©

### Exemple Complet avec Poids

```javascript
// Index avec poids diff√©rents
db.products.createIndex(
  {
    name: "text",           // Nom du produit
    description: "text",    // Description
    tags: "text",           // Tags
    reviews: "text"         // Avis clients
  },
  {
    weights: {
      name: 10,        // Nom tr√®s important
      tags: 5,         // Tags importants
      description: 3,  // Description moyennement importante
      reviews: 1       // Avis moins importants
    }
  }
)

// Recherche
db.products.find(
  { $text: { $search: "laptop" } },
  { score: { $meta: "textScore" } }
).sort({ score: { $meta: "textScore" } })
```

Un produit avec "laptop" dans le **nom** aura un score 10x sup√©rieur √† un produit avec "laptop" seulement dans les **avis**.

---

## Gestion des Langues

### Langues Support√©es

MongoDB supporte plus de 15 langues pour le stemming et les stop words :

- **Fran√ßais** : `french`
- **Anglais** : `english` (d√©faut)
- **Espagnol** : `spanish`
- **Allemand** : `german`
- **Italien** : `italian`
- **Portugais** : `portuguese`
- Et bien d'autres...

### D√©finir la Langue par D√©faut

```javascript
db.collection.createIndex(
  { champ: "text" },
  { default_language: "french" }
)
```

**Exemple** :
```javascript
// Index texte en fran√ßais
db.articles.createIndex(
  { title: "text", content: "text" },
  { default_language: "french" }
)
```

### Langue par Document

Vous pouvez stocker la langue dans un champ du document :

```javascript
// Documents avec langues diff√©rentes
{
  _id: 1,
  language: "french",
  title: "Introduction √† MongoDB",
  content: "MongoDB est une base de donn√©es..."
}
{
  _id: 2,
  language: "english",
  title: "Introduction to MongoDB",
  content: "MongoDB is a NoSQL database..."
}

// Index texte avec champ de langue
db.articles.createIndex(
  { title: "text", content: "text" },
  { language_override: "language" }
)
```

MongoDB applique automatiquement les r√®gles linguistiques appropri√©es pour chaque document !

### D√©sactiver le Stemming

Pour d√©sactiver compl√®tement le stemming (utile pour du code, des noms propres, etc.) :

```javascript
db.collection.createIndex(
  { champ: "text" },
  { default_language: "none" }
)
```

---

## Combinaison avec d'Autres Filtres

### Index Texte + Autres Crit√®res

Vous pouvez combiner une recherche texte avec d'autres filtres classiques :

```javascript
db.articles.find({
  $text: { $search: "MongoDB" },
  status: "published",
  category: "Database",
  publishedAt: { $gte: ISODate("2024-01-01") }
})
```

### Index Compos√© avec Index Texte

Pour optimiser les requ√™tes combin√©es, cr√©ez un index compos√© :

```javascript
// Index compos√© : champs classiques + champ texte
db.articles.createIndex({
  status: 1,
  category: 1,
  title: "text",
  content: "text"
})
```

**Requ√™te optimis√©e** :
```javascript
db.articles.find({
  status: "published",
  category: "Database",
  $text: { $search: "MongoDB" }
})
```

‚ö†Ô∏è **Note** : Dans un index compos√© avec texte, les champs texte doivent √™tre en **dernier**.

---

## Cas d'Usage Courants

### 1. Blog ou Site de Contenu

**Contexte** : Moteur de recherche pour articles

```javascript
// Collection articles
{
  _id: 1,
  title: "Introduction √† MongoDB",
  subtitle: "D√©marrer avec MongoDB",
  content: "MongoDB est une base de donn√©es NoSQL...",
  author: "Jean Dupont",
  tags: ["database", "mongodb", "nosql"],
  publishedAt: ISODate("2024-01-15")
}

// Index texte
db.articles.createIndex(
  {
    title: "text",
    subtitle: "text",
    content: "text",
    tags: "text"
  },
  {
    weights: {
      title: 10,
      subtitle: 5,
      tags: 3,
      content: 1
    },
    default_language: "french"
  }
)

// Recherche d'articles
db.articles.find(
  { $text: { $search: "MongoDB NoSQL" } },
  { score: { $meta: "textScore" } }
).sort({ score: { $meta: "textScore" } }).limit(10)
```

### 2. E-commerce : Recherche de Produits

**Contexte** : Moteur de recherche produits

```javascript
// Collection products
{
  _id: 101,
  name: "Laptop Dell XPS 15",
  brand: "Dell",
  category: "Electronics",
  description: "Powerful laptop with Intel Core i7, 16GB RAM...",
  features: ["Intel i7", "16GB RAM", "512GB SSD"],
  reviews: ["Great laptop!", "Very fast"]
}

// Index texte
db.products.createIndex(
  {
    name: "text",
    brand: "text",
    description: "text",
    features: "text",
    reviews: "text"
  },
  {
    weights: {
      name: 10,
      brand: 8,
      features: 5,
      description: 2,
      reviews: 1
    }
  }
)

// Recherche avec filtres
db.products.find({
  $text: { $search: "laptop i7 16GB" },
  category: "Electronics",
  price: { $lte: 2000 }
}, {
  score: { $meta: "textScore" }
}).sort({ score: { $meta: "textScore" } })
```

### 3. Base de Connaissances / FAQ

**Contexte** : Recherche dans une documentation

```javascript
// Collection knowledge_base
{
  _id: 1,
  question: "Comment cr√©er un index dans MongoDB ?",
  answer: "Pour cr√©er un index, utilisez la commande createIndex()...",
  keywords: ["index", "performance", "optimisation"],
  category: "Performance"
}

// Index texte
db.knowledge_base.createIndex(
  {
    question: "text",
    answer: "text",
    keywords: "text"
  },
  {
    weights: {
      question: 10,
      keywords: 5,
      answer: 1
    },
    default_language: "french"
  }
)

// Recherche de documentation
db.knowledge_base.find(
  { $text: { $search: "cr√©er index" } },
  { score: { $meta: "textScore" } }
).sort({ score: { $meta: "textScore" } })
```

### 4. Syst√®me de Tickets / Support

**Contexte** : Recherche dans les tickets de support

```javascript
// Collection tickets
{
  _id: 1001,
  subject: "Probl√®me de connexion √† la base",
  description: "Impossible de se connecter √† MongoDB...",
  status: "open",
  priority: "high",
  tags: ["connexion", "erreur", "database"]
}

// Index texte avec index compos√©
db.tickets.createIndex({
  status: 1,
  priority: 1,
  subject: "text",
  description: "text",
  tags: "text"
})

// Recherche de tickets ouverts
db.tickets.find({
  status: "open",
  $text: { $search: "connexion MongoDB" }
}, {
  score: { $meta: "textScore" }
}).sort({ score: { $meta: "textScore" } })
```

### 5. R√©seau Social / Forum

**Contexte** : Recherche de posts

```javascript
// Collection posts
{
  _id: 1,
  author: "alice",
  title: "Question sur MongoDB",
  content: "Comment optimiser les performances...",
  tags: ["mongodb", "performance", "question"],
  comments: [
    { text: "Tu devrais cr√©er des index..." },
    { text: "Regarde la documentation sur les index..." }
  ]
}

// Index texte incluant les commentaires
db.posts.createIndex(
  {
    title: "text",
    content: "text",
    tags: "text",
    "comments.text": "text"
  },
  {
    weights: {
      title: 10,
      tags: 5,
      content: 3,
      "comments.text": 1
    }
  }
)
```

---

## Performance et Optimisation

### Avantages des Index Texte

‚úÖ **Recherche rapide**
- Utilise un index invers√© optimis√©
- Performances constantes m√™me sur grandes collections

‚úÖ **Traitement linguistique**
- Stemming automatique
- Gestion des stop words
- Support multilingue

‚úÖ **Pertinence**
- Score de pertinence automatique
- Tri par pertinence facile

‚úÖ **Flexibilit√©**
- Recherche multi-mots
- Phrases exactes
- Exclusions

### Limitations et Consid√©rations

‚ùå **Un seul index texte par collection**
```javascript
// Si vous avez besoin de plusieurs configurations,
// cr√©ez un seul index incluant tous les champs
```

‚ùå **Taille de l'index**
```
Index texte g√©n√©ralement plus volumineux qu'un index simple
- Chaque mot unique cr√©e une entr√©e
- Texte long = index volumineux
```

‚ùå **Impact sur les √©critures**
```
Insertion/mise √† jour plus lente :
- Tokenisation
- Stemming
- Mise √† jour de l'index invers√©
```

‚ùå **Pas de tri par autres champs**
```javascript
// ‚ùå Impossible de trier par un autre champ ET par score
db.articles.find(
  { $text: { $search: "MongoDB" } }
).sort({ publishedAt: -1, score: { $meta: "textScore" } })
// Seul le premier tri est pris en compte
```

‚ùå **Pas d'expressions r√©guli√®res**
```javascript
// L'index texte ne supporte pas les regex
// Utilisez des termes de recherche simples
```

---

## Comparaison : Index Texte vs Regex vs Atlas Search

### Tableau Comparatif

| Crit√®re | Regex ($regex) | Index Texte | Atlas Search |
|---------|----------------|-------------|--------------|
| **Performance** | ‚ùå Lent | ‚úÖ Rapide | ‚úÖ Tr√®s rapide |
| **Utilise index** | ‚ö†Ô∏è Limit√© | ‚úÖ Oui | ‚úÖ Oui |
| **Stemming** | ‚ùå Non | ‚úÖ Oui | ‚úÖ Oui avanc√© |
| **Score pertinence** | ‚ùå Non | ‚úÖ Oui | ‚úÖ Oui avanc√© |
| **Multilingue** | ‚ùå Non | ‚úÖ Basique | ‚úÖ Avanc√© |
| **Fuzzy search** | ‚ùå Non | ‚ùå Non | ‚úÖ Oui |
| **Synonymes** | ‚ùå Non | ‚ùå Non | ‚úÖ Oui |
| **Facilit√©** | ‚≠ê‚≠ê Moyenne | ‚≠ê‚≠ê‚≠ê Facile | ‚≠ê‚≠ê Moyenne |
| **Disponibilit√©** | ‚úÖ Partout | ‚úÖ Partout | ‚ö†Ô∏è Atlas uniquement |

### Quand Utiliser Chacun ?

**Regex ($regex)** - Pour des recherches simples occasionnelles :
```javascript
// Recherche commen√ßant par "MongoDB"
db.articles.find({ title: { $regex: /^MongoDB/i } })
```
- ‚úÖ Cas d'usage : Validation, patterns simples, recherches rares
- ‚ùå √âviter pour : Recherche full-text, grandes collections

**Index Texte** - Pour recherche full-text standard :
```javascript
// Recherche de mots-cl√©s
db.articles.find({ $text: { $search: "MongoDB database" } })
```
- ‚úÖ Cas d'usage : Blogs, e-commerce, FAQ, documentation
- ‚ùå √âviter pour : Recherche ultra-avanc√©e, besoins sp√©cifiques

**Atlas Search** - Pour recherche avanc√©e :
```javascript
// Recherche floue avec synonymes
db.articles.aggregate([{
  $search: {
    text: {
      query: "databse",  // Typo
      path: "content",
      fuzzy: { maxEdits: 2 }
    }
  }
}])
```
- ‚úÖ Cas d'usage : Moteur de recherche complexe, typos, synonymes
- ‚ùå Limitation : Disponible uniquement sur MongoDB Atlas

---

## Analyse et V√©rification

### V√©rifier l'Index Texte

```javascript
db.collection.getIndexes()
```

**R√©sultat** :
```json
[
  {
    "v": 2,
    "key": {
      "_fts": "text",
      "_ftsx": 1
    },
    "name": "title_text_content_text",
    "weights": {
      "content": 1,
      "title": 10
    },
    "default_language": "french",
    "language_override": "language",
    "textIndexVersion": 3
  }
]
```

### Analyser une Requ√™te Texte

```javascript
db.articles.find(
  { $text: { $search: "MongoDB" } }
).explain("executionStats")
```

**Points cl√©s** :
```javascript
{
  "winningPlan": {
    "stage": "TEXT",  // ‚úÖ Utilise l'index texte
    "indexName": "title_text_content_text"
  },
  "executionStats": {
    "totalDocsExamined": 15,
    "executionTimeMillis": 5
  }
}
```

---

## Bonnes Pratiques

### ‚úÖ √Ä Faire

1. **D√©finir des poids appropri√©s**
   ```javascript
   // Titre plus important que contenu
   db.articles.createIndex(
     { title: "text", content: "text" },
     { weights: { title: 10, content: 1 } }
   )
   ```

2. **Sp√©cifier la langue correcte**
   ```javascript
   // Pour contenu fran√ßais
   db.articles.createIndex(
     { content: "text" },
     { default_language: "french" }
   )
   ```

3. **Combiner avec d'autres filtres**
   ```javascript
   // Filtres classiques + recherche texte
   db.articles.find({
     status: "published",
     $text: { $search: "MongoDB" }
   })
   ```

4. **Utiliser le score pour le tri**
   ```javascript
   // Trier par pertinence
   db.articles.find(
     { $text: { $search: "MongoDB" } },
     { score: { $meta: "textScore" } }
   ).sort({ score: { $meta: "textScore" } })
   ```

5. **Nommer explicitement l'index**
   ```javascript
   db.articles.createIndex(
     { title: "text", content: "text" },
     { name: "idx_text_search" }
   )
   ```

6. **Documenter l'index**
   ```javascript
   // Commenter dans votre code
   // Index texte pour recherche d'articles
   // Champs : title (poids 10), content (poids 1)
   // Langue : fran√ßais
   db.articles.createIndex(...)
   ```

### ‚ùå √Ä √âviter

1. **Ne pas cr√©er plusieurs index texte**
   ```javascript
   // ‚ùå ERREUR - Un seul index texte autoris√©
   db.articles.createIndex({ title: "text" })
   db.articles.createIndex({ content: "text" })
   ```

2. **Ne pas utiliser pour recherches exactes**
   ```javascript
   // ‚ùå Mauvais usage
   db.users.find({ $text: { $search: email } })

   // ‚úÖ Utilisez l'√©galit√©
   db.users.find({ email: email })
   ```

3. **Ne pas oublier le stemming**
   ```javascript
   // Recherche "d√©veloppeur" trouve aussi "d√©veloppeurs", "d√©veloppement"
   // Si ce n'est pas d√©sir√©, utilisez language: "none"
   ```

4. **Ne pas indexer des champs non pertinents**
   ```javascript
   // ‚ùå Inutile d'indexer des IDs ou dates en texte
   db.articles.createIndex({
     _id: "text",  // ‚ùå Non pertinent
     createdAt: "text"  // ‚ùå Non pertinent
   })
   ```

5. **Ne pas utiliser pour textes tr√®s courts**
   ```javascript
   // Pour des codes, IDs, usernames courts
   // Un index simple est plus appropri√©
   db.users.createIndex({ username: 1 })  // ‚úÖ
   // Plut√¥t que
   db.users.createIndex({ username: "text" })  // ‚ùå
   ```

---

## Migration et Gestion

### Supprimer un Index Texte

```javascript
// Par nom
db.articles.dropIndex("title_text_content_text")

// Supprimer tous les index sauf _id
db.articles.dropIndexes()
```

### Modifier un Index Texte

Pour modifier un index texte (changer les poids, la langue, etc.), vous devez :

1. **Supprimer l'ancien index**
```javascript
db.articles.dropIndex("title_text_content_text")
```

2. **Cr√©er le nouvel index**
```javascript
db.articles.createIndex(
  { title: "text", content: "text" },
  {
    weights: { title: 15, content: 1 },  // Nouveau poids
    default_language: "english"  // Nouvelle langue
  }
)
```

‚ö†Ô∏è **Attention** : Pendant la recr√©ation, les recherches texte ne fonctionneront pas !

---

## Alternatives et √âvolutions

### Pour Recherches Plus Avanc√©es

Si les index texte de MongoDB ne suffisent pas, consid√©rez :

1. **MongoDB Atlas Search** (recommand√©)
   - Bas√© sur Lucene
   - Fuzzy search, synonymes, typos
   - Autocomplete
   - Disponible sur Atlas

2. **Elasticsearch**
   - Moteur de recherche d√©di√©
   - Tr√®s puissant
   - Infrastructure s√©par√©e

3. **Solutions hybrides**
   - MongoDB pour les donn√©es
   - Atlas Search ou Elasticsearch pour la recherche
   - Synchronisation via Change Streams

---

## Conclusion

Les **index texte** sont un outil puissant pour impl√©menter la recherche full-text dans MongoDB. Ils offrent un bon √©quilibre entre facilit√© d'utilisation et fonctionnalit√©s, avec le traitement linguistique int√©gr√© et le scoring de pertinence.

### Points Cl√©s √† Retenir

- ‚úÖ Un seul index texte par collection
- ‚úÖ Syntaxe : `db.collection.createIndex({ champ: "text" })`
- ‚úÖ Recherche : `db.collection.find({ $text: { $search: "..." } })`
- ‚úÖ Stemming et stop words automatiques
- ‚úÖ Score de pertinence avec `$meta: "textScore"`
- ‚úÖ Poids des champs pour ajuster l'importance
- ‚úÖ Support multilingue int√©gr√©
- ‚úÖ Combine avec filtres classiques
- ‚úÖ Adapt√© pour blogs, e-commerce, FAQ, documentation

### Quand Utiliser les Index Texte

‚úÖ **Utilisez-les pour** :
- Recherche de mots-cl√©s dans du contenu
- Blogs, sites de contenu
- E-commerce (recherche produits)
- Documentation, FAQ
- Syst√®mes de tickets

‚ùå **Ne les utilisez pas pour** :
- Recherches exactes (utilisez index simple)
- Champs courts (IDs, usernames)
- Besoin de fuzzy search avanc√© (‚Üí Atlas Search)
- Recherches avec typos complexes

### Prochaines √âtapes

Maintenant que vous ma√Ætrisez les index texte, explorez :
- **[Index g√©ospatial](./03.2-index-geospatial.md)** : Requ√™tes g√©ographiques
- **[Atlas Search](/16-fonctionnalites-avancees/08-atlas-search-lucene.md)** : Recherche avanc√©e avec Lucene
- **[Index TTL](./03.5-index-ttl.md)** : Expiration automatique des documents
- **[Strat√©gies d'optimisation](./08-strategies-optimisation.md)** : Techniques avanc√©es

---

**üìö Ressources Compl√©mentaires**
- [Documentation officielle - Text Indexes](https://docs.mongodb.com/manual/core/index-text/)
- [Text Search Operators](https://docs.mongodb.com/manual/reference/operator/query/text/)
- [Text Index Properties](https://docs.mongodb.com/manual/reference/text-search-languages/)
- [Atlas Search Documentation](https://docs.atlas.mongodb.com/atlas-search/)

‚è≠Ô∏è [Index g√©ospatial (2d, 2dsphere)](/05-index-et-optimisation/03.2-index-geospatial.md)
