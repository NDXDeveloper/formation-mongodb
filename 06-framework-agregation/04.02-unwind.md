üîù Retour au [Sommaire](/SOMMAIRE.md)

# 6.4.2 $unwind

## Introduction

L'√©tape `$unwind` est une op√©ration fondamentale du framework d'agr√©gation MongoDB qui permet de **"d√©plier"** ou **"d√©rouler"** un champ de type tableau. Elle transforme un document contenant un tableau en **plusieurs documents**, un pour chaque √©l√©ment du tableau.

### Analogie Simple

Imaginez un carton contenant plusieurs livres. `$unwind` c'est comme **sortir chaque livre du carton** et cr√©er une bo√Æte individuelle pour chacun. Au lieu d'avoir un carton avec 3 livres, vous aurez 3 bo√Ætes avec 1 livre chacune.

---

## Pourquoi Utiliser $unwind ?

MongoDB stocke souvent des donn√©es sous forme de **tableaux imbriqu√©s** dans les documents. `$unwind` est essentiel pour :

1. **Analyser les √©l√©ments individuels** d'un tableau
2. **Effectuer des calculs** sur chaque √©l√©ment s√©par√©ment
3. **Combiner avec $group** pour des agr√©gations complexes
4. **Aplatir les r√©sultats de $lookup** (jointures)
5. **Filtrer ou trier** par des valeurs dans un tableau

---

## Syntaxe

### Forme Simple

```javascript
{
  $unwind: "$nom_du_champ_tableau"
}
```

### Forme Compl√®te avec Options

```javascript
{
  $unwind: {
    path: "$nom_du_champ_tableau",
    includeArrayIndex: "<nom_du_champ_index>",
    preserveNullAndEmptyArrays: <boolean>
  }
}
```

#### Param√®tres

| Param√®tre | Type | Description |
|-----------|------|-------------|
| `path` | String | Chemin du champ tableau √† d√©plier (obligatoire) |
| `includeArrayIndex` | String | Nom du nouveau champ qui contiendra l'index de l'√©l√©ment dans le tableau d'origine |
| `preserveNullAndEmptyArrays` | Boolean | Si `true`, conserve les documents m√™me si le tableau est vide ou inexistant |

---

## Concept de Base : Comment $unwind Fonctionne

### Exemple Visuel

**Document Original** :
```json
{
  "_id": 1,
  "nom": "Jean",
  "hobbies": ["lecture", "sport", "musique"]
}
```

**Apr√®s $unwind sur "hobbies"** :
```json
// Document 1
{
  "_id": 1,
  "nom": "Jean",
  "hobbies": "lecture"
}

// Document 2
{
  "_id": 1,
  "nom": "Jean",
  "hobbies": "sport"
}

// Document 3
{
  "_id": 1,
  "nom": "Jean",
  "hobbies": "musique"
}
```

### Observation Importante

- **1 document avec 3 √©l√©ments** ‚Üí **3 documents avec 1 √©l√©ment chacun**
- Le champ `hobbies` n'est **plus un tableau** mais une **valeur simple**
- Les autres champs (`_id`, `nom`) sont **dupliqu√©s** dans chaque document r√©sultant

---

## Exemple Pratique D√©taill√©

### Pr√©paration des Donn√©es

Cr√©ons une collection d'articles de blog avec des tags :

```javascript
db.articles.insertMany([
  {
    _id: 1,
    titre: "Introduction √† MongoDB",
    auteur: "Alice",
    tags: ["mongodb", "nosql", "base-de-donnees"]
  },
  {
    _id: 2,
    titre: "JavaScript Moderne",
    auteur: "Bob",
    tags: ["javascript", "web", "frontend"]
  },
  {
    _id: 3,
    titre: "Python pour D√©butants",
    auteur: "Charlie",
    tags: ["python", "programmation"]
  },
  {
    _id: 4,
    titre: "Article sans tags",
    auteur: "Diana",
    tags: []  // Tableau vide
  },
  {
    _id: 5,
    titre: "Article sans champ tags",
    auteur: "Eve"
    // Pas de champ "tags"
  }
])
```

### Application de $unwind (Forme Simple)

```javascript
db.articles.aggregate([
  {
    $unwind: "$tags"
  }
])
```

### R√©sultat

```json
[
  {
    "_id": 1,
    "titre": "Introduction √† MongoDB",
    "auteur": "Alice",
    "tags": "mongodb"
  },
  {
    "_id": 1,
    "titre": "Introduction √† MongoDB",
    "auteur": "Alice",
    "tags": "nosql"
  },
  {
    "_id": 1,
    "titre": "Introduction √† MongoDB",
    "auteur": "Alice",
    "tags": "base-de-donnees"
  },
  {
    "_id": 2,
    "titre": "JavaScript Moderne",
    "auteur": "Bob",
    "tags": "javascript"
  },
  {
    "_id": 2,
    "titre": "JavaScript Moderne",
    "auteur": "Bob",
    "tags": "web"
  },
  {
    "_id": 2,
    "titre": "JavaScript Moderne",
    "auteur": "Bob",
    "tags": "frontend"
  },
  {
    "_id": 3,
    "titre": "Python pour D√©butants",
    "auteur": "Charlie",
    "tags": "python"
  },
  {
    "_id": 3,
    "titre": "Python pour D√©butants",
    "auteur": "Charlie",
    "tags": "programmation"
  }
  // NOTEZ : Les documents 4 et 5 sont ABSENTS
]
```

### ‚ö†Ô∏è Comportement par D√©faut

Les documents avec **tableaux vides** (document 4) ou **champs manquants** (document 5) sont **exclus** du r√©sultat par d√©faut.

---

## Option : preserveNullAndEmptyArrays

Pour **conserver** les documents avec tableaux vides ou champs manquants :

```javascript
db.articles.aggregate([
  {
    $unwind: {
      path: "$tags",
      preserveNullAndEmptyArrays: true
    }
  }
])
```

### R√©sultat Complet

```json
[
  // ... tous les documents pr√©c√©dents ...
  {
    "_id": 4,
    "titre": "Article sans tags",
    "auteur": "Diana",
    "tags": null  // Tableau vide ‚Üí null
  },
  {
    "_id": 5,
    "titre": "Article sans champ tags",
    "auteur": "Eve"
    // Champ "tags" absent
  }
]
```

### Quand Utiliser Cette Option ?

‚úÖ **Utilisez `preserveNullAndEmptyArrays: true`** quand :
- Vous voulez un **LEFT JOIN** (√©quivalent SQL)
- Vous devez conserver **tous les documents** m√™me sans tableau
- Vous effectuez des statistiques globales

‚ùå **N'utilisez pas** quand :
- Vous ne travaillez qu'avec les √©l√©ments du tableau
- Les documents sans tableau ne sont pas pertinents pour votre analyse

---

## Option : includeArrayIndex

Cette option ajoute un champ contenant la **position** de l'√©l√©ment dans le tableau d'origine.

```javascript
db.articles.aggregate([
  {
    $unwind: {
      path: "$tags",
      includeArrayIndex: "position_tag"
    }
  }
])
```

### R√©sultat

```json
[
  {
    "_id": 1,
    "titre": "Introduction √† MongoDB",
    "auteur": "Alice",
    "tags": "mongodb",
    "position_tag": 0  // Premier √©l√©ment
  },
  {
    "_id": 1,
    "titre": "Introduction √† MongoDB",
    "auteur": "Alice",
    "tags": "nosql",
    "position_tag": 1  // Deuxi√®me √©l√©ment
  },
  {
    "_id": 1,
    "titre": "Introduction √† MongoDB",
    "auteur": "Alice",
    "tags": "base-de-donnees",
    "position_tag": 2  // Troisi√®me √©l√©ment
  }
  // ...
]
```

### Cas d'Usage

- **Ordre d'importance** : Le premier tag est le plus important
- **Num√©rotation** : Cr√©er des listes num√©rot√©es
- **Filtrage** : Ne garder que les N premiers √©l√©ments

---

## Cas d'Usage Courants

### 1. Comptage des √âl√©ments de Tableau

**Question** : Combien de fois chaque tag appara√Æt-il dans tous les articles ?

```javascript
db.articles.aggregate([
  {
    $unwind: "$tags"
  },
  {
    $group: {
      _id: "$tags",
      nombre_articles: { $sum: 1 }
    }
  },
  {
    $sort: { nombre_articles: -1 }
  }
])
```

**R√©sultat** :
```json
[
  { "_id": "mongodb", "nombre_articles": 1 },
  { "_id": "nosql", "nombre_articles": 1 },
  { "_id": "javascript", "nombre_articles": 1 },
  { "_id": "web", "nombre_articles": 1 },
  // ...
]
```

### 2. Filtrer sur des √âl√©ments de Tableau

**Question** : Quels sont les articles qui ont le tag "mongodb" ?

```javascript
db.articles.aggregate([
  {
    $unwind: "$tags"
  },
  {
    $match: {
      tags: "mongodb"
    }
  }
])
```

**Alternative Plus Efficace** (sans $unwind) :
```javascript
db.articles.find({ tags: "mongodb" })
```

üí° **Note** : Pour un simple filtrage, utilisez `find()`. R√©servez `$unwind` pour les agr√©gations complexes.

### 3. Moyenne sur des Sous-Documents

**Exemple** : Commandes avec plusieurs produits

```javascript
db.commandes.insertMany([
  {
    _id: 1,
    client: "Alice",
    produits: [
      { nom: "Livre", prix: 15 },
      { nom: "Stylo", prix: 2 },
      { nom: "Cahier", prix: 5 }
    ]
  },
  {
    _id: 2,
    client: "Bob",
    produits: [
      { nom: "Souris", prix: 25 },
      { nom: "Clavier", prix: 45 }
    ]
  }
])

// Calculer le prix moyen des produits command√©s
db.commandes.aggregate([
  {
    $unwind: "$produits"
  },
  {
    $group: {
      _id: null,
      prix_moyen: { $avg: "$produits.prix" }
    }
  }
])
```

**R√©sultat** :
```json
{
  "_id": null,
  "prix_moyen": 18.4  // (15+2+5+25+45) / 5
}
```

### 4. Combinaison $unwind et $lookup

Tr√®s fr√©quent : aplatir le r√©sultat d'un `$lookup`.

```javascript
db.commandes.aggregate([
  {
    $lookup: {
      from: "clients",
      localField: "client_id",
      foreignField: "_id",
      as: "client_info"
    }
  },
  {
    $unwind: "$client_info"  // Transformer le tableau en objet
  }
])
```

**Avant $unwind** :
```json
{
  "_id": 1,
  "montant": 100,
  "client_info": [
    { "_id": 101, "nom": "Dupont" }
  ]
}
```

**Apr√®s $unwind** :
```json
{
  "_id": 1,
  "montant": 100,
  "client_info": { "_id": 101, "nom": "Dupont" }
}
```

---

## $unwind Multiple (Tableaux Imbriqu√©s)

Vous pouvez d√©rouler plusieurs niveaux de tableaux.

### Exemple : Articles avec Commentaires et R√©ponses

```javascript
db.articles.insertOne({
  _id: 1,
  titre: "Mon article",
  commentaires: [
    {
      auteur: "Alice",
      texte: "Super article !",
      reponses: [
        { auteur: "Bob", texte: "Merci !" },
        { auteur: "Charlie", texte: "Je suis d'accord" }
      ]
    },
    {
      auteur: "Diana",
      texte: "Int√©ressant",
      reponses: [
        { auteur: "Eve", texte: "Oui, tr√®s" }
      ]
    }
  ]
})

// D√©rouler les commentaires, puis les r√©ponses
db.articles.aggregate([
  {
    $unwind: "$commentaires"  // Premier niveau
  },
  {
    $unwind: "$commentaires.reponses"  // Deuxi√®me niveau
  }
])
```

**R√©sultat** :
```json
[
  {
    "_id": 1,
    "titre": "Mon article",
    "commentaires": {
      "auteur": "Alice",
      "texte": "Super article !",
      "reponses": { "auteur": "Bob", "texte": "Merci !" }
    }
  },
  {
    "_id": 1,
    "titre": "Mon article",
    "commentaires": {
      "auteur": "Alice",
      "texte": "Super article !",
      "reponses": { "auteur": "Charlie", "texte": "Je suis d'accord" }
    }
  },
  {
    "_id": 1,
    "titre": "Mon article",
    "commentaires": {
      "auteur": "Diana",
      "texte": "Int√©ressant",
      "reponses": { "auteur": "Eve", "texte": "Oui, tr√®s" }
    }
  }
]
```

---

## $unwind avec Documents Complexes

### Exemple E-commerce : Panier d'Achat

```javascript
db.paniers.insertOne({
  _id: 1,
  utilisateur: "alice@email.com",
  date_creation: ISODate("2024-01-15"),
  articles: [
    {
      produit_id: 101,
      nom: "Laptop",
      prix: 899,
      quantite: 1
    },
    {
      produit_id: 102,
      nom: "Souris",
      prix: 29,
      quantite: 2
    },
    {
      produit_id: 103,
      nom: "Clavier",
      prix: 79,
      quantite: 1
    }
  ],
  total: 1036
})

// Calculer le montant par ligne (prix √ó quantit√©)
db.paniers.aggregate([
  {
    $unwind: "$articles"
  },
  {
    $addFields: {
      "articles.montant_ligne": {
        $multiply: ["$articles.prix", "$articles.quantite"]
      }
    }
  },
  {
    $project: {
      utilisateur: 1,
      "articles.nom": 1,
      "articles.prix": 1,
      "articles.quantite": 1,
      "articles.montant_ligne": 1
    }
  }
])
```

**R√©sultat** :
```json
[
  {
    "_id": 1,
    "utilisateur": "alice@email.com",
    "articles": {
      "nom": "Laptop",
      "prix": 899,
      "quantite": 1,
      "montant_ligne": 899
    }
  },
  {
    "_id": 1,
    "utilisateur": "alice@email.com",
    "articles": {
      "nom": "Souris",
      "prix": 29,
      "quantite": 2,
      "montant_ligne": 58
    }
  },
  {
    "_id": 1,
    "utilisateur": "alice@email.com",
    "articles": {
      "nom": "Clavier",
      "prix": 79,
      "quantite": 1,
      "montant_ligne": 79
    }
  }
]
```

---

## Impact sur les Performance

### Explosion du Nombre de Documents

‚ö†Ô∏è **Attention** : `$unwind` peut **multiplier consid√©rablement** le nombre de documents dans le pipeline.

**Exemple** :
- 1 000 commandes
- Chaque commande a en moyenne 5 produits
- Apr√®s `$unwind` : **5 000 documents** √† traiter

### Bonnes Pratiques de Performance

#### 1. Filtrer AVANT $unwind

```javascript
// ‚ùå Mauvais : Unwind puis filter
db.articles.aggregate([
  { $unwind: "$tags" },
  { $match: { auteur: "Alice" } }  // Filtre tardif
])

// ‚úÖ Bon : Filter puis unwind
db.articles.aggregate([
  { $match: { auteur: "Alice" } },  // Filtre pr√©coce
  { $unwind: "$tags" }
])
```

#### 2. Limiter AVANT $unwind

```javascript
// Limiter le nombre de documents avant de les d√©rouler
db.articles.aggregate([
  { $sort: { date: -1 } },
  { $limit: 100 },          // Seulement les 100 derniers articles
  { $unwind: "$tags" }
])
```

#### 3. Utiliser des Index

Cr√©ez des index sur les champs utilis√©s dans `$match` avant `$unwind`.

```javascript
db.articles.createIndex({ auteur: 1 })
```

#### 4. Projeter Uniquement les Champs N√©cessaires

```javascript
db.articles.aggregate([
  {
    $project: {
      tags: 1,
      titre: 1
      // Exclure les champs inutiles
    }
  },
  {
    $unwind: "$tags"
  }
])
```

---

## $unwind vs Op√©rateurs de Tableau

Pour certaines op√©rations, vous n'avez **pas besoin** de `$unwind`.

### Exemple : Compter les √âl√©ments d'un Tableau

```javascript
// ‚ùå Avec $unwind (moins efficace)
db.articles.aggregate([
  { $unwind: "$tags" },
  {
    $group: {
      _id: "$_id",
      nombre_tags: { $sum: 1 }
    }
  }
])

// ‚úÖ Sans $unwind (plus efficace)
db.articles.aggregate([
  {
    $project: {
      titre: 1,
      nombre_tags: { $size: "$tags" }
    }
  }
])
```

### Op√©rateurs de Tableau Utiles

| Op√©rateur | Usage |
|-----------|-------|
| `$size` | Nombre d'√©l√©ments dans un tableau |
| `$filter` | Filtrer un tableau |
| `$map` | Transformer chaque √©l√©ment d'un tableau |
| `$reduce` | R√©duire un tableau √† une valeur |
| `$arrayElemAt` | Acc√©der √† un √©l√©ment par index |

---

## Patterns Courants avec $unwind

### Pattern 1 : Top N par Cat√©gorie

**Question** : Les 3 tags les plus utilis√©s

```javascript
db.articles.aggregate([
  { $unwind: "$tags" },
  {
    $group: {
      _id: "$tags",
      count: { $sum: 1 }
    }
  },
  { $sort: { count: -1 } },
  { $limit: 3 }
])
```

### Pattern 2 : Jointure puis Unwind

```javascript
db.commandes.aggregate([
  {
    $lookup: {
      from: "produits",
      localField: "produit_ids",
      foreignField: "_id",
      as: "produits"
    }
  },
  { $unwind: "$produits" },
  {
    $group: {
      _id: "$_id",
      total: { $sum: "$produits.prix" }
    }
  }
])
```

### Pattern 3 : Unwind, Filtre, Re-groupement

```javascript
// Trouver les articles qui ont UNIQUEMENT le tag "mongodb"
db.articles.aggregate([
  { $unwind: "$tags" },
  {
    $group: {
      _id: "$_id",
      titre: { $first: "$titre" },
      tags: { $push: "$tags" }  // Reconstruire le tableau
    }
  },
  {
    $match: {
      tags: { $eq: ["mongodb"] }  // Tableau avec un seul √©l√©ment
    }
  }
])
```

---

## Erreurs Courantes et Solutions

### Erreur 1 : Oublier le Signe $

```javascript
// ‚ùå Erreur
{ $unwind: "tags" }

// ‚úÖ Correct
{ $unwind: "$tags" }
```

### Erreur 2 : Unwind sur un Champ Non-Tableau

```javascript
// Document
{ "_id": 1, "nom": "Alice", "age": 30 }

// Pipeline
db.users.aggregate([
  { $unwind: "$age" }  // "age" n'est pas un tableau
])

// R√©sultat : Erreur ou comportement inattendu
```

**Solution** : V√©rifiez que le champ est bien un tableau avec `$type`.

### Erreur 3 : Perte de Documents (Tableaux Vides)

```javascript
// Document avec tableau vide
{ "_id": 1, "tags": [] }

// Sans preserveNullAndEmptyArrays
db.articles.aggregate([
  { $unwind: "$tags" }
])
// ‚Üí Document exclu !

// Avec preserveNullAndEmptyArrays
db.articles.aggregate([
  {
    $unwind: {
      path: "$tags",
      preserveNullAndEmptyArrays: true
    }
  }
])
// ‚Üí Document conserv√©
```

---

## Comparaison avec SQL

MongoDB `$unwind` n'a **pas d'√©quivalent direct** en SQL, mais ressemble √† :

### SQL (Jointure avec Table de Jonction)

```sql
-- Table articles_tags (relation Many-to-Many)
SELECT a.id, a.titre, t.nom_tag
FROM articles a
JOIN articles_tags at ON a.id = at.article_id
JOIN tags t ON at.tag_id = t.id;
```

### MongoDB √âquivalent

```javascript
// Articles avec tableau de tags imbriqu√©
db.articles.aggregate([
  { $unwind: "$tags" }
])
```

**Diff√©rence cl√©** : En MongoDB, les tags sont d√©j√† **dans le document**, pas dans une table s√©par√©e.

---

## Cas d'Usage Avanc√© : Analyse de S√©ries Temporelles

### Exemple : Logs avec √âv√©nements Multiples

```javascript
db.sessions.insertOne({
  _id: 1,
  utilisateur_id: 101,
  date: ISODate("2024-03-15"),
  evenements: [
    { heure: "10:30", action: "login" },
    { heure: "10:35", action: "consultation_produit", produit_id: 501 },
    { heure: "10:40", action: "ajout_panier", produit_id: 501 },
    { heure: "10:45", action: "paiement", montant: 99.99 },
    { heure: "10:46", action: "logout" }
  ]
})

// Analyser les actions par type
db.sessions.aggregate([
  { $unwind: "$evenements" },
  {
    $group: {
      _id: "$evenements.action",
      nombre_occurrences: { $sum: 1 }
    }
  },
  { $sort: { nombre_occurrences: -1 } }
])
```

---

## R√©sum√©

### Points Cl√©s

| Aspect | Description |
|--------|-------------|
| **Objectif** | D√©plier un tableau en documents individuels |
| **Effet** | 1 document avec N √©l√©ments ‚Üí N documents avec 1 √©l√©ment |
| **Comportement par d√©faut** | Exclut les documents avec tableaux vides ou champs manquants |
| **Option preserveNull...** | Conserve tous les documents |
| **Option includeArrayIndex** | Ajoute l'index de position de l'√©l√©ment |
| **Usage principal** | Agr√©gations sur √©l√©ments de tableau, combinaison avec $group |

### Quand Utiliser $unwind

‚úÖ **Utilisez $unwind** pour :
- Agr√©ger des donn√©es dans un tableau
- Compter, filtrer, ou analyser des √©l√©ments individuels
- Combiner avec `$group` pour des statistiques
- Aplatir les r√©sultats de `$lookup`

‚ùå **N'utilisez PAS $unwind** pour :
- Simple recherche d'un √©l√©ment (utilisez les op√©rateurs de tableau)
- Comptage de la taille du tableau (utilisez `$size`)
- Op√©rations qui peuvent se faire sans d√©rouler

### Sch√©ma de D√©cision

```
Ai-je besoin d'analyser chaque √©l√©ment d'un tableau individuellement ?
‚îú‚îÄ Non
‚îÇ  ‚îî‚îÄ Utilisez les op√©rateurs de tableau ($size, $filter, $map, etc.)
‚îî‚îÄ Oui
   ‚îú‚îÄ Simple extraction ‚Üí find() avec op√©rateurs
   ‚îú‚îÄ Agr√©gation complexe ‚Üí $unwind + $group
   ‚îú‚îÄ Tableaux vides importants ‚Üí preserveNullAndEmptyArrays: true
   ‚îî‚îÄ Besoin de position ‚Üí includeArrayIndex
```

---

## Exemple Complet : Analyse de Ventes

```javascript
// Donn√©es
db.ventes.insertMany([
  {
    _id: 1,
    date: ISODate("2024-03-01"),
    vendeur: "Alice",
    produits: [
      { categorie: "√âlectronique", nom: "Laptop", prix: 899, quantite: 1 },
      { categorie: "Accessoires", nom: "Souris", prix: 29, quantite: 2 }
    ]
  },
  {
    _id: 2,
    date: ISODate("2024-03-02"),
    vendeur: "Bob",
    produits: [
      { categorie: "√âlectronique", nom: "Tablette", prix: 499, quantite: 1 },
      { categorie: "√âlectronique", nom: "√âcouteurs", prix: 79, quantite: 3 }
    ]
  },
  {
    _id: 3,
    date: ISODate("2024-03-03"),
    vendeur: "Alice",
    produits: [
      { categorie: "Accessoires", nom: "Clavier", prix: 79, quantite: 2 }
    ]
  }
])

// Analyse : Chiffre d'affaires par cat√©gorie
db.ventes.aggregate([
  // √âtape 1 : D√©plier les produits
  { $unwind: "$produits" },

  // √âtape 2 : Calculer le montant par ligne
  {
    $addFields: {
      montant_ligne: {
        $multiply: ["$produits.prix", "$produits.quantite"]
      }
    }
  },

  // √âtape 3 : Grouper par cat√©gorie
  {
    $group: {
      _id: "$produits.categorie",
      chiffre_affaires: { $sum: "$montant_ligne" },
      nombre_produits_vendus: { $sum: "$produits.quantite" },
      nombre_ventes: { $sum: 1 }
    }
  },

  // √âtape 4 : Trier par CA d√©croissant
  { $sort: { chiffre_affaires: -1 } },

  // √âtape 5 : Renommer le champ _id
  {
    $project: {
      _id: 0,
      categorie: "$_id",
      chiffre_affaires: 1,
      nombre_produits_vendus: 1,
      nombre_ventes: 1
    }
  }
])
```

**R√©sultat** :
```json
[
  {
    "categorie": "√âlectronique",
    "chiffre_affaires": 1375,  // 899 + 499 + (79√ó3)
    "nombre_produits_vendus": 5,
    "nombre_ventes": 3
  },
  {
    "categorie": "Accessoires",
    "chiffre_affaires": 216,   // (29√ó2) + (79√ó2)
    "nombre_produits_vendus": 4,
    "nombre_ventes": 2
  }
]
```

---

## Conclusion

`$unwind` est un outil **indispensable** pour travailler avec les tableaux dans MongoDB. Il permet de transformer des structures imbriqu√©es en donn√©es plates, facilitant ainsi les analyses et agr√©gations complexes.

### √Ä Retenir

1. **$unwind** d√©plie un tableau en cr√©ant un document par √©l√©ment
2. Par d√©faut, les documents sans tableau sont **exclus**
3. Utilisez `preserveNullAndEmptyArrays: true` pour les conserver
4. **Optimisez** en filtrant avant d'appliquer $unwind
5. Combinez souvent avec **$group** pour des agr√©gations
6. Tr√®s utile apr√®s **$lookup** pour aplatir les jointures

### Prochaines √âtapes

Dans les sections suivantes, nous explorerons :
- **$addFields et $set** : Ajouter ou modifier des champs
- **$group** : Agr√©gations et calculs avanc√©s
- **Optimisation des pipelines** : Techniques pour am√©liorer les performances

---

**üìö R√©f√©rences**

- [Documentation officielle $unwind](https://www.mongodb.com/docs/manual/reference/operator/aggregation/unwind/)
- [Array Operators](https://www.mongodb.com/docs/manual/reference/operator/aggregation/array/)
- [Aggregation Pipeline Optimization](https://www.mongodb.com/docs/manual/core/aggregation-pipeline-optimization/)

‚è≠Ô∏è [$addFields et $set](/06-framework-agregation/04.03-addfields-set.md)
