üîù Retour au [Sommaire](/SOMMAIRE.md)

# 11.3.1 R√¥les Int√©gr√©s

## Introduction

MongoDB fournit un ensemble complet de r√¥les int√©gr√©s (built-in roles) qui couvrent la plupart des cas d'usage courants. Ces r√¥les sont pr√©d√©finis par MongoDB et offrent des combinaisons de privil√®ges soigneusement con√ßues pour diff√©rents types d'utilisateurs et d'applications.

### Avantages des R√¥les Int√©gr√©s

- **Pr√™ts √† l'emploi** : Pas besoin de d√©finir des privil√®ges manuellement
- **Test√©s et valid√©s** : Combinaisons de permissions √©prouv√©es
- **Maintenus par MongoDB** : √âvoluent avec les versions
- **Best practices** : Respectent le principe du moindre privil√®ge
- **Documentation compl√®te** : Comportement bien d√©fini

### Classification des R√¥les

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    R√îLES INT√âGR√âS MONGODB                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                   ‚îÇ                   ‚îÇ
        ‚ñº                   ‚ñº                   ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   DATABASE  ‚îÇ    ‚îÇ   CLUSTER   ‚îÇ    ‚îÇ    SUPER    ‚îÇ
‚îÇ    ROLES    ‚îÇ    ‚îÇ    ROLES    ‚îÇ    ‚îÇ    USER     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ                   ‚îÇ                   ‚îÇ
        ‚îú‚îÄ read             ‚îú‚îÄ clusterAdmin     ‚îú‚îÄ root
        ‚îú‚îÄ readWrite        ‚îú‚îÄ clusterManager   ‚îî‚îÄ dbOwner
        ‚îú‚îÄ dbAdmin          ‚îú‚îÄ clusterMonitor
        ‚îî‚îÄ userAdmin        ‚îú‚îÄ hostManager
                            ‚îú‚îÄ backup
                            ‚îî‚îÄ restore
```

## R√¥les de Lecture (Read Roles)

### read

**Port√©e** : Database sp√©cifique

**Permissions** :
- Lecture de toutes les collections **non-syst√®me** d'une base de donn√©es
- Ex√©cution de requ√™tes `find()`, `aggregate()`, `count()`, `distinct()`
- Lecture des index

**Privil√®ges inclus** :

| Action | Resource | Description |
|--------|----------|-------------|
| `find` | Toutes collections (non-syst√®me) | Lecture des documents |
| `listCollections` | Database | Lister les collections |
| `listIndexes` | Toutes collections | Lister les index |
| `collStats` | Toutes collections | Statistiques collections |
| `dbStats` | Database | Statistiques database |

**Cr√©ation d'utilisateur** :

```javascript
use production
db.createUser({
  user: "reader_app",
  pwd: passwordPrompt(),
  roles: [
    { role: "read", db: "production" }
  ]
})
```

**Cas d'usage** :
- Applications analytics en lecture seule
- Services de reporting
- Dashboards de visualisation
- Applications tierces n√©cessitant uniquement la lecture

**Limitations** :
- ‚ùå Pas d'√©criture
- ‚ùå Pas de modification de sch√©ma
- ‚ùå Pas de cr√©ation d'index
- ‚ùå Pas d'acc√®s aux collections syst√®me (`system.*`)

**Exemple** :

```javascript
// Avec le r√¥le "read"
use production

// ‚úÖ AUTORIS√â
db.orders.find({ status: "pending" })
db.orders.aggregate([{ $group: { _id: "$customerId", total: { $sum: "$amount" } } }])
db.orders.count({ status: "completed" })
db.getCollectionNames()

// ‚ùå REFUS√â
db.orders.insertOne({ name: "New Order" })
db.orders.updateOne({ _id: 1 }, { $set: { status: "shipped" } })
db.orders.deleteOne({ _id: 1 })
db.orders.createIndex({ customerId: 1 })
```

### readAnyDatabase

**Port√©e** : Toutes les bases de donn√©es (sauf `local` et `config`)

**Permissions** :
- √âquivalent √† `read` sur toutes les bases de donn√©es
- Lecture de `system.js` dans toutes les bases
- Action `listDatabases` au niveau cluster

**Cr√©ation d'utilisateur** :

```javascript
use admin
db.createUser({
  user: "global_reader",
  pwd: passwordPrompt(),
  roles: [
    { role: "readAnyDatabase", db: "admin" }
  ]
})
```

**Cas d'usage** :
- Monitoring global de toutes les bases
- Outils d'analytics cross-database
- Services d'audit en lecture seule
- ETL en lecture seule

**‚ö†Ô∏è Important** :
- Doit √™tre cr√©√© dans la base `admin`
- Donne acc√®s √† **toutes** les bases existantes et futures
- N'inclut **pas** `local` et `config` (bases syst√®me)

## R√¥les de Lecture-√âcriture (Read-Write Roles)

### readWrite

**Port√©e** : Database sp√©cifique

**Permissions** :
- Tous les privil√®ges de `read`
- √âcriture dans toutes les collections non-syst√®me
- Modification des documents existants
- Suppression de documents

**Privil√®ges additionnels** (en plus de `read`) :

| Action | Resource | Description |
|--------|----------|-------------|
| `insert` | Toutes collections | Insertion de documents |
| `update` | Toutes collections | Modification de documents |
| `remove` | Toutes collections | Suppression de documents |
| `createCollection` | Database | Cr√©ation de collections |
| `dropCollection` | Toutes collections (non-syst√®me) | Suppression de collections |

**Cr√©ation d'utilisateur** :

```javascript
use production
db.createUser({
  user: "webapp_user",
  pwd: passwordPrompt(),
  roles: [
    { role: "readWrite", db: "production" }
  ]
})
```

**Cas d'usage** :
- Applications web standard (CRUD operations)
- APIs REST
- Services m√©tier
- Applications mobiles

**Limitations** :
- ‚ùå Pas de cr√©ation d'index
- ‚ùå Pas de modification de sch√©ma avanc√©
- ‚ùå Pas de gestion d'utilisateurs
- ‚ùå Pas d'actions d'administration

**Exemple** :

```javascript
// Avec le r√¥le "readWrite"
use production

// ‚úÖ AUTORIS√â (read)
db.orders.find()
db.orders.aggregate([...])

// ‚úÖ AUTORIS√â (write)
db.orders.insertOne({ customer: "John", amount: 100 })
db.orders.updateOne({ _id: 1 }, { $set: { status: "shipped" } })
db.orders.deleteOne({ _id: 1 })
db.createCollection("newCollection")
db.oldCollection.drop()

// ‚ùå REFUS√â (admin)
db.orders.createIndex({ customerId: 1 })
db.orders.reIndex()
db.createUser({ user: "test", pwd: "test", roles: [] })
```

### readWriteAnyDatabase

**Port√©e** : Toutes les bases de donn√©es (sauf `local` et `config`)

**Permissions** :
- √âquivalent √† `readWrite` sur toutes les bases
- Action `listDatabases` au niveau cluster
- Toutes les actions de `readAnyDatabase`

**Cr√©ation d'utilisateur** :

```javascript
use admin
db.createUser({
  user: "global_app_user",
  pwd: passwordPrompt(),
  roles: [
    { role: "readWriteAnyDatabase", db: "admin" }
  ]
})
```

**Cas d'usage** :
- Services n√©cessitant acc√®s multi-bases
- Migrations de donn√©es cross-database
- Applications multi-tenant avec bases s√©par√©es

**‚ö†Ô∏è Attention** :
- Permissions tr√®s larges
- √Ä utiliser avec pr√©caution
- Pr√©f√©rer des permissions database par database en production

## R√¥les d'Administration de Base de Donn√©es

### dbAdmin

**Port√©e** : Database sp√©cifique

**Permissions** :
- Administration compl√®te d'une base de donn√©es
- Gestion des index
- Statistiques et profiling
- Validation de collections
- Compact et autres op√©rations de maintenance

**Privil√®ges cl√©s** :

| Action | Resource | Description |
|--------|----------|-------------|
| `createIndex` | Toutes collections | Cr√©er des index |
| `dropIndex` | Toutes collections | Supprimer des index |
| `reIndex` | Toutes collections | Reconstruire les index |
| `collMod` | Toutes collections | Modifier collection |
| `collStats` | Toutes collections | Statistiques collection |
| `dbStats` | Database | Statistiques database |
| `enableProfiler` | Database | Activer le profiler |
| `compact` | Toutes collections | Compacter les donn√©es |
| `validate` | Toutes collections | Valider la collection |
| `storageDetails` | Toutes collections | D√©tails du storage |

**Cr√©ation d'utilisateur** :

```javascript
use production
db.createUser({
  user: "db_maintainer",
  pwd: passwordPrompt(),
  roles: [
    { role: "dbAdmin", db: "production" }
  ]
})
```

**Cas d'usage** :
- Administrateurs de base de donn√©es
- Scripts de maintenance automatis√©s
- Optimisation des performances
- Monitoring et tuning

**‚ö†Ô∏è Important** :
- **N'inclut PAS** de permissions de lecture/√©criture des donn√©es
- Souvent combin√© avec `read` ou `readWrite`

**Exemple de combinaison** :

```javascript
// DBA avec lecture/√©criture ET admin
use production
db.createUser({
  user: "dba_full",
  pwd: passwordPrompt(),
  roles: [
    { role: "readWrite", db: "production" },
    { role: "dbAdmin", db: "production" }
  ]
})
```

**Op√©rations typiques** :

```javascript
// Avec le r√¥le "dbAdmin"
use production

// ‚úÖ AUTORIS√â
db.orders.createIndex({ customerId: 1, date: -1 })
db.orders.dropIndex("customerId_1_date_-1")
db.orders.reIndex()
db.setProfilingLevel(1, { slowms: 100 })
db.stats()
db.orders.stats()
db.orders.validate()

// ‚ùå REFUS√â (pas de read/write)
db.orders.find()
db.orders.insertOne({ name: "test" })
```

### dbAdminAnyDatabase

**Port√©e** : Toutes les bases de donn√©es (sauf `local` et `config`)

**Permissions** :
- √âquivalent √† `dbAdmin` sur toutes les bases
- Action `listDatabases` au niveau cluster

**Cr√©ation d'utilisateur** :

```javascript
use admin
db.createUser({
  user: "global_dba",
  pwd: passwordPrompt(),
  roles: [
    { role: "dbAdminAnyDatabase", db: "admin" },
    { role: "readWriteAnyDatabase", db: "admin" }  // Optionnel : ajout lecture/√©criture
  ]
})
```

**Cas d'usage** :
- DBAs g√©rant toutes les bases
- Scripts de maintenance globaux
- Outils de monitoring cross-database

## R√¥les d'Administration Utilisateur

### userAdmin

**Port√©e** : Database sp√©cifique

**Permissions** :
- Gestion compl√®te des utilisateurs et r√¥les de la base
- Cr√©ation, modification, suppression d'utilisateurs
- Attribution et r√©vocation de r√¥les

**Privil√®ges cl√©s** :

| Action | Resource | Description |
|--------|----------|-------------|
| `createUser` | Database | Cr√©er des utilisateurs |
| `dropUser` | Database | Supprimer des utilisateurs |
| `changeCustomData` | Database | Modifier donn√©es custom user |
| `changePassword` | Database | Changer mots de passe |
| `grantRole` | Database | Accorder des r√¥les |
| `revokeRole` | Database | R√©voquer des r√¥les |
| `createRole` | Database | Cr√©er des r√¥les custom |
| `dropRole` | Database | Supprimer des r√¥les custom |
| `viewUser` | Database | Voir les utilisateurs |
| `viewRole` | Database | Voir les r√¥les |

**Cr√©ation d'utilisateur** :

```javascript
use production
db.createUser({
  user: "user_manager",
  pwd: passwordPrompt(),
  roles: [
    { role: "userAdmin", db: "production" }
  ]
})
```

**Cas d'usage** :
- Gestionnaires d'acc√®s d√©l√©gu√©s
- √âquipes de s√©curit√©
- Administrateurs d'applications
- Self-service portals

**‚ö†Ô∏è Pouvoir √©tendu** :
- Peut cr√©er des utilisateurs avec n'importe quel r√¥le (y compris `userAdmin`)
- Peut s'auto-attribuer plus de permissions
- Consid√©r√© comme un r√¥le √† haut privil√®ge

**Exemple** :

```javascript
// Avec le r√¥le "userAdmin"
use production

// ‚úÖ AUTORIS√â
db.createUser({
  user: "new_app_user",
  pwd: "password",
  roles: [{ role: "readWrite", db: "production" }]
})

db.grantRolesToUser("existing_user", [
  { role: "dbAdmin", db: "production" }
])

db.revokeRolesFromUser("old_user", [
  { role: "readWrite", db: "production" }
])

db.dropUser("obsolete_user")

db.createRole({
  role: "customRole",
  privileges: [...],
  roles: []
})

// ‚ùå REFUS√â (pas de read/write)
db.orders.find()
db.orders.insertOne({ name: "test" })
```

### userAdminAnyDatabase

**Port√©e** : Toutes les bases de donn√©es

**Permissions** :
- √âquivalent √† `userAdmin` sur toutes les bases
- Gestion des utilisateurs et r√¥les globalement
- Action `listDatabases` au niveau cluster

**Cr√©ation d'utilisateur** :

```javascript
use admin
db.createUser({
  user: "global_user_admin",
  pwd: passwordPrompt(),
  roles: [
    { role: "userAdminAnyDatabase", db: "admin" }
  ]
})
```

**Cas d'usage** :
- Administrateurs de s√©curit√©
- √âquipes IAM (Identity and Access Management)
- Outils de provisioning automatique

**‚ö†Ô∏è Permissions critiques** :
- Peut cr√©er des utilisateurs avec `root` si souhait√©
- N√©cessite une protection stricte
- Auditer toutes les op√©rations

## R√¥les de Cluster

### clusterAdmin

**Port√©e** : Cluster entier

**Permissions** :
- **Tous** les privil√®ges d'administration cluster
- Combine `clusterManager`, `clusterMonitor`, et `hostManager`
- Plus les privil√®ges `dropDatabase`

**Privil√®ges** :
- Tous les privil√®ges de cluster management
- Configuration de sharding
- Gestion des replica sets
- Monitoring complet
- Gestion des processus (shutdown)

**Cr√©ation d'utilisateur** :

```javascript
use admin
db.createUser({
  user: "cluster_admin",
  pwd: passwordPrompt(),
  roles: [
    { role: "clusterAdmin", db: "admin" }
  ]
})
```

**Cas d'usage** :
- Administrateurs infrastructure MongoDB
- Gestion des replica sets et sharding
- Configuration cluster avanc√©e
- Op√©rations critiques

**‚ö†Ô∏è R√¥le tr√®s puissant** :
- Peut arr√™ter le cluster (`shutdown`)
- Peut reconfigurer le replica set
- Peut supprimer des bases de donn√©es
- R√©serv√© aux super-administrateurs

**Op√©rations typiques** :

```javascript
// Avec le r√¥le "clusterAdmin"
use admin

// ‚úÖ AUTORIS√â
rs.status()
rs.reconfig(config)
sh.status()
sh.addShard("shard01/server:27017")
db.adminCommand({ replSetStepDown: 60 })
db.adminCommand({ shutdown: 1 })
db.dropDatabase()
db.serverStatus()
```

### clusterManager

**Port√©e** : Cluster entier

**Permissions** :
- Gestion et monitoring du cluster
- Configuration sharding et replica sets
- **Pas** de shutdown ni dropDatabase

**Privil√®ges cl√©s** :

| Action | Resource | Description |
|--------|----------|-------------|
| `addShard` | Cluster | Ajouter un shard |
| `removeShard` | Cluster | Retirer un shard |
| `enableSharding` | Database | Activer sharding sur DB |
| `shardCollection` | Database | Sharder une collection |
| `replSetConfigure` | Cluster | Configurer replica set |
| `replSetReconfig` | Cluster | Reconfigurer replica set |
| `flushRouterConfig` | Cluster | Flush config mongos |

**Cr√©ation d'utilisateur** :

```javascript
use admin
db.createUser({
  user: "cluster_manager",
  pwd: passwordPrompt(),
  roles: [
    { role: "clusterManager", db: "admin" }
  ]
})
```

**Cas d'usage** :
- Op√©rateurs infrastructure
- Scripts d'automation (Ansible, Terraform)
- Gestion quotidienne du cluster

### clusterMonitor

**Port√©e** : Cluster entier

**Permissions** :
- **Lecture seule** des informations de monitoring
- Statistiques et statuts
- Pas de modifications possibles

**Privil√®ges cl√©s** :

| Action | Resource | Description |
|--------|----------|-------------|
| `serverStatus` | Cluster | Statut du serveur |
| `replSetGetStatus` | Cluster | Statut replica set |
| `shardingState` | Cluster | √âtat du sharding |
| `top` | Cluster | Top des op√©rations |
| `getLog` | Cluster | Logs du serveur |
| `connPoolStats` | Cluster | Stats connection pool |
| `getCmdLineOpts` | Cluster | Options ligne de commande |

**Cr√©ation d'utilisateur** :

```javascript
use admin
db.createUser({
  user: "monitoring_agent",
  pwd: passwordPrompt(),
  roles: [
    { role: "clusterMonitor", db: "admin" }
  ]
})
```

**Cas d'usage** :
- Outils de monitoring (Prometheus, Datadog, New Relic)
- Dashboards de surveillance
- Alerting systems
- Capacity planning

**Exemple** :

```javascript
// Avec le r√¥le "clusterMonitor"
use admin

// ‚úÖ AUTORIS√â
db.serverStatus()
rs.status()
sh.status()
db.adminCommand({ top: 1 })
db.adminCommand({ getLog: "global" })
db.currentOp()

// ‚ùå REFUS√â
rs.reconfig(config)
sh.addShard("shard02/server:27017")
db.adminCommand({ shutdown: 1 })
```

### hostManager

**Port√©e** : Cluster entier

**Permissions** :
- Gestion des processus serveur
- Monitoring et management
- Actions d'infrastructure

**Privil√®ges cl√©s** :

| Action | Resource | Description |
|--------|----------|-------------|
| `logRotate` | Cluster | Rotation des logs |
| `setParameter` | Cluster | Modifier param√®tres runtime |
| `connPoolSync` | Cluster | Sync connection pool |
| `cpuProfiler` | Cluster | CPU profiling |
| `invalidateUserCache` | Cluster | Invalider cache users |
| `killop` | Cluster | Tuer des op√©rations |
| `killCursors` | Collection | Tuer des curseurs |

**Cr√©ation d'utilisateur** :

```javascript
use admin
db.createUser({
  user: "host_manager",
  pwd: passwordPrompt(),
  roles: [
    { role: "hostManager", db: "admin" }
  ]
})
```

**Cas d'usage** :
- Scripts de maintenance syst√®me
- Rotation des logs automatis√©e
- Tuning des param√®tres runtime
- Gestion des op√©rations longues

**Exemple** :

```javascript
// Avec le r√¥le "hostManager"
use admin

// ‚úÖ AUTORIS√â
db.adminCommand({ logRotate: 1 })
db.adminCommand({ setParameter: 1, maxIncomingConnections: 10000 })
db.killOp(12345)
db.adminCommand({ invalidateUserCache: 1 })

// Typiquement combin√© avec clusterMonitor
```

## R√¥les de Backup et Restore

### backup

**Port√©e** : Cluster entier

**Permissions** :
- Lecture de toutes les bases de donn√©es
- Acc√®s aux m√©tadonn√©es syst√®me
- Actions n√©cessaires pour backup coh√©rent

**Privil√®ges cl√©s** :

| Action | Resource | Description |
|--------|----------|-------------|
| `find` | Toutes collections (y compris syst√®me) | Lecture compl√®te |
| `listDatabases` | Cluster | Lister les bases |
| `listCollections` | Toutes databases | Lister les collections |
| `listIndexes` | Toutes collections | Lister les index |

**√âquivalent √†** :
- `read` sur toutes les bases (incluant `local` et `config`)
- Plus acc√®s aux collections syst√®me

**Cr√©ation d'utilisateur** :

```javascript
use admin
db.createUser({
  user: "backup_service",
  pwd: passwordPrompt(),
  roles: [
    { role: "backup", db: "admin" }
  ]
})
```

**Cas d'usage** :
- Services de backup (mongodump)
- Outils de backup tiers
- Snapshots logiques
- R√©plication vers DR site

**‚ö†Ô∏è Important** :
- Acc√®s en lecture √† **toutes** les donn√©es
- Inclut les bases `local` et `config`
- S√©curiser strictement ce compte

### restore

**Port√©e** : Cluster entier

**Permissions** :
- √âcriture dans toutes les bases de donn√©es
- Restauration compl√®te du cluster
- Modification des collections syst√®me

**Privil√®ges cl√©s** :

| Action | Resource | Description |
|--------|----------|-------------|
| `insert` | Toutes collections | Insertion de documents |
| `createCollection` | Toutes databases | Cr√©ation de collections |
| `createIndex` | Toutes collections | Cr√©ation d'index |
| `dropCollection` | Toutes collections | Suppression de collections |
| `convertToCapped` | Toutes collections | Conversion capped |

**Cr√©ation d'utilisateur** :

```javascript
use admin
db.createUser({
  user: "restore_service",
  pwd: passwordPrompt(),
  roles: [
    { role: "restore", db: "admin" }
  ]
})
```

**Cas d'usage** :
- Processus de restauration (mongorestore)
- Disaster recovery
- Migration de donn√©es
- Initialisation d'environnements

**‚ö†Ô∏è Permissions √©tendues** :
- Peut √©craser toutes les donn√©es
- Peut cr√©er/supprimer des collections
- Utiliser uniquement pour restaurations

**Usage combin√© backup/restore** :

```javascript
// Compte pour backup et restore
use admin
db.createUser({
  user: "backup_restore_service",
  pwd: passwordPrompt(),
  roles: [
    { role: "backup", db: "admin" },
    { role: "restore", db: "admin" }
  ]
})
```

## R√¥les Super Utilisateur

### root

**Port√©e** : Tout le syst√®me MongoDB

**Permissions** :
- **Toutes** les actions possibles
- Combine tous les r√¥les avec privil√®ges `AnyDatabase`
- Plus tous les r√¥les de cluster

**√âquivalent √†** :
```javascript
[
  { role: "readWriteAnyDatabase", db: "admin" },
  { role: "dbAdminAnyDatabase", db: "admin" },
  { role: "userAdminAnyDatabase", db: "admin" },
  { role: "clusterAdmin", db: "admin" },
  { role: "restore", db: "admin" },
  { role: "backup", db: "admin" }
]
```

**Cr√©ation d'utilisateur** :

```javascript
use admin
db.createUser({
  user: "root_admin",
  pwd: passwordPrompt(),
  roles: [
    { role: "root", db: "admin" }
  ]
})
```

**Cas d'usage** :
- Compte d'urgence
- Premier compte administrateur
- Op√©rations critiques ponctuelles

**‚ö†Ô∏è DANGER** :
- Acc√®s total sans restriction
- Peut tout faire, y compris se supprimer
- Peut d√©truire le cluster entier
- **Ne JAMAIS utiliser pour applications**
- **R√©server aux humains de confiance uniquement**

**Recommandations** :
1. Cr√©er un seul compte `root` pour urgences
2. Ne pas utiliser au quotidien
3. Audit strict de toutes les connexions
4. Consid√©rer `break-glass` procedures
5. Utiliser des r√¥les plus restreints pour op√©rations normales

### dbOwner

**Port√©e** : Database sp√©cifique

**Permissions** :
- Tous les privil√®ges sur une base de donn√©es
- Combine `readWrite`, `dbAdmin`, et `userAdmin`

**√âquivalent √†** :
```javascript
[
  { role: "readWrite", db: "myDatabase" },
  { role: "dbAdmin", db: "myDatabase" },
  { role: "userAdmin", db: "myDatabase" }
]
```

**Cr√©ation d'utilisateur** :

```javascript
use production
db.createUser({
  user: "production_owner",
  pwd: passwordPrompt(),
  roles: [
    { role: "dbOwner", db: "production" }
  ]
})
```

**Cas d'usage** :
- Propri√©taire/responsable d'une base
- Gestion compl√®te d'une base sp√©cifique
- D√©l√©gation par base de donn√©es

**‚ö†Ô∏è Pouvoir complet sur la base** :
- Peut tout faire sur la base
- Peut cr√©er des utilisateurs avec `dbOwner`
- Peut se r√©voquer ses propres privil√®ges (attention!)

## R√¥les Internes (Internal Roles)

### __system

**Port√©e** : Syst√®me interne

**Permissions** :
- Utilis√© par MongoDB en interne
- Actions privil√©gi√©es du syst√®me
- **Ne JAMAIS attribuer manuellement**

**Usage** :
- R√©plication interne
- Sharding interne
- Op√©rations syst√®me critiques

**‚ö†Ô∏è INTERDICTION** :
- Ne jamais cr√©er d'utilisateur avec ce r√¥le
- R√©serv√© exclusivement √† MongoDB
- Contourner les m√©canismes de s√©curit√©

## Tableau R√©capitulatif des R√¥les

### R√¥les Database

| R√¥le | Port√©e | Lecture | √âcriture | Admin DB | Admin Users | Cas d'Usage Principal |
|------|--------|---------|----------|----------|-------------|---------------------|
| `read` | Database | ‚úÖ | ‚ùå | ‚ùå | ‚ùå | Analytics, reporting |
| `readWrite` | Database | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå | Applications standard |
| `dbAdmin` | Database | ‚ùå | ‚ùå | ‚úÖ | ‚ùå | Maintenance DB |
| `userAdmin` | Database | ‚ùå | ‚ùå | ‚ùå | ‚úÖ | Gestion acc√®s |
| `dbOwner` | Database | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | Propri√©taire DB |

### R√¥les AnyDatabase

| R√¥le | √âquivalent | Cas d'Usage Principal |
|------|------------|---------------------|
| `readAnyDatabase` | `read` sur toutes les bases | Monitoring global |
| `readWriteAnyDatabase` | `readWrite` sur toutes les bases | Apps multi-tenant |
| `dbAdminAnyDatabase` | `dbAdmin` sur toutes les bases | DBA global |
| `userAdminAnyDatabase` | `userAdmin` sur toutes les bases | Admin s√©curit√© |

### R√¥les Cluster

| R√¥le | Monitoring | Management | Shutdown | Cas d'Usage Principal |
|------|------------|------------|----------|---------------------|
| `clusterMonitor` | ‚úÖ | ‚ùå | ‚ùå | Outils monitoring |
| `clusterManager` | ‚úÖ | ‚úÖ | ‚ùå | Ops quotidiennes |
| `hostManager` | ‚úÖ | Partiel | ‚ùå | Maintenance syst√®me |
| `clusterAdmin` | ‚úÖ | ‚úÖ | ‚úÖ | Admin infrastructure |

### R√¥les Sp√©ciaux

| R√¥le | Port√©e | Niveau Privil√®ge | Usage |
|------|--------|------------------|-------|
| `backup` | Cluster | Lecture compl√®te | Backups |
| `restore` | Cluster | √âcriture compl√®te | Restaurations |
| `root` | Cluster | **MAXIMUM** | Urgences uniquement |

## Patterns de Combinaison

### Pattern 1 : DBA Complet

```javascript
use admin
db.createUser({
  user: "dba_complete",
  pwd: passwordPrompt(),
  roles: [
    { role: "readWriteAnyDatabase", db: "admin" },
    { role: "dbAdminAnyDatabase", db: "admin" },
    { role: "clusterAdmin", db: "admin" }
  ]
})
```

**Permissions** :
- Lecture/√©criture sur toutes les bases
- Administration de toutes les bases
- Gestion compl√®te du cluster

**Utilisation** : DBA principal, op√©rations quotidiennes

### Pattern 2 : Admin S√©curit√©

```javascript
use admin
db.createUser({
  user: "security_admin",
  pwd: passwordPrompt(),
  roles: [
    { role: "userAdminAnyDatabase", db: "admin" },
    { role: "readAnyDatabase", db: "admin" }
  ]
})
```

**Permissions** :
- Gestion des utilisateurs et r√¥les globalement
- Lecture pour audit et v√©rification

**Utilisation** : √âquipe s√©curit√©, IAM

### Pattern 3 : Monitoring Complet

```javascript
use admin
db.createUser({
  user: "monitoring_full",
  pwd: passwordPrompt(),
  roles: [
    { role: "clusterMonitor", db: "admin" },
    { role: "readAnyDatabase", db: "admin" }
  ]
})
```

**Permissions** :
- Monitoring cluster
- Lecture de toutes les bases pour m√©triques

**Utilisation** : Prometheus, Datadog, New Relic

### Pattern 4 : Backup/Restore Service

```javascript
use admin
db.createUser({
  user: "backup_restore",
  pwd: passwordPrompt(),
  roles: [
    { role: "backup", db: "admin" },
    { role: "restore", db: "admin" },
    { role: "clusterMonitor", db: "admin" }
  ]
})
```

**Permissions** :
- Backup complet
- Restauration compl√®te
- Monitoring pour v√©rifications

**Utilisation** : Services de backup automatis√©s

### Pattern 5 : Application Multi-Base

```javascript
use admin
db.createUser({
  user: "multi_tenant_app",
  pwd: passwordPrompt(),
  roles: [
    { role: "readWrite", db: "tenant_001" },
    { role: "readWrite", db: "tenant_002" },
    { role: "readWrite", db: "tenant_003" },
    { role: "read", db: "shared_data" }
  ]
})
```

**Permissions** :
- Lecture/√©criture sur bases tenants sp√©cifiques
- Lecture seule sur donn√©es partag√©es

**Utilisation** : Applications SaaS multi-tenant

### Pattern 6 : D√©veloppeur avec Admin

```javascript
use development
db.createUser({
  user: "developer_john",
  pwd: passwordPrompt(),
  roles: [
    { role: "dbOwner", db: "development" }
  ]
})
```

**Permissions** :
- Contr√¥le total sur la base de d√©veloppement
- Pas d'acc√®s aux autres bases

**Utilisation** : Environnements de d√©veloppement

## Recommandations de Production

### 1. Principe du Moindre Privil√®ge

```javascript
// ‚ùå MAUVAIS : Trop de permissions
db.createUser({
  user: "webapp",
  pwd: "password",
  roles: [{ role: "root", db: "admin" }]
})

// ‚úÖ BON : Permissions minimales
db.createUser({
  user: "webapp",
  pwd: passwordPrompt(),
  roles: [{ role: "readWrite", db: "production" }]
})
```

### 2. √âviter les R√¥les `*AnyDatabase` pour Applications

```javascript
// ‚ùå MAUVAIS
roles: [{ role: "readWriteAnyDatabase", db: "admin" }]

// ‚úÖ BON
roles: [
  { role: "readWrite", db: "app_database" },
  { role: "read", db: "reference_data" }
]
```

### 3. Ne Jamais Utiliser `root` en Production

```javascript
// ‚ùå INTERDIT
roles: [{ role: "root", db: "admin" }]

// ‚úÖ RECOMMAND√â : Utiliser des r√¥les sp√©cifiques
roles: [
  { role: "readWriteAnyDatabase", db: "admin" },
  { role: "dbAdminAnyDatabase", db: "admin" }
]
```

### 4. S√©parer Lecture et √âcriture

```javascript
// Application lecture seule
db.createUser({
  user: "app_readonly",
  pwd: passwordPrompt(),
  roles: [{ role: "read", db: "production" }]
})

// Application avec √©criture
db.createUser({
  user: "app_readwrite",
  pwd: passwordPrompt(),
  roles: [{ role: "readWrite", db: "production" }]
})
```

### 5. Comptes D√©di√©s par Fonction

```javascript
// Monitoring
db.createUser({
  user: "monitoring",
  pwd: passwordPrompt(),
  roles: [
    { role: "clusterMonitor", db: "admin" },
    { role: "read", db: "production" }
  ]
})

// Backup
db.createUser({
  user: "backup",
  pwd: passwordPrompt(),
  roles: [{ role: "backup", db: "admin" }]
})

// Application
db.createUser({
  user: "application",
  pwd: passwordPrompt(),
  roles: [{ role: "readWrite", db: "production" }]
})
```

### 6. Audit R√©gulier des Permissions

```javascript
// Script d'audit
use admin

function auditHighPrivilegeUsers() {
  const dangerousRoles = ['root', 'dbOwner', 'userAdminAnyDatabase',
                          'readWriteAnyDatabase', 'clusterAdmin'];

  db.system.users.find().forEach(user => {
    const hasHighPrivilege = user.roles.some(role =>
      dangerousRoles.includes(role.role)
    );

    if (hasHighPrivilege) {
      print(`‚ö†Ô∏è  High privilege user: ${user.user}@${user.db}`);
      print(`   Roles: ${JSON.stringify(user.roles)}`);
    }
  });
}

auditHighPrivilegeUsers();
```

## Pi√®ges Courants

### 1. Confondre `dbAdmin` et `readWrite`

```javascript
// ‚ùå ERREUR : dbAdmin seul ne peut pas lire/√©crire les donn√©es
db.createUser({
  user: "maintenance",
  pwd: "password",
  roles: [{ role: "dbAdmin", db: "production" }]
})

// Cette commande √âCHOUERA :
db.orders.find()  // ‚ùå Pas de permission read

// ‚úÖ CORRECT : Combiner les r√¥les
roles: [
  { role: "readWrite", db: "production" },
  { role: "dbAdmin", db: "production" }
]
```

### 2. Cr√©er `userAdmin` dans Mauvaise Base

```javascript
// ‚ùå ERREUR : userAdmin dans la base applicative
use production
db.createUser({
  user: "user_manager",
  pwd: "password",
  roles: [{ role: "userAdmin", db: "production" }]
})

// Peut seulement g√©rer users de "production"
// Pas d'acc√®s √† admin ou autres bases

// ‚úÖ CORRECT : Pour gestion globale
use admin
db.createUser({
  user: "user_manager",
  pwd: passwordPrompt(),
  roles: [{ role: "userAdminAnyDatabase", db: "admin" }]
})
```

### 3. Oublier `authSource` lors Connexion

```bash
# ‚ùå ERREUR : Ne sp√©cifie pas authSource
mongosh -u dba_user -p

# ‚úÖ CORRECT
mongosh -u dba_user -p --authenticationDatabase admin
```

### 4. Utiliser `root` pour Scripts Automatis√©s

```javascript
// ‚ùå DANGER
db.createUser({
  user: "backup_script",
  pwd: "password",
  roles: [{ role: "root", db: "admin" }]
})

// ‚úÖ CORRECT : Permissions sp√©cifiques
roles: [
  { role: "backup", db: "admin" },
  { role: "clusterMonitor", db: "admin" }
]
```

## Conclusion

Les r√¥les int√©gr√©s MongoDB offrent une base solide pour la gestion des permissions :

**Principes cl√©s** :
- ‚úÖ Utiliser les r√¥les int√©gr√©s quand possible (test√©s et maintenus)
- ‚úÖ Appliquer le principe du moindre privil√®ge syst√©matiquement
- ‚úÖ √âviter `root` et r√¥les `*AnyDatabase` en production
- ‚úÖ Combiner les r√¥les pour besoins sp√©cifiques
- ‚úÖ Auditer r√©guli√®rement les permissions
- ‚úÖ S√©parer les comptes par fonction

**Hi√©rarchie des r√¥les par puissance** :
1. `read` / `readWrite` - Base unique
2. `dbAdmin` / `userAdmin` - Administration base unique
3. `readAnyDatabase` / `readWriteAnyDatabase` - Toutes bases
4. `clusterMonitor` / `clusterManager` - Cluster management
5. `backup` / `restore` - Backup/restore
6. `dbOwner` - Propri√©taire base
7. `clusterAdmin` - Admin cluster complet
8. `root` - **TOUT** (√† √©viter)

**Recommandation finale** : Commencer avec les r√¥les int√©gr√©s, cr√©er des r√¥les personnalis√©s uniquement si les r√¥les built-in ne suffisent pas.

---

**Prochaine Section** :
- **11.3.2** : R√¥les personnalis√©s - Cr√©ation et gestion de r√¥les m√©tier sp√©cifiques

‚è≠Ô∏è [R√¥les personnalis√©s](/11-securite/03.2-roles-personnalises.md)
