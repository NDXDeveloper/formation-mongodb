üîù Retour au [Sommaire](/SOMMAIRE.md)

# 2.5.2 find() et findOne()

## Introduction

Apr√®s avoir appris √† ins√©rer des documents, d√©couvrons maintenant comment les **rechercher** et les **lire**. C'est l'op√©ration la plus fr√©quente dans une base de donn√©es : lire les donn√©es stock√©es.

> **üí° Analogie :** Si `insert` est comme ranger des livres dans une biblioth√®que, `find` est comme chercher et consulter ces livres.

Dans cette section, nous allons explorer :
- Comment rechercher un document avec `findOne()`
- Comment rechercher plusieurs documents avec `find()`
- Les filtres de base pour affiner vos recherches
- Les projections pour s√©lectionner les champs
- La pagination et la limitation des r√©sultats
- Les diff√©rences avec SQL SELECT

---

## findOne() : Trouver un Seul Document

### Syntaxe de Base

```javascript
db.collection.findOne(filtre, projection)
```

**Param√®tres :**
- `filtre` : Crit√®res de recherche (objet JavaScript)
- `projection` : Champs √† retourner (optionnel)

**Retour :**
- Le **premier document** qui correspond aux crit√®res
- `null` si aucun document ne correspond

### Exemple le Plus Simple

```javascript
// Trouver n'importe quel document (le premier)
db.utilisateurs.findOne()
```

**R√©sultat :**
```javascript
{
  _id: ObjectId("6565d7d8f2a3b4c5d6e7f8a9"),
  nom: "Dupont",
  email: "dupont@example.com",
  age: 30
}
```

**‚ö†Ô∏è Sans filtre :** MongoDB retourne le **premier** document trouv√© (ordre non garanti).

### Recherche par _id

**Le cas le plus courant : rechercher par identifiant.**

```javascript
// Recherche par ObjectId
db.utilisateurs.findOne({
  _id: ObjectId("6565d7d8f2a3b4c5d6e7f8a9")
})
```

**R√©sultat :**
```javascript
{
  _id: ObjectId("6565d7d8f2a3b4c5d6e7f8a9"),
  nom: "Dupont",
  email: "dupont@example.com",
  age: 30
}
```

**Si l'_id est un autre type :**
```javascript
// _id de type String
db.produits.findOne({ _id: "PROD-001" })

// _id de type Integer
db.commandes.findOne({ _id: 12345 })
```

### Recherche par un Champ

```javascript
// Rechercher par email
db.utilisateurs.findOne({ email: "dupont@example.com" })

// Rechercher par nom
db.utilisateurs.findOne({ nom: "Dupont" })

// Rechercher par √¢ge
db.utilisateurs.findOne({ age: 30 })
```

### Recherche avec Plusieurs Crit√®res

**Tous les crit√®res doivent √™tre remplis (ET logique) :**

```javascript
// Nom = "Dupont" ET √¢ge = 30
db.utilisateurs.findOne({
  nom: "Dupont",
  age: 30
})

// Email ET statut actif
db.utilisateurs.findOne({
  email: "dupont@example.com",
  actif: true
})
```

### Document Non Trouv√©

```javascript
// Si aucun document ne correspond
let resultat = db.utilisateurs.findOne({ nom: "Inexistant" })

print(resultat)  // null
```

**Gestion dans votre code :**
```javascript
let user = db.utilisateurs.findOne({ email: "test@example.com" })

if (user === null) {
  print("Utilisateur non trouv√©")
} else {
  print("Utilisateur trouv√© : " + user.nom)
}
```

---

## find() : Trouver Plusieurs Documents

### Syntaxe de Base

```javascript
db.collection.find(filtre, projection)
```

**Param√®tres :**
- `filtre` : Crit√®res de recherche (objet JavaScript)
- `projection` : Champs √† retourner (optionnel)

**Retour :**
- Un **curseur** (pointeur vers les r√©sultats)
- Pas directement les documents !

### Qu'est-ce qu'un Curseur ?

> **üí° Important :** `find()` ne retourne PAS directement les documents, mais un **curseur**.

**Un curseur est comme un pointeur** vers les r√©sultats. Vous devez l'it√©rer pour voir les documents.

```javascript
// find() retourne un curseur
let curseur = db.utilisateurs.find()

// It√©rer sur le curseur
curseur.forEach(doc => {
  print(doc.nom)
})
```

**En pratique dans mongosh :**
```javascript
// mongosh affiche automatiquement les 20 premiers r√©sultats
db.utilisateurs.find()

// Taper "it" (iterate) pour voir les 20 suivants
it
```

### Trouver Tous les Documents

```javascript
// Tous les documents de la collection
db.utilisateurs.find()

// √âquivalent √†
db.utilisateurs.find({})
```

**Sortie (dans mongosh) :**
```javascript
[
  {
    _id: ObjectId("..."),
    nom: "Dupont",
    email: "dupont@example.com",
    age: 30
  },
  {
    _id: ObjectId("..."),
    nom: "Martin",
    email: "martin@example.com",
    age: 25
  },
  // ... jusqu'√† 20 documents
]
```

### Convertir le Curseur en Tableau

```javascript
// M√©thode 1 : toArray()
let utilisateurs = db.utilisateurs.find().toArray()
print(utilisateurs.length)  // Nombre de documents

// M√©thode 2 : Boucle
db.utilisateurs.find().forEach(user => {
  print(user.nom)
})
```

**‚ö†Ô∏è Attention avec toArray() :**
- Charge TOUS les documents en m√©moire
- Peut causer des probl√®mes avec de grosses collections
- Utilisez `.limit()` pour limiter

### Recherche avec un Filtre

```javascript
// Tous les utilisateurs qui ont 30 ans
db.utilisateurs.find({ age: 30 })

// Tous les utilisateurs de Paris
db.utilisateurs.find({ ville: "Paris" })

// Tous les produits en stock
db.produits.find({ enStock: true })
```

### Recherche avec Plusieurs Crit√®res

```javascript
// √Çge = 30 ET ville = Paris
db.utilisateurs.find({
  age: 30,
  ville: "Paris"
})

// Statut = "active" ET r√¥le = "admin"
db.utilisateurs.find({
  statut: "active",
  role: "admin"
})
```

---

## Diff√©rences findOne() vs find()

### Tableau Comparatif

| Aspect | findOne() | find() |
|--------|-----------|--------|
| **Retour** | 1 document ou null | Curseur |
| **Nombre de r√©sultats** | Maximum 1 | 0 √† N |
| **Performance** | Plus rapide | Variable |
| **Usage** | Document sp√©cifique | Plusieurs documents |
| **M√©moire** | Faible | Potentiellement √©lev√©e |

### Exemples Comparatifs

**findOne() :**
```javascript
// Retourne UN document
let user = db.utilisateurs.findOne({ email: "dupont@example.com" })
print(user.nom)  // Acc√®s direct
```

**find() :**
```javascript
// Retourne un CURSEUR
let curseur = db.utilisateurs.find({ age: 30 })

// Doit √™tre it√©r√©
curseur.forEach(user => {
  print(user.nom)
})

// Ou converti en tableau
let users = curseur.toArray()
print(users[0].nom)  // Acc√®s avec index
```

### Quand Utiliser Quoi ?

**Utilisez `findOne()` quand :**
- ‚úÖ Vous cherchez **un document sp√©cifique** (par _id, email unique, etc.)
- ‚úÖ Vous savez qu'il y a **au maximum un r√©sultat**
- ‚úÖ Vous voulez le **premier document** qui correspond

**Utilisez `find()` quand :**
- ‚úÖ Vous cherchez **plusieurs documents**
- ‚úÖ Vous ne savez pas combien de r√©sultats attendre
- ‚úÖ Vous voulez **tous les documents** d'une collection
- ‚úÖ Vous voulez **parcourir** les r√©sultats

---

## Projections : S√©lectionner les Champs

### Qu'est-ce qu'une Projection ?

> **üí° D√©finition :** Une projection permet de choisir quels champs retourner (ou exclure).

**Avantages :**
- üöÄ R√©duit la quantit√© de donn√©es transf√©r√©es
- ‚ö° Am√©liore les performances
- üéØ Retourne uniquement ce dont vous avez besoin

### Syntaxe

```javascript
db.collection.find(
  filtre,
  { champ1: 1, champ2: 1, champ3: 0 }
)
```

**Valeurs :**
- `1` ou `true` : **Inclure** le champ
- `0` ou `false` : **Exclure** le champ

### Inclusion de Champs

```javascript
// Retourner uniquement nom et email
db.utilisateurs.findOne(
  { _id: ObjectId("...") },
  { nom: 1, email: 1 }
)
```

**R√©sultat :**
```javascript
{
  _id: ObjectId("..."),  // _id est TOUJOURS inclus par d√©faut
  nom: "Dupont",
  email: "dupont@example.com"
  // age, ville, etc. ne sont PAS retourn√©s
}
```

### Exclusion de Champs

```javascript
// Retourner tout SAUF le mot de passe
db.utilisateurs.findOne(
  { email: "dupont@example.com" },
  { motDePasse: 0 }
)
```

**R√©sultat :**
```javascript
{
  _id: ObjectId("..."),
  nom: "Dupont",
  email: "dupont@example.com",
  age: 30,
  ville: "Paris"
  // motDePasse n'est PAS retourn√©
}
```

### Exclure le Champ _id

```javascript
// Retourner nom et email, sans _id
db.utilisateurs.findOne(
  { email: "dupont@example.com" },
  { nom: 1, email: 1, _id: 0 }
)
```

**R√©sultat :**
```javascript
{
  nom: "Dupont",
  email: "dupont@example.com"
  // Pas d'_id
}
```

### R√®gle Importante

**‚ö†Ô∏è Vous ne pouvez PAS m√©langer inclusion et exclusion (sauf pour _id) :**

```javascript
// ‚ùå Erreur : M√©lange inclusion/exclusion
db.utilisateurs.find(
  {},
  { nom: 1, motDePasse: 0 }
)
// MongoServerError: Cannot do exclusion on field motDePasse in inclusion projection

// ‚úÖ Correct : Seulement inclusion (+ _id: 0 autoris√©)
db.utilisateurs.find(
  {},
  { nom: 1, email: 1, _id: 0 }
)

// ‚úÖ Correct : Seulement exclusion
db.utilisateurs.find(
  {},
  { motDePasse: 0 }
)
```

### Projections sur Champs Imbriqu√©s

```javascript
// Document
{
  nom: "Dupont",
  adresse: {
    rue: "123 Rue Example",
    ville: "Paris",
    codePostal: "75001"
  }
}

// Projection : seulement la ville
db.utilisateurs.findOne(
  { nom: "Dupont" },
  { "adresse.ville": 1, nom: 1 }
)

// R√©sultat
{
  _id: ObjectId("..."),
  nom: "Dupont",
  adresse: {
    ville: "Paris"
  }
}
```

---

## Limiter les R√©sultats

### M√©thode limit()

**Limiter le nombre de documents retourn√©s :**

```javascript
// Les 5 premiers utilisateurs
db.utilisateurs.find().limit(5)

// Les 10 premiers produits
db.produits.find().limit(10)
```

**Tr√®s utile pour :**
- üìÑ Pagination
- üéØ Aper√ßu rapide des donn√©es
- ‚ö° √âviter de charger trop de donn√©es

### M√©thode skip()

**Sauter des documents :**

```javascript
// Sauter les 10 premiers, retourner les 5 suivants
db.utilisateurs.find().skip(10).limit(5)
```

### Pagination Simple

```javascript
// Page 1 : documents 0-9
db.articles.find().skip(0).limit(10)

// Page 2 : documents 10-19
db.articles.find().skip(10).limit(10)

// Page 3 : documents 20-29
db.articles.find().skip(20).limit(10)

// Formule g√©n√©rale
const page = 2
const parPage = 10
db.articles.find()
  .skip((page - 1) * parPage)
  .limit(parPage)
```

### Compter les R√©sultats

```javascript
// Nombre total de documents
db.utilisateurs.countDocuments()

// Nombre de documents correspondant √† un filtre
db.utilisateurs.countDocuments({ age: 30 })

// Nombre de documents actifs
db.utilisateurs.countDocuments({ actif: true })
```

---

## Op√©rateurs de Comparaison de Base

### √âgalit√© (implicite)

```javascript
// √âgalit√© simple (implicite)
db.utilisateurs.find({ age: 30 })

// √âquivalent explicite avec $eq
db.utilisateurs.find({ age: { $eq: 30 } })
```

### In√©galit√© ($ne)

```javascript
// √Çge diff√©rent de 30
db.utilisateurs.find({ age: { $ne: 30 } })

// Statut diff√©rent de "inactif"
db.utilisateurs.find({ statut: { $ne: "inactif" } })
```

### Sup√©rieur et Inf√©rieur

```javascript
// $gt : Greater Than (>)
db.produits.find({ prix: { $gt: 100 } })  // Prix > 100

// $gte : Greater Than or Equal (‚â•)
db.produits.find({ prix: { $gte: 100 } })  // Prix ‚â• 100

// $lt : Less Than (<)
db.produits.find({ prix: { $lt: 50 } })  // Prix < 50

// $lte : Less Than or Equal (‚â§)
db.produits.find({ prix: { $lte: 50 } })  // Prix ‚â§ 50
```

### Plages de Valeurs

```javascript
// Prix entre 50 et 100
db.produits.find({
  prix: { $gte: 50, $lte: 100 }
})

// √Çge entre 18 et 65
db.utilisateurs.find({
  age: { $gte: 18, $lte: 65 }
})
```

### Op√©rateur $in

**Rechercher parmi plusieurs valeurs possibles :**

```javascript
// Ville = Paris OU Lyon OU Marseille
db.utilisateurs.find({
  ville: { $in: ["Paris", "Lyon", "Marseille"] }
})

// √Çge = 25 OU 30 OU 35
db.utilisateurs.find({
  age: { $in: [25, 30, 35] }
})

// Cat√©gorie parmi une liste
db.produits.find({
  categorie: { $in: ["Informatique", "√âlectronique", "T√©l√©phonie"] }
})
```

### Op√©rateur $nin (Not In)

```javascript
// Ville diff√©rente de Paris, Lyon et Marseille
db.utilisateurs.find({
  ville: { $nin: ["Paris", "Lyon", "Marseille"] }
})
```

---

## Recherche sur Champs Imbriqu√©s

### Dot Notation

**Pour acc√©der aux champs imbriqu√©s, utilisez la notation point√©e :**

```javascript
// Document
{
  nom: "Dupont",
  adresse: {
    rue: "123 Rue Example",
    ville: "Paris",
    codePostal: "75001"
  }
}

// Rechercher par ville dans adresse
db.utilisateurs.find({ "adresse.ville": "Paris" })

// Rechercher par code postal
db.utilisateurs.find({ "adresse.codePostal": "75001" })
```

**‚ö†Ô∏è Important :** Mettez les cl√©s avec points entre guillemets !

### Plusieurs Niveaux d'Imbrication

```javascript
// Document
{
  entreprise: {
    siege: {
      adresse: {
        ville: "Paris"
      }
    }
  }
}

// Recherche multi-niveaux
db.clients.find({
  "entreprise.siege.adresse.ville": "Paris"
})
```

---

## Recherche dans les Tableaux

### Recherche d'√âl√©ment

**MongoDB recherche automatiquement dans les tableaux :**

```javascript
// Document
{
  nom: "Jean",
  competences: ["JavaScript", "Python", "MongoDB"]
}

// Trouver tous ceux qui ont "MongoDB" dans leurs comp√©tences
db.developpeurs.find({ competences: "MongoDB" })
// Trouve Jean (m√™me si "MongoDB" est dans un tableau)
```

### Tableau Exact

```javascript
// Tableau EXACTEMENT ["JavaScript", "Python"] dans cet ordre
db.developpeurs.find({
  competences: ["JavaScript", "Python"]
})
// Ne trouve PAS si le tableau a plus d'√©l√©ments ou ordre diff√©rent
```

### Recherche dans Tableau de Documents

```javascript
// Document
{
  nom: "Article 1",
  commentaires: [
    { auteur: "Alice", texte: "Super !" },
    { auteur: "Bob", texte: "Pas mal" }
  ]
}

// Trouver les articles avec un commentaire d'Alice
db.articles.find({ "commentaires.auteur": "Alice" })
```

---

## Exemples Pratiques par Secteur

### Blog : Rechercher des Articles

```javascript
use blog

// Tous les articles publi√©s
db.articles.find({ publie: true })

// Articles d'un auteur sp√©cifique
db.articles.find({
  "auteur.nom": "Marie Dupont"
})

// Articles d'une cat√©gorie
db.articles.find({
  categorie: "Tutoriels"
})

// Articles avec un tag sp√©cifique
db.articles.find({
  tags: "MongoDB"
})

// Articles publi√©s apr√®s une certaine date
db.articles.find({
  datePublication: { $gte: ISODate("2024-01-01") }
})

// Dernier article publi√©
db.articles.findOne(
  { publie: true },
  { titre: 1, datePublication: 1 }
).sort({ datePublication: -1 })
```

### E-commerce : Rechercher des Produits

```javascript
use boutique

// Produits en stock
db.produits.find({ enStock: true })

// Produits d'une cat√©gorie
db.produits.find({ categorie: "Informatique" })

// Produits dans une fourchette de prix
db.produits.find({
  prix: { $gte: 50, $lte: 200 }
})

// Produits en promotion
db.produits.find({ enPromotion: true })

// Produits d'une marque sp√©cifique
db.produits.find({ marque: "Apple" })

// Produits avec plus de X avis
db.produits.find({
  nombreAvis: { $gte: 100 }
})

// Produits avec bonne notation
db.produits.find({
  notation: { $gte: 4.5 }
})
```

### Application de Gestion : Rechercher des T√¢ches

```javascript
use gestion_taches

// T√¢ches √† faire
db.taches.find({ statut: "a_faire" })

// T√¢ches assign√©es √† un utilisateur
db.taches.find({
  assigneA: ObjectId("...")
})

// T√¢ches prioritaires
db.taches.find({ priorite: "haute" })

// T√¢ches d'un projet sp√©cifique
db.taches.find({
  projet: ObjectId("...")
})

// T√¢ches en retard
db.taches.find({
  dateEcheance: { $lt: new Date() },
  statut: { $ne: "termine" }
})

// Ma t√¢che suivante (prioritaire non termin√©e)
db.taches.findOne({
  assigneA: ObjectId("..."),
  statut: { $ne: "termine" }
})
```

### R√©seau Social : Rechercher des Utilisateurs

```javascript
use reseau_social

// Utilisateurs actifs
db.utilisateurs.find({ actif: true })

// Utilisateurs d'une ville
db.utilisateurs.find({ ville: "Paris" })

// Utilisateurs ayant un certain nombre d'abonn√©s
db.utilisateurs.find({
  nombreAbonnes: { $gte: 1000 }
})

// Utilisateurs avec un int√©r√™t sp√©cifique
db.utilisateurs.find({
  interets: "photographie"
})

// Utilisateurs inscrits ce mois-ci
db.utilisateurs.find({
  dateInscription: {
    $gte: ISODate("2024-12-01"),
    $lt: ISODate("2025-01-01")
  }
})
```

---

## Affichage et Formatage

### Pretty Print

**Dans mongosh, utilisez `.pretty()` pour un affichage format√© :**

```javascript
// Sans formatage (ligne unique)
db.utilisateurs.find()

// Avec formatage (indent√©, lisible)
db.utilisateurs.find().pretty()
```

**Note :** Dans les versions r√©centes de mongosh, `.pretty()` est appliqu√© automatiquement !

### forEach pour Affichage Personnalis√©

```javascript
// Affichage personnalis√©
db.utilisateurs.find().forEach(user => {
  print(`${user.nom} - ${user.email}`)
})

// Sortie :
// Dupont - dupont@example.com
// Martin - martin@example.com
// Bernard - bernard@example.com
```

### Affichage Conditionnel

```javascript
db.utilisateurs.find().forEach(user => {
  if (user.age >= 18) {
    print(`${user.nom} est majeur (${user.age} ans)`)
  } else {
    print(`${user.nom} est mineur (${user.age} ans)`)
  }
})
```

---

## Performance et Bonnes Pratiques

### ‚úÖ √Ä Faire

1. **Utilisez des filtres sp√©cifiques**
   ```javascript
   // ‚úÖ Bon : Filtre pr√©cis
   db.users.find({ email: "dupont@example.com" })

   // ‚ùå Mauvais : R√©cup√®re tout puis filtre
   db.users.find().toArray().filter(u => u.email === "dupont@example.com")
   ```

2. **Utilisez des projections**
   ```javascript
   // ‚úÖ Bon : Seulement les champs n√©cessaires
   db.users.find({}, { nom: 1, email: 1 })

   // ‚ùå Mauvais : R√©cup√®re tout
   db.users.find()
   ```

3. **Utilisez findOne() quand appropri√©**
   ```javascript
   // ‚úÖ Bon : findOne pour un seul r√©sultat
   db.users.findOne({ _id: ObjectId("...") })

   // ‚ùå Mauvais : find avec limit
   db.users.find({ _id: ObjectId("...") }).limit(1)
   ```

4. **Limitez les r√©sultats**
   ```javascript
   // ‚úÖ Bon : Limite explicite
   db.logs.find().limit(100)

   // ‚ùå Mauvais : Pas de limite sur grosse collection
   db.logs.find().toArray()  // Peut charger des millions de docs !
   ```

5. **Utilisez countDocuments() plut√¥t que .length**
   ```javascript
   // ‚úÖ Bon : Performant
   db.users.countDocuments({ age: 30 })

   // ‚ùå Mauvais : R√©cup√®re tout puis compte
   db.users.find({ age: 30 }).toArray().length
   ```

### ‚ùå √Ä √âviter

1. **√âvitez toArray() sans limite**
   ```javascript
   // ‚ùå Dangereux sur grosse collection
   let tous = db.users.find().toArray()

   // ‚úÖ Bon : Limitez ou it√©rez
   db.users.find().limit(100).toArray()
   // Ou
   db.users.find().forEach(user => { /* traiter */ })
   ```

2. **N'utilisez pas de regex sur des champs non index√©s**
   ```javascript
   // ‚ö†Ô∏è Lent sans index
   db.users.find({ nom: /^Dup/ })

   // ‚úÖ Cr√©ez un index texte si n√©cessaire
   db.users.createIndex({ nom: "text" })
   ```

3. **√âvitez les projections complexes non n√©cessaires**
   ```javascript
   // ‚ùå Trop complexe si pas n√©cessaire
   db.users.find({}, {
     "adresse.rue": 1,
     "adresse.ville": 1,
     "contact.email": 1,
     // ... 20 champs
   })

   // ‚úÖ Simple
   db.users.find({}, { nom: 1, email: 1 })
   ```

---

## Comparaison avec SQL

### SQL SELECT

```sql
-- Tous les enregistrements
SELECT * FROM utilisateurs;

-- Un seul enregistrement
SELECT * FROM utilisateurs WHERE id = 1;

-- Avec condition
SELECT * FROM utilisateurs WHERE age = 30;

-- Avec plusieurs conditions
SELECT * FROM utilisateurs
WHERE age >= 18 AND ville = 'Paris';

-- Colonnes sp√©cifiques
SELECT nom, email FROM utilisateurs;

-- Avec limite
SELECT * FROM utilisateurs LIMIT 10;

-- Avec pagination
SELECT * FROM utilisateurs LIMIT 10 OFFSET 20;
```

### MongoDB find/findOne

```javascript
// Tous les documents
db.utilisateurs.find()

// Un seul document
db.utilisateurs.findOne({ _id: ObjectId("...") })

// Avec condition
db.utilisateurs.find({ age: 30 })

// Avec plusieurs conditions
db.utilisateurs.find({
  age: { $gte: 18 },
  ville: "Paris"
})

// Champs sp√©cifiques (projection)
db.utilisateurs.find({}, { nom: 1, email: 1 })

// Avec limite
db.utilisateurs.find().limit(10)

// Avec pagination
db.utilisateurs.find().skip(20).limit(10)
```

**Avantages MongoDB :**
- ‚úÖ Syntaxe plus concise
- ‚úÖ Support natif des objets imbriqu√©s
- ‚úÖ Recherche directe dans les tableaux
- ‚úÖ Pas de jointures n√©cessaires (documents auto-suffisants)

---

## M√©thodes de Curseur Utiles

### Cha√Ænage de M√©thodes

```javascript
// Combiner plusieurs m√©thodes
db.articles.find({ publie: true })
  .sort({ datePublication: -1 })
  .limit(10)
  .projection({ titre: 1, auteur: 1 })
```

### M√©thodes Principales

| M√©thode | Description | Exemple |
|---------|-------------|---------|
| `.limit(n)` | Limiter √† n documents | `.limit(10)` |
| `.skip(n)` | Sauter n documents | `.skip(20)` |
| `.sort()` | Trier les r√©sultats | `.sort({ age: 1 })` |
| `.count()` | Compter (d√©pr√©ci√©) | `.count()` |
| `.toArray()` | Convertir en tableau | `.toArray()` |
| `.forEach()` | It√©rer sur chaque doc | `.forEach(fn)` |
| `.pretty()` | Formatage lisible | `.pretty()` |

### Exemples de Cha√Ænage

```javascript
// Top 5 des produits les plus chers
db.produits.find({ enStock: true })
  .sort({ prix: -1 })
  .limit(5)

// Page 3 des utilisateurs actifs (10 par page)
db.utilisateurs.find({ actif: true })
  .sort({ dateInscription: -1 })
  .skip(20)
  .limit(10)

// Derniers articles avec titre et date uniquement
db.articles.find({ publie: true })
  .projection({ titre: 1, datePublication: 1 })
  .sort({ datePublication: -1 })
  .limit(5)
```

---

## V√©rifier l'Existence

### V√©rifier si un Document Existe

```javascript
// M√©thode 1 : findOne et v√©rifier null
let user = db.utilisateurs.findOne({ email: "test@example.com" })
if (user === null) {
  print("N'existe pas")
} else {
  print("Existe")
}

// M√©thode 2 : countDocuments
let count = db.utilisateurs.countDocuments({ email: "test@example.com" })
if (count === 0) {
  print("N'existe pas")
} else {
  print("Existe")
}

// M√©thode 3 : Pour juste tester l'existence (plus performant)
let existe = db.utilisateurs.findOne(
  { email: "test@example.com" },
  { _id: 1 }
) !== null
```

---

## Points Cl√©s √† Retenir

### ‚úÖ Essentiel

1. **findOne()** : Retourne UN document ou null
2. **find()** : Retourne un CURSEUR (pas directement les documents)
3. **Filtres** : Objet JavaScript avec crit√®res de recherche
4. **Projections** : S√©lectionner les champs √† retourner
5. **Op√©rateurs** : $gt, $gte, $lt, $lte, $ne, $in, $nin
6. **Dot notation** : Pour acc√©der aux champs imbriqu√©s
7. **limit() et skip()** : Pour paginer les r√©sultats

### üéØ Syntaxe √† Retenir

```javascript
// Recherche simple
db.collection.findOne({ champ: valeur })
db.collection.find({ champ: valeur })

// Avec projection
db.collection.find(
  { champ: valeur },
  { champ1: 1, champ2: 1, _id: 0 }
)

// Avec op√©rateurs
db.collection.find({
  age: { $gte: 18, $lte: 65 },
  ville: { $in: ["Paris", "Lyon"] }
})

// Avec limite et pagination
db.collection.find()
  .skip(20)
  .limit(10)
```

### ‚ö†Ô∏è Pi√®ges Courants

- find() retourne un curseur, pas les documents directement
- _id est toujours inclus sauf si explicitement exclu
- Ne pas m√©langer inclusion et exclusion dans les projections
- toArray() charge tout en m√©moire (attention aux grosses collections)
- Les filtres dans find() sont √©valu√©s c√¥t√© serveur (performant)

---

## Prochaines √âtapes

Maintenant que vous savez rechercher des documents, apprenons √† les modifier :

‚û°Ô∏è **2.5.3 updateOne() et updateMany()** : Mettre √† jour vos documents

La lecture est ma√Ætris√©e, passons √† la modification !

---

## Ressources Compl√©mentaires

### Documentation Officielle

- [find() - MongoDB Manual](https://docs.mongodb.com/manual/reference/method/db.collection.find/)
- [findOne() - MongoDB Manual](https://docs.mongodb.com/manual/reference/method/db.collection.findOne/)
- [Query Operators](https://docs.mongodb.com/manual/reference/operator/query/)
- [Projection](https://docs.mongodb.com/manual/tutorial/project-fields-from-query-results/)

### Pour Aller Plus Loin

- Op√©rateurs de requ√™te avanc√©s ($and, $or, $not)
- Expressions r√©guli√®res pour recherche textuelle
- Op√©rateurs sur les tableaux ($all, $elemMatch, $size)
- Index pour optimiser les recherches

---


‚è≠Ô∏è [updateOne() et updateMany()](/02-fondamentaux-de-mongodb/05.3-update.md)
