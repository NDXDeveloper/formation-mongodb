ğŸ” Retour au [Sommaire](/SOMMAIRE.md)

# 1.4.1 Le thÃ©orÃ¨me CAP (Consistency, Availability, Partition tolerance)

## Introduction

Le **thÃ©orÃ¨me CAP** est un concept fondamental en informatique distribuÃ©e. Comprendre ce thÃ©orÃ¨me vous aidera Ã  saisir pourquoi les bases de donnÃ©es comme MongoDB font certains choix architecturaux et comment elles gÃ¨rent les compromis entre cohÃ©rence des donnÃ©es, disponibilitÃ© et tolÃ©rance aux pannes.

Ce thÃ©orÃ¨me, formulÃ© par l'informaticien **Eric Brewer** en 2000 et prouvÃ© mathÃ©matiquement par Seth Gilbert et Nancy Lynch en 2002, s'applique Ã  tout systÃ¨me distribuÃ©, c'est-Ã -dire un systÃ¨me dont les donnÃ©es sont rÃ©parties sur plusieurs machines connectÃ©es en rÃ©seau.

---

## Qu'est-ce qu'un systÃ¨me distribuÃ© ?

Avant d'aborder le thÃ©orÃ¨me CAP, clarifions ce qu'est un systÃ¨me distribuÃ©.

### SystÃ¨me centralisÃ© vs distribuÃ©

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            SystÃ¨me centralisÃ© vs SystÃ¨me distribuÃ©                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   SystÃ¨me CENTRALISÃ‰                 SystÃ¨me DISTRIBUÃ‰              â”‚
â”‚                                                                     â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚        â”‚ Serveur â”‚                  â”‚ NÅ“ud A  â”‚â”€â”€â”€â”‚ NÅ“ud B  â”‚       â”‚
â”‚        â”‚  unique â”‚                  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜       â”‚
â”‚        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                       â”‚             â”‚            â”‚
â”‚             â”‚                            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚                   â”‚
â”‚    â”‚        â”‚        â”‚                     â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”              â”‚
â”‚    â–¼        â–¼        â–¼                     â”‚ NÅ“ud C  â”‚              â”‚
â”‚  Client  Client  Client                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                 â”‚                   â”‚
â”‚   â€¢ Une seule machine                   â”Œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚   â€¢ Point unique de dÃ©faillance         â”‚      â”‚      â”‚             â”‚
â”‚   â€¢ ScalabilitÃ© limitÃ©e                 â–¼      â–¼      â–¼             â”‚
â”‚                                       Client Client Client          â”‚
â”‚                                                                     â”‚
â”‚                                      â€¢ Plusieurs machines           â”‚
â”‚                                      â€¢ DonnÃ©es rÃ©parties            â”‚
â”‚                                      â€¢ TolÃ©rance aux pannes         â”‚
â”‚                                      â€¢ ScalabilitÃ© horizontale      â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Pourquoi distribuer les donnÃ©es ?

| Raison | Explication |
|--------|-------------|
| **Haute disponibilitÃ©** | Si un serveur tombe, les autres prennent le relais |
| **Performance** | RÃ©partir la charge sur plusieurs machines |
| **ScalabilitÃ©** | Ajouter des serveurs pour gÃ©rer plus de donnÃ©es |
| **GÃ©o-distribution** | Rapprocher les donnÃ©es des utilisateurs |

---

## Le thÃ©orÃ¨me CAP expliquÃ©

### Ã‰noncÃ© du thÃ©orÃ¨me

Le thÃ©orÃ¨me CAP stipule qu'un systÃ¨me distribuÃ© ne peut garantir **simultanÃ©ment** que **deux des trois propriÃ©tÃ©s** suivantes :

- **C**onsistency (CohÃ©rence)
- **A**vailability (DisponibilitÃ©)
- **P**artition tolerance (TolÃ©rance au partitionnement)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Le triangle CAP                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚                           Consistency                               â”‚
â”‚                               /\                                    â”‚
â”‚                              /  \                                   â”‚
â”‚                             /    \                                  â”‚
â”‚                            /      \                                 â”‚
â”‚                           /   CA   \                                â”‚
â”‚                          /    âŒ    \                               â”‚
â”‚                         /____________\                              â”‚
â”‚                        /\            /\                             â”‚
â”‚                       /  \          /  \                            â”‚
â”‚                      / CP \        / AP \                           â”‚
â”‚                     /  âœ…  \      /  âœ…  \                          â”‚
â”‚                    /________\    /________\                         â”‚
â”‚                                                                     â”‚
â”‚               Partition              Availability                   â”‚
â”‚               tolerance                                             â”‚
â”‚                                                                     â”‚
â”‚   âŒ CA : Impossible en systÃ¨me rÃ©ellement distribuÃ©                â”‚
â”‚   âœ… CP : CohÃ©rence + TolÃ©rance (sacrifice disponibilitÃ©)           â”‚
â”‚   âœ… AP : DisponibilitÃ© + TolÃ©rance (sacrifice cohÃ©rence)           â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Les trois propriÃ©tÃ©s en dÃ©tail

### C - Consistency (CohÃ©rence)

La **cohÃ©rence** garantit que tous les nÅ“uds du systÃ¨me voient les **mÃªmes donnÃ©es au mÃªme moment**. AprÃ¨s une Ã©criture rÃ©ussie, toute lecture ultÃ©rieure retournera cette nouvelle valeur, quel que soit le nÅ“ud interrogÃ©.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CohÃ©rence (Consistency)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   Exemple : Mise Ã  jour du solde d'un compte bancaire               â”‚
â”‚                                                                     â”‚
â”‚   AVANT la mise Ã  jour :                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚   â”‚ NÅ“ud A  â”‚         â”‚ NÅ“ud B  â”‚         â”‚ NÅ“ud C  â”‚               â”‚
â”‚   â”‚         â”‚         â”‚         â”‚         â”‚         â”‚               â”‚
â”‚   â”‚ Solde:  â”‚         â”‚ Solde:  â”‚         â”‚ Solde:  â”‚               â”‚
â”‚   â”‚ 1000â‚¬   â”‚         â”‚ 1000â‚¬   â”‚         â”‚ 1000â‚¬   â”‚               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚        âœ“                   âœ“                   âœ“                    â”‚
â”‚                    Tous les nÅ“uds cohÃ©rents                         â”‚
â”‚                                                                     â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚                                                                     â”‚
â”‚   Client fait un retrait de 200â‚¬ sur NÅ“ud A                         â”‚
â”‚                                                                     â”‚
â”‚   APRÃˆS la mise Ã  jour (systÃ¨me COHÃ‰RENT) :                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚   â”‚ NÅ“ud A  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ NÅ“ud B  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ NÅ“ud C  â”‚               â”‚
â”‚   â”‚         â”‚ sync    â”‚         â”‚ sync    â”‚         â”‚               â”‚
â”‚   â”‚ Solde:  â”‚         â”‚ Solde:  â”‚         â”‚ Solde:  â”‚               â”‚
â”‚   â”‚  800â‚¬   â”‚         â”‚  800â‚¬   â”‚         â”‚  800â‚¬   â”‚               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚        âœ“                   âœ“                   âœ“                    â”‚
â”‚        â”‚                                                            â”‚
â”‚        â””â”€â”€ Tous les nÅ“uds retournent 800â‚¬ immÃ©diatement             â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### CaractÃ©ristiques de la cohÃ©rence

- Toutes les lectures reflÃ¨tent l'Ã©criture la plus rÃ©cente
- Les donnÃ©es sont identiques sur tous les nÅ“uds
- Aucune lecture "pÃ©rimÃ©e" n'est possible
- Aussi appelÃ©e "cohÃ©rence forte" (strong consistency)

#### Analogie du monde rÃ©el

Imaginez un tableau blanc partagÃ© dans une salle de rÃ©union. La cohÃ©rence, c'est comme si tout le monde voyait exactement les mÃªmes informations sur le tableau Ã  tout moment, mÃªme si quelqu'un vient d'Ã©crire quelque chose.

---

### A - Availability (DisponibilitÃ©)

La **disponibilitÃ©** garantit que chaque requÃªte reÃ§oit une rÃ©ponse (succÃ¨s ou Ã©chec), mÃªme si certains nÅ“uds sont en panne. Le systÃ¨me reste opÃ©rationnel et rÃ©pond toujours.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     DisponibilitÃ© (Availability)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   ScÃ©nario : Le NÅ“ud B tombe en panne                               â”‚
â”‚                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚   â”‚ NÅ“ud A  â”‚         â”‚ NÅ“ud B  â”‚         â”‚ NÅ“ud C  â”‚               â”‚
â”‚   â”‚   âœ…    â”‚         â”‚   âŒ    â”‚         â”‚   âœ…    â”‚               â”‚
â”‚   â”‚  actif  â”‚         â”‚  panne  â”‚         â”‚  actif  â”‚               â”‚
â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜               â”‚
â”‚        â”‚                                       â”‚                    â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                        â”‚                                            â”‚
â”‚                        â–¼                                            â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚
â”‚                   â”‚ Client  â”‚                                       â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â”‚                                                                     â”‚
â”‚   SystÃ¨me DISPONIBLE :                                              â”‚
â”‚   â€¢ Le client peut toujours lire/Ã©crire via NÅ“ud A ou C             â”‚
â”‚   â€¢ La requÃªte reÃ§oit TOUJOURS une rÃ©ponse                          â”‚
â”‚   â€¢ Pas de timeout ni d'erreur "service indisponible"               â”‚
â”‚                                                                     â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚                                                                     â”‚
â”‚   SystÃ¨me NON DISPONIBLE :                                          â”‚
â”‚   â€¢ Le systÃ¨me refuse les requÃªtes jusqu'Ã  rÃ©paration               â”‚
â”‚   â€¢ Le client reÃ§oit une erreur ou un timeout                       â”‚
â”‚   â€¢ OpÃ©ration impossible temporairement                             â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### CaractÃ©ristiques de la disponibilitÃ©

- Chaque requÃªte reÃ§oit une rÃ©ponse (pas de timeout)
- Le systÃ¨me reste fonctionnel malgrÃ© les pannes partielles
- Les utilisateurs peuvent toujours interagir avec le systÃ¨me
- Latence acceptable (le systÃ¨me rÃ©pond dans un dÃ©lai raisonnable)

#### Analogie du monde rÃ©el

Pensez Ã  un service client tÃ©lÃ©phonique avec plusieurs opÃ©rateurs. MÃªme si certains opÃ©rateurs sont en pause, il y a toujours quelqu'un pour rÃ©pondre aux appels. Le service reste disponible.

---

### P - Partition Tolerance (TolÃ©rance au partitionnement)

La **tolÃ©rance au partitionnement** garantit que le systÃ¨me continue de fonctionner mÃªme si la communication entre certains nÅ“uds est interrompue (partition rÃ©seau).

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               TolÃ©rance au partitionnement (Partition Tolerance)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚
â”‚   Situation normale : Tous les nÅ“uds communiquent
â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â—„â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â—„â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   â”‚ NÅ“ud A  â”‚          â”‚ NÅ“ud B  â”‚          â”‚ NÅ“ud C  â”‚
â”‚   â”‚  Paris  â”‚          â”‚  Lyon   â”‚          â”‚Marseilleâ”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚
â”‚   Partition rÃ©seau : La connexion Paris-Lyon est coupÃ©e
â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    âœ‚ï¸   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â—„â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   â”‚ NÅ“ud A  â”‚ ~~~~~~~ â”‚ NÅ“ud B  â”‚          â”‚ NÅ“ud C  â”‚
â”‚   â”‚  Paris  â”‚  coupÃ©  â”‚  Lyon   â”‚          â”‚Marseilleâ”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚
â”‚   Le rÃ©seau est "partitionnÃ©" en deux groupes :
â”‚   â€¢ Groupe 1 : Paris (NÅ“ud A)
â”‚   â€¢ Groupe 2 : Lyon + Marseille (NÅ“uds B et C)
â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚
â”‚   SystÃ¨me TOLÃ‰RANT au partitionnement :
â”‚   â†’ Continue de fonctionner malgrÃ© la partition
â”‚   â†’ Les deux groupes peuvent traiter des requÃªtes
â”‚
â”‚   SystÃ¨me NON TOLÃ‰RANT :
â”‚   â†’ S'arrÃªte complÃ¨tement en cas de partition
â”‚   â†’ Attend que le rÃ©seau soit rÃ©parÃ©
â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Qu'est-ce qu'une partition rÃ©seau ?

Une **partition rÃ©seau** se produit quand des nÅ“uds d'un systÃ¨me distribuÃ© ne peuvent plus communiquer entre eux, alors qu'ils fonctionnent toujours individuellement.

Causes possibles :
- CÃ¢ble rÃ©seau dÃ©fectueux
- Routeur en panne
- Congestion rÃ©seau sÃ©vÃ¨re
- ProblÃ¨me de configuration
- Panne d'un datacenter

#### CaractÃ©ristiques de la tolÃ©rance au partitionnement

- Le systÃ¨me reste opÃ©rationnel malgrÃ© les coupures rÃ©seau
- Les nÅ“uds isolÃ©s peuvent continuer Ã  servir des requÃªtes
- Le systÃ¨me gÃ¨re la rÃ©conciliation aprÃ¨s la partition

#### Analogie du monde rÃ©el

Imaginez plusieurs succursales d'une banque dans diffÃ©rentes villes. Si les lignes tÃ©lÃ©phoniques entre Paris et Lyon sont coupÃ©es, chaque succursale peut-elle continuer Ã  servir ses clients locaux ? Un systÃ¨me tolÃ©rant au partitionnement rÃ©pondrait oui.

---

## Pourquoi ne peut-on choisir que 2 sur 3 ?

Le thÃ©orÃ¨me CAP affirme qu'en cas de partition rÃ©seau, vous devez choisir entre cohÃ©rence et disponibilitÃ©. Voici pourquoi :

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Le dilemme du partitionnement                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚
â”‚   Situation : Partition rÃ©seau entre NÅ“ud A et NÅ“ud B
â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     âœ‚ï¸ partition âœ‚ï¸    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   â”‚ NÅ“ud A  â”‚ ~~~~~~~~~~~~~~~~~~~~~~ â”‚ NÅ“ud B  â”‚
â”‚   â”‚         â”‚     pas de comm.       â”‚         â”‚
â”‚   â”‚ Solde:  â”‚                        â”‚ Solde:  â”‚
â”‚   â”‚ 1000â‚¬   â”‚                        â”‚ 1000â‚¬   â”‚
â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
â”‚        â”‚                                  â”‚
â”‚        â–¼                                  â–¼
â”‚   Client 1                           Client 2
â”‚   "Retrait 200â‚¬"                     "Quel est mon solde ?"
â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â”‚
â”‚   CHOIX 1 : PrivilÃ©gier la COHÃ‰RENCE (CP)
â”‚
â”‚   â€¢ NÅ“ud A accepte le retrait â†’ Solde local = 800â‚¬
â”‚   â€¢ NÅ“ud B ne peut pas se synchroniser avec A
â”‚   â€¢ NÅ“ud B REFUSE de rÃ©pondre Ã  Client 2
â”‚     "DÃ©solÃ©, je ne peux garantir une donnÃ©e Ã  jour"
â”‚
â”‚   RÃ©sultat : CohÃ©rent mais PAS disponible
â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚
â”‚   CHOIX 2 : PrivilÃ©gier la DISPONIBILITÃ‰ (AP)
â”‚
â”‚   â€¢ NÅ“ud A accepte le retrait â†’ Solde local = 800â‚¬
â”‚   â€¢ NÅ“ud B rÃ©pond Ã  Client 2 avec son info locale
â”‚     "Votre solde est de 1000â‚¬" (info pÃ©rimÃ©e !)
â”‚
â”‚   RÃ©sultat : Disponible mais PAS cohÃ©rent
â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Le point clÃ©

**En cas de partition rÃ©seau**, vous ne pouvez pas avoir simultanÃ©ment :
- Des rÃ©ponses qui reflÃ¨tent toutes les Ã©critures (CohÃ©rence)
- Des rÃ©ponses pour toutes les requÃªtes (DisponibilitÃ©)

Vous devez **choisir** :
- Soit refuser de rÃ©pondre pour garantir la cohÃ©rence (CP)
- Soit rÃ©pondre avec des donnÃ©es potentiellement obsolÃ¨tes (AP)

---

## Les trois combinaisons possibles

### CP - Consistency + Partition Tolerance

SystÃ¨mes qui privilÃ©gient la **cohÃ©rence** en cas de partition, au dÃ©triment de la disponibilitÃ©.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SystÃ¨mes CP                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   Comportement en cas de partition :                                â”‚
â”‚   â€¢ Refuse les requÃªtes si la cohÃ©rence ne peut Ãªtre garantie       â”‚
â”‚   â€¢ PrÃ©fÃ¨re renvoyer une erreur plutÃ´t qu'une donnÃ©e obsolÃ¨te       â”‚
â”‚   â€¢ Attend la rÃ©solution de la partition                            â”‚
â”‚                                                                     â”‚
â”‚   Exemples de systÃ¨mes CP :                                         â”‚
â”‚   â€¢ MongoDB (configuration par dÃ©faut)                              â”‚
â”‚   â€¢ HBase                                                           â”‚
â”‚   â€¢ Redis Cluster                                                   â”‚
â”‚   â€¢ Zookeeper                                                       â”‚
â”‚   â€¢ Consul                                                          â”‚
â”‚                                                                     â”‚
â”‚   Cas d'usage idÃ©aux :                                              â”‚
â”‚   âœ… SystÃ¨mes bancaires et financiers                               â”‚
â”‚   âœ… Inventaire e-commerce                                          â”‚
â”‚   âœ… SystÃ¨mes de rÃ©servation                                        â”‚
â”‚   âœ… Registres de configuration                                     â”‚
â”‚                                                                     â”‚
â”‚   Principe : "Mieux vaut ne pas rÃ©pondre que rÃ©pondre faux"         â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### AP - Availability + Partition Tolerance

SystÃ¨mes qui privilÃ©gient la **disponibilitÃ©** en cas de partition, acceptant une cohÃ©rence Ã©ventuelle.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SystÃ¨mes AP                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   Comportement en cas de partition :                                â”‚
â”‚   â€¢ RÃ©pond toujours aux requÃªtes                                    â”‚
â”‚   â€¢ Peut retourner des donnÃ©es obsolÃ¨tes                            â”‚
â”‚   â€¢ Synchronise les donnÃ©es aprÃ¨s la partition (rÃ©conciliation)     â”‚
â”‚                                                                     â”‚
â”‚   Exemples de systÃ¨mes AP :                                         â”‚
â”‚   â€¢ Cassandra                                                       â”‚
â”‚   â€¢ CouchDB                                                         â”‚
â”‚   â€¢ DynamoDB                                                        â”‚
â”‚   â€¢ Riak                                                            â”‚
â”‚   â€¢ DNS                                                             â”‚
â”‚                                                                     â”‚
â”‚   Cas d'usage idÃ©aux :                                              â”‚
â”‚   âœ… RÃ©seaux sociaux (likes, posts)                                 â”‚
â”‚   âœ… SystÃ¨mes de cache                                              â”‚
â”‚   âœ… Analytics et mÃ©triques                                         â”‚
â”‚   âœ… Panier d'achat                                                 â”‚
â”‚   âœ… Messagerie                                                     â”‚
â”‚                                                                     â”‚
â”‚   Principe : "Mieux vaut une rÃ©ponse approximative que pas de       â”‚
â”‚              rÃ©ponse du tout"                                       â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### CA - Consistency + Availability (sans Partition Tolerance)

SystÃ¨mes qui garantissent cohÃ©rence et disponibilitÃ©, mais **ne tolÃ¨rent pas les partitions rÃ©seau**.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SystÃ¨mes CA                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   âš ï¸  ATTENTION : Presque impossible en systÃ¨me vraiment distribuÃ©  â”‚
â”‚                                                                     â”‚
â”‚   Comportement :                                                    â”‚
â”‚   â€¢ CohÃ©rent ET disponible tant que le rÃ©seau fonctionne            â”‚
â”‚   â€¢ Ã‰choue complÃ¨tement en cas de partition                         â”‚
â”‚   â€¢ NÃ©cessite un rÃ©seau 100% fiable (irrÃ©aliste)                    â”‚
â”‚                                                                     â”‚
â”‚   Exemples (systÃ¨mes non/peu distribuÃ©s) :                          â”‚
â”‚   â€¢ Bases SQL traditionnelles sur un seul serveur                   â”‚
â”‚     (PostgreSQL, MySQL en standalone)                               â”‚
â”‚   â€¢ SystÃ¨mes sur un rÃ©seau local trÃ¨s fiable                        â”‚
â”‚                                                                     â”‚
â”‚   Pourquoi c'est problÃ©matique :                                    â”‚
â”‚   â€¢ Les partitions rÃ©seau sont INÃ‰VITABLES dans un systÃ¨me          â”‚
â”‚     rÃ©ellement distribuÃ©                                            â”‚
â”‚   â€¢ On ne peut pas Ã©viter P, donc on doit choisir entre C et A      â”‚
â”‚                                                                     â”‚
â”‚   Citation de Coda Hale :                                           â”‚
â”‚   "Dans un systÃ¨me distribuÃ©, les partitions arrivent.              â”‚
â”‚    Vous DEVEZ tolÃ©rer P. Vous choisissez donc entre C et A."        â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Le thÃ©orÃ¨me CAP en pratique

### La partition est inÃ©vitable

Dans tout systÃ¨me distribuÃ© rÃ©el, les partitions rÃ©seau **peuvent et vont** se produire :

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Pourquoi P est obligatoire                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   Sources de partitions rÃ©seau :                                    â”‚
â”‚                                                                     â”‚
â”‚   ğŸ”Œ Pannes matÃ©rielles                                             â”‚
â”‚      â€¢ Routeurs dÃ©faillants                                         â”‚
â”‚      â€¢ CÃ¢bles endommagÃ©s                                            â”‚
â”‚      â€¢ Cartes rÃ©seau dÃ©fectueuses                                   â”‚
â”‚                                                                     â”‚
â”‚   â˜ï¸  ProblÃ¨mes cloud/datacenter                                    â”‚
â”‚      â€¢ Panne d'une zone de disponibilitÃ©                            â”‚
â”‚      â€¢ Maintenance planifiÃ©e                                        â”‚
â”‚      â€¢ Surcharge temporaire                                         â”‚
â”‚                                                                     â”‚
â”‚   ğŸŒ ProblÃ¨mes rÃ©seau                                               â”‚
â”‚      â€¢ Congestion                                                   â”‚
â”‚      â€¢ Attaques DDoS                                                â”‚
â”‚      â€¢ Erreurs de configuration                                     â”‚
â”‚                                                                     â”‚
â”‚   ğŸ“Š Statistiques (Ã©tude Google) :                                  â”‚
â”‚      â€¢ ~5 partitions par datacenter par an                          â”‚
â”‚      â€¢ DurÃ©e moyenne : quelques minutes Ã  plusieurs heures          â”‚
â”‚                                                                     â”‚
â”‚   Conclusion : Vous DEVEZ concevoir pour P                          â”‚
â”‚               Le vrai choix est entre C et A                        â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Le choix dÃ©pend du contexte

Le choix entre CP et AP dÃ©pend de votre cas d'usage :

| Question | Si OUI â†’ | Explication |
|----------|----------|-------------|
| Les donnÃ©es incorrectes causent-elles des pertes financiÃ¨res ? | CP | Banques, paiements |
| Une donnÃ©e obsolÃ¨te est-elle acceptable temporairement ? | AP | RÃ©seaux sociaux, analytics |
| L'indisponibilitÃ© temporaire est-elle tolÃ©rable ? | CP | SystÃ¨mes de configuration |
| Les utilisateurs doivent-ils toujours pouvoir agir ? | AP | E-commerce, messaging |

### Exemples concrets de choix

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Exemples de compromis CAP                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   ğŸ¦ BANQUE (transfert d'argent) â†’ CP                               â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                 â”‚
â”‚   "Je prÃ©fÃ¨re que mon virement soit refusÃ© temporairement           â”‚
â”‚    plutÃ´t que mon compte soit dÃ©bitÃ© deux fois."                    â”‚
â”‚                                                                     â”‚
â”‚   Partition : Le systÃ¨me refuse les opÃ©rations jusqu'Ã               â”‚
â”‚   synchronisation des soldes.                                       â”‚
â”‚                                                                     â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚                                                                     â”‚
â”‚   ğŸ‘ RÃ‰SEAU SOCIAL (likes) â†’ AP                                     â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                     â”‚
â”‚   "Ce n'est pas grave si le compteur de likes affiche 1000          â”‚
â”‚    au lieu de 1003 pendant quelques secondes."                      â”‚
â”‚                                                                     â”‚
â”‚   Partition : Chaque rÃ©gion continue d'enregistrer les likes        â”‚
â”‚   localement, rÃ©conciliation aprÃ¨s.                                 â”‚
â”‚                                                                     â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚                                                                     â”‚
â”‚   ğŸ›’ E-COMMERCE (panier) â†’ AP                                       â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚   "Le client doit toujours pouvoir ajouter au panier.               â”‚
â”‚    On gÃ¨rera les problÃ¨mes de stock Ã  la commande."                 â”‚
â”‚                                                                     â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚                                                                     â”‚
â”‚   âœˆï¸  RÃ‰SERVATION (siÃ¨ges d'avion) â†’ CP                             â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                    â”‚
â”‚   "Je prÃ©fÃ¨re un message d'erreur plutÃ´t que deux personnes         â”‚
â”‚    avec le mÃªme siÃ¨ge."                                             â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Nuances et Ã©volutions du thÃ©orÃ¨me

### Le thÃ©orÃ¨me CAP n'est pas binaire

Le thÃ©orÃ¨me original est souvent simplifiÃ©. En rÃ©alitÃ© :

- **La cohÃ©rence a des degrÃ©s** : forte, causale, Ã©ventuelle...
- **La disponibilitÃ© a des degrÃ©s** : temps de rÃ©ponse, % de disponibilitÃ©...
- **Les partitions sont temporaires** : le systÃ¨me peut s'adapter

### Le modÃ¨le PACELC

Le modÃ¨le **PACELC** (proposÃ© par Daniel Abadi) Ã©tend le thÃ©orÃ¨me CAP :

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ModÃ¨le PACELC                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   "En cas de Partition (P), choisir entre Availability (A)          â”‚
â”‚    et Consistency (C).                                              â”‚
â”‚    Sinon (Else), choisir entre Latency (L) et Consistency (C)."     â”‚
â”‚                                                                     â”‚
â”‚                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                                                             â”‚   â”‚
â”‚   â”‚              Partition ?                                    â”‚   â”‚
â”‚   â”‚              /        \                                     â”‚   â”‚
â”‚   â”‚            OUI        NON                                   â”‚   â”‚
â”‚   â”‚            /            \                                   â”‚   â”‚
â”‚   â”‚       A ou C ?       L ou C ?                               â”‚   â”‚
â”‚   â”‚       /    \         /    \                                 â”‚   â”‚
â”‚   â”‚     PA     PC      EL     EC                                â”‚   â”‚
â”‚   â”‚                                                             â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚   Exemples :                                                        â”‚
â”‚   â€¢ Cassandra : PA/EL (disponibilitÃ© et faible latence)             â”‚
â”‚   â€¢ MongoDB : PC/EC (cohÃ©rence toujours)                            â”‚
â”‚   â€¢ DynamoDB : PA/EL (configurable)                                 â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Les systÃ¨mes modernes sont configurables

Beaucoup de bases de donnÃ©es modernes permettent de **configurer** le compromis CAP selon vos besoins :

| SystÃ¨me | Configuration possible |
|---------|------------------------|
| **MongoDB** | Write Concern, Read Concern, Read Preference |
| **Cassandra** | Consistency Level par requÃªte |
| **DynamoDB** | Eventually consistent ou strongly consistent reads |

---

## RÃ©sumÃ© visuel

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ThÃ©orÃ¨me CAP - RÃ©sumÃ©                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚                       CAP                                  â”‚    â”‚
â”‚   â”‚                                                            â”‚    â”‚
â”‚   â”‚  C = Consistency      Tous voient les mÃªmes donnÃ©es        â”‚    â”‚
â”‚   â”‚  A = Availability     Toujours une rÃ©ponse                 â”‚    â”‚
â”‚   â”‚  P = Partition Tol.   Fonctionne malgrÃ© coupures rÃ©seau    â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                     â”‚
â”‚   RÃ¨gle fondamentale :                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚  En systÃ¨me distribuÃ©, P est OBLIGATOIRE                   â”‚    â”‚
â”‚   â”‚  â†’ Le vrai choix est entre C et A                          â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                     â”‚
â”‚   Choisir CP si :              Choisir AP si :                      â”‚
â”‚   â€¢ DonnÃ©es critiques          â€¢ Haute disponibilitÃ© critique       â”‚
â”‚   â€¢ Finance, rÃ©servation       â€¢ RÃ©seaux sociaux, cache             â”‚
â”‚   â€¢ Erreur > donnÃ©e fausse     â€¢ DonnÃ©e obsolÃ¨te > erreur           â”‚
â”‚                                                                     â”‚
â”‚   MongoDB est un systÃ¨me CP par dÃ©faut,                             â”‚
â”‚   mais configurable selon vos besoins.                              â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Conclusion

Le thÃ©orÃ¨me CAP est un concept fondamental pour comprendre les compromis inhÃ©rents aux systÃ¨mes distribuÃ©s. En rÃ©sumÃ© :

- **C** (CohÃ©rence) : Tous les nÅ“uds voient les mÃªmes donnÃ©es
- **A** (DisponibilitÃ©) : Le systÃ¨me rÃ©pond toujours
- **P** (Partition Tolerance) : Le systÃ¨me survit aux coupures rÃ©seau

Dans un systÃ¨me distribuÃ© rÃ©el, les partitions sont inÃ©vitables, donc **P est obligatoire**. Le vrai choix est entre **C et A**.

MongoDB, que nous Ã©tudions dans ce cours, est principalement un systÃ¨me **CP** : il privilÃ©gie la cohÃ©rence des donnÃ©es, mais offre des options de configuration pour ajuster ce comportement selon vos besoins.

Dans la section suivante, nous verrons prÃ©cisÃ©ment comment MongoDB se positionne dans le thÃ©orÃ¨me CAP et quels mÃ©canismes il utilise pour gÃ©rer ces compromis.

---

## Points clÃ©s Ã  retenir

- Le thÃ©orÃ¨me CAP s'applique aux **systÃ¨mes distribuÃ©s**
- On ne peut garantir que **2 propriÃ©tÃ©s sur 3** simultanÃ©ment
- **P (Partition Tolerance)** est obligatoire en pratique
- Le choix rÃ©el est entre **CohÃ©rence (C)** et **DisponibilitÃ© (A)**
- **CP** = cohÃ©rence prioritaire (donnÃ©es critiques)
- **AP** = disponibilitÃ© prioritaire (haute disponibilitÃ©)
- Les systÃ¨mes modernes sont souvent **configurables**
- MongoDB est **CP par dÃ©faut** mais configurable

---


â­ï¸ [Positionnement de MongoDB dans le thÃ©orÃ¨me CAP](/01-introduction-a-mongodb/04.2-positionnement-mongodb-cap.md)
