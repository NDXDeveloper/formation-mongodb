ğŸ” Retour au [Sommaire](/SOMMAIRE.md)

# 1.6 Architecture gÃ©nÃ©rale de MongoDB

## Introduction

Comprendre l'architecture de MongoDB est essentiel pour bien utiliser cette base de donnÃ©es, que ce soit pour un projet personnel ou une application d'entreprise. Cette section prÃ©sente les diffÃ©rents composants de MongoDB, leur rÃ´le et comment ils interagissent entre eux.

Nous commencerons par l'architecture la plus simple (une seule instance) avant d'explorer les architectures distribuÃ©es qui font la force de MongoDB en production.

---

## Vue d'ensemble de l'architecture

MongoDB peut Ãªtre dÃ©ployÃ© selon trois configurations principales, de la plus simple Ã  la plus complexe :

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Modes de dÃ©ploiement MongoDB                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  1. Standalone          2. Replica Set         3. Sharded Cluster   â”‚
â”‚  (Instance unique)      (Haute disponibilitÃ©)  (ScalabilitÃ©)        â”‚
â”‚                                                                     â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚     â”‚mongodâ”‚             â”‚ P   â”‚â—„â”€â”€â”               â”‚ mongos  â”‚      â”‚
â”‚     â””â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”˜   â”‚               â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”   â”‚                    â”‚           â”‚
â”‚                          â”‚ S   â”‚â—„â”€â”€â”¤               â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”      â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”˜   â”‚               â”‚         â”‚      â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”   â”‚            â”Œâ”€â”€â”´â”€â”€â”   â”Œâ”€â”€â”´â”€â”€â”   â”‚
â”‚                          â”‚ S   â”‚â—„â”€â”€â”˜            â”‚Shardâ”‚   â”‚Shardâ”‚   â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  DÃ©veloppement          Production             Grande Ã©chelle       â”‚
â”‚  Tests                  Standard               Big Data             â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Les composants fondamentaux

### 1. mongod : Le serveur de base de donnÃ©es

**mongod** (MongoDB Daemon) est le processus principal de MongoDB. C'est le cÅ“ur du systÃ¨me qui :

- Stocke les donnÃ©es sur le disque
- GÃ¨re les requÃªtes des clients
- ExÃ©cute les opÃ©rations CRUD
- Maintient les index
- GÃ¨re la rÃ©plication (en mode Replica Set)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Processus mongod                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   Query     â”‚  â”‚   Index     â”‚  â”‚  Storage    â”‚       â”‚
â”‚  â”‚   Engine    â”‚  â”‚   Manager   â”‚  â”‚   Engine    â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                â”‚                â”‚              â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                          â”‚                               â”‚
â”‚                          â–¼                               â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚                  â”‚  WiredTiger   â”‚                       â”‚
â”‚                  â”‚    Engine     â”‚                       â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                          â”‚                               â”‚
â”‚                          â–¼                               â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚                  â”‚  Fichiers     â”‚                       â”‚
â”‚                  â”‚  sur disque   â”‚                       â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Configuration de base de mongod

Lorsque vous lancez mongod, plusieurs paramÃ¨tres importants peuvent Ãªtre configurÃ©s :

| ParamÃ¨tre | Description | Valeur par dÃ©faut |
|-----------|-------------|-------------------|
| `--port` | Port d'Ã©coute | 27017 |
| `--dbpath` | RÃ©pertoire des donnÃ©es | /data/db |
| `--logpath` | Fichier de logs | Sortie standard |
| `--bind_ip` | Adresses IP d'Ã©coute | localhost |
| `--auth` | Active l'authentification | DÃ©sactivÃ© |

#### Exemple de lancement

```bash
# Lancement simple
mongod

# Lancement avec options
mongod --port 27017 --dbpath /var/lib/mongodb --logpath /var/log/mongodb/mongod.log

# Lancement avec fichier de configuration
mongod --config /etc/mongod.conf
```

### 2. mongos : Le routeur de requÃªtes

**mongos** est utilisÃ© uniquement dans les architectures **shardÃ©es** (distribuÃ©es). Son rÃ´le est de :

- Router les requÃªtes vers le(s) bon(s) shard(s)
- AgrÃ©ger les rÃ©sultats provenant de plusieurs shards
- Masquer la complexitÃ© de la distribution aux applications

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Flux de routage dans un cluster shardÃ©                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                  â”‚
â”‚   â”‚ Application â”‚                                                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                  â”‚
â”‚          â”‚                                                         â”‚
â”‚          â”‚ RequÃªte : find({ user_id: 123 })                        â”‚
â”‚          â–¼                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                  â”‚
â”‚   â”‚   mongos    â”‚  "OÃ¹ sont les donnÃ©es pour user_id=123 ?"        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                  â”‚
â”‚          â”‚                                                         â”‚
â”‚          â”‚ 1. Consultation des mÃ©tadonnÃ©es                         â”‚
â”‚          â–¼                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                 â”‚
â”‚   â”‚Config Server â”‚  "user_id 100-200 â†’ Shard B"                    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                 â”‚
â”‚          â”‚                                                         â”‚
â”‚          â”‚ 2. Routage vers le bon shard                            â”‚
â”‚          â–¼                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                  â”‚
â”‚   â”‚   Shard B   â”‚  â† La requÃªte est envoyÃ©e uniquement ici         â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                                  â”‚
â”‚          â”‚                                                         â”‚
â”‚          â”‚ 3. RÃ©ponse renvoyÃ©e via mongos                          â”‚
â”‚          â–¼                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                  â”‚
â”‚   â”‚ Application â”‚  â† ReÃ§oit le rÃ©sultat                            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                  â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. mongo / mongosh : Le client shell

**mongosh** (MongoDB Shell) est l'interface en ligne de commande pour interagir avec MongoDB. Il permet de :

- Se connecter Ã  une instance MongoDB
- ExÃ©cuter des requÃªtes et des commandes
- Administrer la base de donnÃ©es
- Ã‰crire des scripts JavaScript

```bash
# Connexion Ã  une instance locale
mongosh

# Connexion Ã  une instance distante
mongosh "mongodb://serveur:27017"

# Connexion avec authentification
mongosh "mongodb://user:password@serveur:27017/database"
```

> **Note** : `mongo` est l'ancien shell (dÃ©prÃ©ciÃ©). `mongosh` est le nouveau shell moderne introduit avec MongoDB 5.0.

---

## Le moteur de stockage : WiredTiger

Depuis MongoDB 3.2, **WiredTiger** est le moteur de stockage par dÃ©faut. C'est le composant qui gÃ¨re physiquement le stockage des donnÃ©es sur le disque.

### CaractÃ©ristiques principales

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Moteur WiredTiger                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚   Compression   â”‚    â”‚   Concurrence   â”‚                     â”‚
â”‚  â”‚   des donnÃ©es   â”‚    â”‚   au niveau     â”‚                     â”‚
â”‚  â”‚   (snappy/zlib) â”‚    â”‚   document      â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚   Journaling    â”‚    â”‚     Cache       â”‚                     â”‚
â”‚  â”‚   (durabilitÃ©)  â”‚    â”‚   en mÃ©moire    â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚   Checkpoints   â”‚    â”‚   Chiffrement   â”‚                     â”‚
â”‚  â”‚   pÃ©riodiques   â”‚    â”‚   au repos      â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### FonctionnalitÃ©s clÃ©s

| FonctionnalitÃ© | Description |
|----------------|-------------|
| **Compression** | RÃ©duit l'espace disque (snappy par dÃ©faut, zlib disponible) |
| **Verrouillage document** | Permet des Ã©critures concurrentes sur diffÃ©rents documents |
| **Journaling** | Garantit la durabilitÃ© des donnÃ©es en cas de crash |
| **Cache** | Garde les donnÃ©es frÃ©quemment utilisÃ©es en mÃ©moire |
| **Checkpoints** | Ã‰crit les donnÃ©es sur disque toutes les 60 secondes |
| **Chiffrement** | Chiffrement des donnÃ©es au repos (Enterprise) |

### Gestion de la mÃ©moire

WiredTiger utilise un **cache interne** pour optimiser les performances :

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Gestion mÃ©moire                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚   RAM totale du serveur : 16 GB                              â”‚
â”‚                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚         Cache WiredTiger (par dÃ©faut)              â”‚     â”‚
â”‚   â”‚                                                    â”‚     â”‚
â”‚   â”‚    50% de (RAM - 1GB) = 50% Ã— 15GB â‰ˆ 7.5 GB        â”‚     â”‚
â”‚   â”‚                                                    â”‚     â”‚
â”‚   â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚     â”‚
â”‚   â”‚    â”‚  Documents et index frÃ©quemment utilisÃ©s â”‚    â”‚     â”‚
â”‚   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚         Reste de la mÃ©moire                        â”‚     â”‚
â”‚   â”‚                                                    â”‚     â”‚
â”‚   â”‚    â€¢ SystÃ¨me d'exploitation                        â”‚     â”‚
â”‚   â”‚    â€¢ Cache du systÃ¨me de fichiers                  â”‚     â”‚
â”‚   â”‚    â€¢ Connexions clients                            â”‚     â”‚
â”‚   â”‚    â€¢ OpÃ©rations d'agrÃ©gation                       â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Structure logique des donnÃ©es

MongoDB organise les donnÃ©es selon une hiÃ©rarchie Ã  trois niveaux :

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   HiÃ©rarchie des donnÃ©es                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Instance MongoDB (mongod)                                     â”‚
â”‚   â”‚                                                             â”‚
â”‚   â”œâ”€â”€ Base de donnÃ©es "ecommerce"                               â”‚
â”‚   â”‚   â”‚                                                         â”‚
â”‚   â”‚   â”œâ”€â”€ Collection "products"                                 â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ Document { _id: 1, name: "Laptop", ... }          â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ Document { _id: 2, name: "Phone", ... }           â”‚
â”‚   â”‚   â”‚   â””â”€â”€ Document { _id: 3, name: "Tablet", ... }          â”‚
â”‚   â”‚   â”‚                                                         â”‚
â”‚   â”‚   â”œâ”€â”€ Collection "users"                                    â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ Document { _id: 1, name: "Alice", ... }           â”‚
â”‚   â”‚   â”‚   â””â”€â”€ Document { _id: 2, name: "Bob", ... }             â”‚
â”‚   â”‚   â”‚                                                         â”‚
â”‚   â”‚   â””â”€â”€ Collection "orders"                                   â”‚
â”‚   â”‚       â””â”€â”€ ...                                               â”‚
â”‚   â”‚                                                             â”‚
â”‚   â”œâ”€â”€ Base de donnÃ©es "blog"                                    â”‚
â”‚   â”‚   â”œâ”€â”€ Collection "posts"                                    â”‚
â”‚   â”‚   â””â”€â”€ Collection "comments"                                 â”‚
â”‚   â”‚                                                             â”‚
â”‚   â””â”€â”€ Bases systÃ¨me                                             â”‚
â”‚       â”œâ”€â”€ admin    (administration)                             â”‚
â”‚       â”œâ”€â”€ config   (configuration sharding)                     â”‚
â”‚       â””â”€â”€ local    (donnÃ©es locales, oplog)                     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Les bases de donnÃ©es systÃ¨me

MongoDB crÃ©e automatiquement plusieurs bases de donnÃ©es systÃ¨me :

| Base | Description |
|------|-------------|
| **admin** | Base d'administration, stocke les utilisateurs et rÃ´les |
| **config** | MÃ©tadonnÃ©es pour les clusters shardÃ©s |
| **local** | DonnÃ©es locales Ã  chaque instance (oplog pour la rÃ©plication) |

---

## Architecture Standalone (Instance unique)

L'architecture la plus simple consiste en une seule instance mongod.

### SchÃ©ma

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Architecture Standalone                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                      â”‚ Application â”‚                            â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                             â”‚                                   â”‚
â”‚                             â”‚ Driver MongoDB                    â”‚
â”‚                             â”‚ (connexion TCP)                   â”‚
â”‚                             â”‚                                   â”‚
â”‚                             â–¼                                   â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                      â”‚   mongod    â”‚                            â”‚
â”‚                      â”‚             â”‚                            â”‚
â”‚                      â”‚  Port 27017 â”‚                            â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                             â”‚                                   â”‚
â”‚                             â–¼                                   â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                      â”‚  Stockage   â”‚                            â”‚
â”‚                      â”‚  (disque)   â”‚                            â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### CaractÃ©ristiques

| Avantages | InconvÃ©nients |
|-----------|---------------|
| Simple Ã  configurer | Pas de haute disponibilitÃ© |
| Faible consommation de ressources | Point unique de dÃ©faillance |
| IdÃ©al pour le dÃ©veloppement | Pas de scalabilitÃ© horizontale |
| Rapide Ã  dÃ©marrer | Non recommandÃ© en production |

### Cas d'utilisation

- âœ… DÃ©veloppement local
- âœ… Tests et prototypage
- âœ… Petites applications non critiques
- âŒ Production avec exigences de disponibilitÃ©

---

## Architecture Replica Set (Haute disponibilitÃ©)

Un **Replica Set** est un groupe de processus mongod qui maintiennent le mÃªme jeu de donnÃ©es. C'est l'architecture **recommandÃ©e pour la production**.

### SchÃ©ma

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Architecture Replica Set                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                      â”‚ Application â”‚                            â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                             â”‚                                   â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚              â”‚              â”‚              â”‚                    â”‚
â”‚              â–¼              â–¼              â–¼                    â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚       â”‚ PRIMARY  â”‚   â”‚SECONDARY â”‚   â”‚SECONDARY â”‚                â”‚
â”‚       â”‚          â”‚   â”‚          â”‚   â”‚          â”‚                â”‚
â”‚       â”‚ Lectures â”‚   â”‚ Lectures â”‚   â”‚ Lectures â”‚                â”‚
â”‚       â”‚ Ã‰crituresâ”‚   â”‚ (option) â”‚   â”‚ (option) â”‚                â”‚
â”‚       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                â”‚
â”‚            â”‚              â”‚              â”‚                      â”‚
â”‚            â”‚   RÃ©plication (oplog)       â”‚                      â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                           â”‚                                     â”‚
â”‚                           â–¼                                     â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚              â”‚   MÃªmes donnÃ©es sur     â”‚                        â”‚
â”‚              â”‚   tous les membres      â”‚                        â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Les rÃ´les dans un Replica Set

#### Primary (Primaire)

- ReÃ§oit **toutes les Ã©critures**
- Un seul Primary Ã  la fois
- Ã‰lu automatiquement par les membres

#### Secondary (Secondaire)

- **RÃ©plique** les donnÃ©es du Primary via l'oplog
- Peut servir les **lectures** (si configurÃ©)
- Peut devenir Primary en cas de panne

#### Arbiter (Arbitre)

- **Ne stocke pas** de donnÃ©es
- **Vote** lors des Ã©lections
- UtilisÃ© pour avoir un nombre impair de votants

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Configuration Replica Set typique                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Configuration 3 membres (recommandÃ©e)                         â”‚
â”‚                                                                 â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚        â”‚ PRIMARY â”‚      â”‚SECONDARYâ”‚      â”‚SECONDARYâ”‚            â”‚
â”‚        â”‚         â”‚      â”‚         â”‚      â”‚         â”‚            â”‚
â”‚        â”‚  Vote   â”‚      â”‚  Vote   â”‚      â”‚  Vote   â”‚            â”‚
â”‚        â”‚  Data   â”‚      â”‚  Data   â”‚      â”‚  Data   â”‚            â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                 â”‚
â”‚   Configuration avec Arbiter                                    â”‚
â”‚                                                                 â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚        â”‚ PRIMARY â”‚      â”‚SECONDARYâ”‚      â”‚ ARBITER â”‚            â”‚
â”‚        â”‚         â”‚      â”‚         â”‚      â”‚         â”‚            â”‚
â”‚        â”‚  Vote   â”‚      â”‚  Vote   â”‚      â”‚  Vote   â”‚            â”‚
â”‚        â”‚  Data   â”‚      â”‚  Data   â”‚      â”‚ No Data â”‚            â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Processus de basculement (Failover)

Lorsque le Primary devient indisponible :

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Processus de Failover                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Ã‰tat initial                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚   â”‚ PRIMARY â”‚â—„â”€â”€â”€â”€â–ºâ”‚SECONDARYâ”‚â—„â”€â”€â”€â”€â–ºâ”‚SECONDARYâ”‚                 â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                 â”‚
â”‚   1. Le Primary tombe en panne                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚   â”‚    âœ—    â”‚      â”‚SECONDARYâ”‚â—„â”€â”€â”€â”€â–ºâ”‚SECONDARYâ”‚                 â”‚
â”‚   â”‚ (down)  â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚
â”‚                                                                 â”‚
â”‚   2. DÃ©tection (heartbeat) ~10 secondes                         â”‚
â”‚                                                                 â”‚
â”‚   3. Ã‰lection d'un nouveau Primary                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚   â”‚    âœ—    â”‚      â”‚ PRIMARY â”‚â—„â”€â”€â”€â”€â–ºâ”‚SECONDARYâ”‚                 â”‚
â”‚   â”‚ (down)  â”‚      â”‚  (new)  â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚                                                                 â”‚
â”‚   4. L'ancien Primary revient comme Secondary                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚   â”‚SECONDARYâ”‚â—„â”€â”€â”€â”€â–ºâ”‚ PRIMARY â”‚â—„â”€â”€â”€â”€â–ºâ”‚SECONDARYâ”‚                 â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### L'Oplog (Operations Log)

L'**oplog** est une collection spÃ©ciale (`local.oplog.rs`) qui enregistre toutes les opÃ©rations d'Ã©criture. Les Secondaries lisent l'oplog du Primary pour rÃ©pliquer les donnÃ©es.

```json
// Exemple d'entrÃ©e oplog
{
  "ts": Timestamp(1701234567, 1),
  "op": "i",                        // i=insert, u=update, d=delete
  "ns": "ecommerce.products",       // namespace (base.collection)
  "o": {                            // objet de l'opÃ©ration
    "_id": ObjectId("..."),
    "name": "Nouveau produit",
    "price": 99.99
  }
}
```

---

## Architecture Sharded Cluster (ScalabilitÃ©)

Le **sharding** permet de distribuer les donnÃ©es sur plusieurs serveurs pour gÃ©rer de trÃ¨s gros volumes.

### SchÃ©ma complet

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Architecture Sharded Cluster                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚                          â”‚ Application â”‚                                â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                 â”‚                                       â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                    â”‚            â”‚            â”‚                          â”‚
â”‚                    â–¼            â–¼            â–¼                          â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚              â”‚ mongos  â”‚  â”‚ mongos  â”‚  â”‚ mongos  â”‚   Query Routers      â”‚
â”‚              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   (routeurs)         â”‚
â”‚                   â”‚            â”‚            â”‚                           â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                â”‚                                        â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚              â”‚                 â”‚                 â”‚                      â”‚
â”‚              â–¼                 â–¼                 â–¼                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚   â”‚ Config Server â”‚  â”‚ Config Server â”‚  â”‚ Config Server â”‚  Config       â”‚
â”‚   â”‚   (Primary)   â”‚  â”‚  (Secondary)  â”‚  â”‚  (Secondary)  â”‚  Servers      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  (mÃ©tadonnÃ©es)â”‚
â”‚                                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                          Shards                                 â”‚   â”‚
â”‚   â”‚                                                                 â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚   â”‚   â”‚    Shard A      â”‚   â”‚    Shard B      â”‚   â”‚   Shard C    â”‚  â”‚   â”‚
â”‚   â”‚   â”‚  (Replica Set)  â”‚   â”‚  (Replica Set)  â”‚   â”‚(Replica Set) â”‚  â”‚   â”‚
â”‚   â”‚   â”‚                 â”‚   â”‚                 â”‚   â”‚              â”‚  â”‚   â”‚
â”‚   â”‚   â”‚ â”Œâ”€â”€â”€â”â”Œâ”€â”€â”€â”â”Œâ”€â”€â”€â” â”‚   â”‚ â”Œâ”€â”€â”€â”â”Œâ”€â”€â”€â”â”Œâ”€â”€â”€â” â”‚   â”‚â”Œâ”€â”€â”€â”â”Œâ”€â”€â”€â”â”Œâ”€â”€â”â”‚  â”‚   â”‚
â”‚   â”‚   â”‚ â”‚ P â”‚â”‚ S â”‚â”‚ S â”‚ â”‚   â”‚ â”‚ P â”‚â”‚ S â”‚â”‚ S â”‚ â”‚   â”‚â”‚ P â”‚â”‚ S â”‚â”‚S â”‚â”‚  â”‚   â”‚
â”‚   â”‚   â”‚ â””â”€â”€â”€â”˜â””â”€â”€â”€â”˜â””â”€â”€â”€â”˜ â”‚   â”‚ â””â”€â”€â”€â”˜â””â”€â”€â”€â”˜â””â”€â”€â”€â”˜ â”‚   â”‚â””â”€â”€â”€â”˜â””â”€â”€â”€â”˜â””â”€â”€â”˜â”‚  â”‚   â”‚
â”‚   â”‚   â”‚                 â”‚   â”‚                 â”‚   â”‚              â”‚  â”‚   â”‚
â”‚   â”‚   â”‚  DonnÃ©es A-M    â”‚   â”‚  DonnÃ©es N-T    â”‚   â”‚ DonnÃ©es U-Z  â”‚  â”‚   â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚   â”‚                                                                 â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Composants du Sharded Cluster

#### 1. Shards

Chaque **shard** contient une partie des donnÃ©es. En production, chaque shard est un Replica Set pour garantir la haute disponibilitÃ©.

```
DonnÃ©es totales : 300 GB

Shard A : 100 GB (utilisateurs A-M)
Shard B : 100 GB (utilisateurs N-T)
Shard C : 100 GB (utilisateurs U-Z)
```

#### 2. Config Servers

Les **Config Servers** stockent les mÃ©tadonnÃ©es du cluster :

- Quelles donnÃ©es sont sur quel shard
- Configuration du cluster
- Ã‰tat du balancer

En production, les Config Servers forment un Replica Set de 3 membres.

#### 3. Query Routers (mongos)

Les processus **mongos** servent d'interface entre les applications et le cluster :

- ReÃ§oivent les requÃªtes des applications
- DÃ©terminent quel(s) shard(s) contiennent les donnÃ©es
- AgrÃ¨gent les rÃ©sultats si nÃ©cessaire

### La Shard Key

La **shard key** est le champ (ou ensemble de champs) utilisÃ© pour distribuer les donnÃ©es entre les shards.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Distribution par Shard Key                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Shard Key : "user_id"                                         â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   â”‚    Shard A    â”‚  â”‚    Shard B    â”‚  â”‚    Shard C    â”‚       â”‚
â”‚   â”‚               â”‚  â”‚               â”‚  â”‚               â”‚       â”‚
â”‚   â”‚  user_id:     â”‚  â”‚  user_id:     â”‚  â”‚  user_id:     â”‚       â”‚
â”‚   â”‚  1 - 100000   â”‚  â”‚ 100001-200000 â”‚  â”‚ 200001-300000 â”‚       â”‚
â”‚   â”‚               â”‚  â”‚               â”‚  â”‚               â”‚       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                 â”‚
â”‚   RequÃªte : find({ user_id: 150000 })                           â”‚
â”‚   â†’ RoutÃ©e uniquement vers Shard B                              â”‚
â”‚                                                                 â”‚
â”‚   RequÃªte : find({ status: "active" })                          â”‚
â”‚   â†’ RoutÃ©e vers TOUS les shards (scatter-gather)                â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Chunks et Balancing

Les donnÃ©es sont divisÃ©es en **chunks** (morceaux) qui sont rÃ©partis entre les shards :

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Chunks et Balancing                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Avant balancing (dÃ©sÃ©quilibrÃ©)                                â”‚
â”‚                                                                 â”‚
â”‚   Shard A          Shard B          Shard C                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚   â”‚ Chunk 1  â”‚     â”‚ Chunk 4  â”‚     â”‚ Chunk 6  â”‚                â”‚
â”‚   â”‚ Chunk 2  â”‚     â”‚ Chunk 5  â”‚     â”‚          â”‚                â”‚
â”‚   â”‚ Chunk 3  â”‚     â”‚          â”‚     â”‚          â”‚                â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚   3 chunks         2 chunks         1 chunk                     â”‚
â”‚                                                                 â”‚
â”‚   AprÃ¨s balancing (Ã©quilibrÃ© par le Balancer)                   â”‚
â”‚                                                                 â”‚
â”‚   Shard A          Shard B          Shard C                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚   â”‚ Chunk 1  â”‚     â”‚ Chunk 3  â”‚     â”‚ Chunk 5  â”‚                â”‚
â”‚   â”‚ Chunk 2  â”‚     â”‚ Chunk 4  â”‚     â”‚ Chunk 6  â”‚                â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚   2 chunks         2 chunks         2 chunks                    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Communication client-serveur

### ChaÃ®ne de connexion (Connection String)

Les applications se connectent Ã  MongoDB via une **chaÃ®ne de connexion** :

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Format Connection String                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   mongodb://[user:password@]host[:port]/[database][?options]    â”‚
â”‚                                                                 â”‚
â”‚   Exemples :                                                    â”‚
â”‚                                                                 â”‚
â”‚   # Instance locale simple                                      â”‚
â”‚   mongodb://localhost:27017                                     â”‚
â”‚                                                                 â”‚
â”‚   # Avec authentification                                       â”‚
â”‚   mongodb://admin:secret@localhost:27017/mydb                   â”‚
â”‚                                                                 â”‚
â”‚   # Replica Set                                                 â”‚
â”‚   mongodb://host1:27017,host2:27017,host3:27017/mydb            â”‚
â”‚            ?replicaSet=myRS                                     â”‚
â”‚                                                                 â”‚
â”‚   # MongoDB Atlas                                               â”‚
â”‚   mongodb+srv://user:pass@cluster.mongodb.net/mydb              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Protocole de communication

MongoDB utilise un protocole binaire sur TCP/IP :

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Flux de communication                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Application                         MongoDB Server            â”‚
â”‚       â”‚                                     â”‚                   â”‚
â”‚       â”‚  1. Connexion TCP (port 27017)      â”‚                   â”‚
â”‚       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                   â”‚
â”‚       â”‚                                     â”‚                   â”‚
â”‚       â”‚  2. Authentification (si activÃ©e)   â”‚                   â”‚
â”‚       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                   â”‚
â”‚       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
â”‚       â”‚                                     â”‚                   â”‚
â”‚       â”‚  3. RequÃªte (format BSON)           â”‚                   â”‚
â”‚       â”‚  find({ name: "Alice" })            â”‚                   â”‚
â”‚       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                   â”‚
â”‚       â”‚                                     â”‚                   â”‚
â”‚       â”‚  4. RÃ©ponse (format BSON)           â”‚                   â”‚
â”‚       â”‚  [{ _id: 1, name: "Alice", ... }]   â”‚                   â”‚
â”‚       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
â”‚       â”‚                                     â”‚                   â”‚
â”‚       â”‚  5. Maintien connexion (pool)       â”‚                   â”‚
â”‚       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Connection Pooling

Les drivers MongoDB maintiennent un **pool de connexions** pour optimiser les performances :

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Connection Pool                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Application                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚   â”‚                                              â”‚              â”‚
â”‚   â”‚   Thread 1 â”€â”                                â”‚              â”‚
â”‚   â”‚   Thread 2 â”€â”¼â”€â–º Pool de connexions           â”‚              â”‚
â”‚   â”‚   Thread 3 â”€â”¤   â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”   â”‚              â”‚
â”‚   â”‚   Thread 4 â”€â”˜   â”‚ C1 â”‚ C2 â”‚ C3 â”‚ C4 â”‚ C5 â”‚   â”‚              â”‚
â”‚   â”‚                 â””â”€â”€â”¬â”€â”´â”€â”€â”¬â”€â”´â”€â”€â”¬â”€â”´â”€â”€â”¬â”€â”´â”€â”€â”¬â”€â”˜   â”‚              â”‚
â”‚   â”‚                    â”‚    â”‚    â”‚    â”‚    â”‚     â”‚              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                        â”‚    â”‚    â”‚    â”‚    â”‚                    â”‚
â”‚                        â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜                    â”‚
â”‚                               â”‚                                 â”‚
â”‚                               â–¼                                 â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                        â”‚  MongoDB  â”‚                            â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                                                                 â”‚
â”‚   Avantages :                                                   â”‚
â”‚   â€¢ RÃ©utilisation des connexions                                â”‚
â”‚   â€¢ RÃ©duction de la latence                                     â”‚
â”‚   â€¢ Meilleure gestion des ressources                            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Structure des fichiers sur le disque

MongoDB stocke ses donnÃ©es dans un rÃ©pertoire configurable (par dÃ©faut `/data/db` ou `/var/lib/mongodb`) :

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Structure des fichiers                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   /var/lib/mongodb/                                             â”‚
â”‚   â”‚                                                             â”‚
â”‚   â”œâ”€â”€ WiredTiger                    # Fichier de configuration  â”‚
â”‚   â”œâ”€â”€ WiredTiger.wt                 # MÃ©tadonnÃ©es WiredTiger    â”‚
â”‚   â”œâ”€â”€ WiredTigerHS.wt               # History store             â”‚
â”‚   â”œâ”€â”€ WiredTiger.lock               # Verrou d'instance         â”‚
â”‚   â”‚                                                             â”‚
â”‚   â”œâ”€â”€ collection-0-xxx.wt           # DonnÃ©es collection        â”‚
â”‚   â”œâ”€â”€ collection-2-xxx.wt           # DonnÃ©es collection        â”‚
â”‚   â”œâ”€â”€ index-1-xxx.wt                # Index                     â”‚
â”‚   â”œâ”€â”€ index-3-xxx.wt                # Index                     â”‚
â”‚   â”‚                                                             â”‚
â”‚   â”œâ”€â”€ journal/                      # Journaux de transactions  â”‚
â”‚   â”‚   â”œâ”€â”€ WiredTigerLog.0000000001                              â”‚
â”‚   â”‚   â””â”€â”€ WiredTigerLog.0000000002                              â”‚
â”‚   â”‚                                                             â”‚
â”‚   â”œâ”€â”€ diagnostic.data/              # DonnÃ©es de diagnostic     â”‚
â”‚   â”‚                                                             â”‚
â”‚   â””â”€â”€ mongod.lock                   # Verrou du processus       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## RÃ©capitulatif des architectures

| Architecture | Cas d'utilisation | Haute dispo. | ScalabilitÃ© | ComplexitÃ© |
|--------------|-------------------|--------------|-------------|------------|
| **Standalone** | Dev, test | âŒ | âŒ | Faible |
| **Replica Set** | Production standard | âœ… | Verticale | Moyenne |
| **Sharded Cluster** | Big data, forte charge | âœ… | Horizontale | Ã‰levÃ©e |

### Recommandations

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Guide de choix                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   DÃ©veloppement local ?                                         â”‚
â”‚   â””â”€â–º Standalone (simple instance mongod)                       â”‚
â”‚                                                                 â”‚
â”‚   Production avec donnÃ©es importantes ?                         â”‚
â”‚   â””â”€â–º Replica Set (minimum 3 membres)                           â”‚
â”‚                                                                 â”‚
â”‚   DonnÃ©es > 100 GB ou > 10 000 req/sec ?                        â”‚
â”‚   â””â”€â–º Ã‰valuer le Sharding                                       â”‚
â”‚                                                                 â”‚
â”‚   Pas envie de gÃ©rer l'infrastructure ?                         â”‚
â”‚   â””â”€â–º MongoDB Atlas (service cloud managÃ©)                      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Conclusion

L'architecture de MongoDB est conÃ§ue pour rÃ©pondre Ã  diffÃ©rents besoins, de la simplicitÃ© du dÃ©veloppement local Ã  la complexitÃ© des dÃ©ploiements distribuÃ©s Ã  grande Ã©chelle.

Les points essentiels Ã  retenir :

- **mongod** est le processus serveur principal
- **WiredTiger** est le moteur de stockage par dÃ©faut, offrant compression et performances
- Les **Replica Sets** assurent la haute disponibilitÃ© via la rÃ©plication
- Le **Sharding** permet la scalabilitÃ© horizontale pour les gros volumes
- La hiÃ©rarchie **Base â†’ Collection â†’ Document** organise les donnÃ©es

Dans les prochaines sections, nous explorerons la terminologie en dÃ©tail, puis passerons Ã  l'installation pratique de MongoDB.

---

## Points clÃ©s Ã  retenir

- **mongod** = processus serveur de base de donnÃ©es
- **mongos** = routeur de requÃªtes (clusters shardÃ©s uniquement)
- **mongosh** = shell client pour interagir avec MongoDB
- **WiredTiger** = moteur de stockage par dÃ©faut (compression, performance)
- **Replica Set** = groupe de serveurs pour la haute disponibilitÃ©
- **Sharding** = distribution des donnÃ©es pour la scalabilitÃ©
- **Oplog** = journal des opÃ©rations pour la rÃ©plication
- **Connection Pool** = rÃ©utilisation des connexions pour la performance

---


â­ï¸ [Terminologie : Documents, Collections, Bases de donnÃ©es](/01-introduction-a-mongodb/07-terminologie.md)
