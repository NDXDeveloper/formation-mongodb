ğŸ” Retour au [Sommaire](/SOMMAIRE.md)

# 1.4.3 Eventual Consistency vs Strong Consistency

## Introduction

Dans le monde des bases de donnÃ©es distribuÃ©es, la **cohÃ©rence** (consistency) est un concept central. Mais toutes les formes de cohÃ©rence ne se valent pas. Il existe un spectre allant de la **cohÃ©rence forte** (strong consistency) Ã  la **cohÃ©rence Ã©ventuelle** (eventual consistency).

Comprendre ces concepts vous aidera Ã  faire les bons choix de configuration pour vos applications MongoDB et Ã  anticiper le comportement de vos donnÃ©es dans diffÃ©rentes situations.

---

## Le spectre de la cohÃ©rence

La cohÃ©rence dans les systÃ¨mes distribuÃ©s n'est pas binaire. Elle se prÃ©sente comme un **spectre** avec diffÃ©rents niveaux de garanties :

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Le spectre de la cohÃ©rence                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   CohÃ©rence                                              CohÃ©rence  â”‚
â”‚   FORTE                                                  Ã‰VENTUELLE â”‚
â”‚                                                                     â”‚
â”‚   â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚
â”‚   â”‚                                                             â”‚   â”‚
â”‚   â”‚  Linearizable  â”‚  Sequential  â”‚  Causal  â”‚  Eventual        â”‚   â”‚
â”‚   â”‚                â”‚              â”‚          â”‚                  â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚   â–²                                                             â–²   â”‚
â”‚   â”‚                                                             â”‚   â”‚
â”‚   â”‚ â€¢ Garanties maximales          â€¢ Garanties minimales        â”‚   â”‚
â”‚   â”‚ â€¢ Latence plus Ã©levÃ©e          â€¢ Latence minimale           â”‚   â”‚
â”‚   â”‚ â€¢ DisponibilitÃ© rÃ©duite        â€¢ Haute disponibilitÃ©        â”‚   â”‚
â”‚   â”‚ â€¢ DonnÃ©es toujours Ã  jour      â€¢ DonnÃ©es temporairement     â”‚   â”‚
â”‚   â”‚                                  obsolÃ¨tes possibles        â”‚   â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Strong Consistency (CohÃ©rence forte)

### DÃ©finition

La **cohÃ©rence forte** garantit que toute lecture aprÃ¨s une Ã©criture retournera **toujours** la valeur la plus rÃ©cente. Tous les nÅ“uds du systÃ¨me voient les mÃªmes donnÃ©es au mÃªme moment.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CohÃ©rence forte                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   Temps â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º     â”‚
â”‚                                                                     â”‚
â”‚   T1: Client A Ã©crit X = 10                                         â”‚
â”‚       â”‚                                                             â”‚
â”‚       â–¼                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚                    SYNCHRONISATION                        â”‚     â”‚
â”‚   â”‚   NÅ“ud 1: X = 10  â—„â”€â”€â–º  NÅ“ud 2: X = 10  â—„â”€â”€â–º  NÅ“ud 3: X = 10    â”‚
â”‚   â”‚                    (tous synchronisÃ©s)                    â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                     â”‚
â”‚   T2: Client B lit X (sur n'importe quel nÅ“ud)                      â”‚
â”‚       â”‚                                                             â”‚
â”‚       â–¼                                                             â”‚
â”‚   RÃ©sultat : X = 10 (TOUJOURS)                                      â”‚
â”‚                                                                     â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                     â”‚
â”‚   Garantie : AprÃ¨s T1, TOUTE lecture retourne 10                    â”‚
â”‚   Peu importe le nÅ“ud interrogÃ©                                     â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### CaractÃ©ristiques

| CaractÃ©ristique | Description |
|-----------------|-------------|
| **Garantie** | Toute lecture voit l'Ã©criture la plus rÃ©cente |
| **Ordre** | Toutes les opÃ©rations sont vues dans le mÃªme ordre par tous |
| **Latence** | Plus Ã©levÃ©e (attente de synchronisation) |
| **DisponibilitÃ©** | RÃ©duite en cas de partition rÃ©seau |
| **ImplÃ©mentation** | NÃ©cessite une coordination entre nÅ“uds |

### Comment MongoDB implÃ©mente la cohÃ©rence forte

MongoDB peut garantir une cohÃ©rence forte avec la bonne configuration :

```javascript
// Configuration pour cohÃ©rence forte
const options = {
  writeConcern: { w: "majority", j: true },
  readConcern: { level: "linearizable" },
  readPreference: "primary"
};

// Ã‰criture avec cohÃ©rence forte
await db.collection("comptes").updateOne(
  { _id: "compte123" },
  { $set: { solde: 1000 } },
  { writeConcern: { w: "majority", j: true } }
);

// Lecture avec cohÃ©rence forte
const compte = await db.collection("comptes")
  .find({ _id: "compte123" })
  .readConcern("linearizable")
  .readPreference("primary")
  .next();

// Garantie : compte.solde === 1000
```

### Quand utiliser la cohÃ©rence forte ?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Cas d'usage pour la cohÃ©rence forte                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   ğŸ¦ TRANSACTIONS FINANCIÃˆRES                                       â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                      â”‚
â”‚   â€¢ Transferts bancaires                                            â”‚
â”‚   â€¢ Paiements                                                       â”‚
â”‚   â€¢ DÃ©bits/crÃ©dits                                                  â”‚
â”‚   â†’ Une erreur peut coÃ»ter de l'argent                              â”‚
â”‚                                                                     â”‚
â”‚   ğŸ“¦ GESTION D'INVENTAIRE                                           â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                           â”‚
â”‚   â€¢ Stock disponible                                                â”‚
â”‚   â€¢ RÃ©servations                                                    â”‚
â”‚   â€¢ Allocations                                                     â”‚
â”‚   â†’ Ã‰viter de vendre ce qu'on n'a pas                               â”‚
â”‚                                                                     â”‚
â”‚   âœˆï¸ SYSTÃˆMES DE RÃ‰SERVATION                                        â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                         â”‚
â”‚   â€¢ SiÃ¨ges d'avion                                                  â”‚
â”‚   â€¢ Chambres d'hÃ´tel                                                â”‚
â”‚   â€¢ Places de concert                                               â”‚
â”‚   â†’ Un siÃ¨ge ne peut Ãªtre vendu qu'une fois                         â”‚
â”‚                                                                     â”‚
â”‚   ğŸ” AUTHENTIFICATION ET AUTORISATION                               â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                               â”‚
â”‚   â€¢ Changement de mot de passe                                      â”‚
â”‚   â€¢ RÃ©vocation de tokens                                            â”‚
â”‚   â€¢ Modification de permissions                                     â”‚
â”‚   â†’ Les changements de sÃ©curitÃ© doivent Ãªtre immÃ©diats              â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Eventual Consistency (CohÃ©rence Ã©ventuelle)

### DÃ©finition

La **cohÃ©rence Ã©ventuelle** garantit que, si aucune nouvelle mise Ã  jour n'est effectuÃ©e, **tous les nÅ“uds finiront par** retourner la mÃªme valeur. Il peut y avoir un dÃ©lai pendant lequel diffÃ©rents nÅ“uds retournent des valeurs diffÃ©rentes.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CohÃ©rence Ã©ventuelle                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   Temps â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º     â”‚
â”‚                                                                     â”‚
â”‚   T1: Client A Ã©crit X = 10 (sur NÅ“ud 1)                            â”‚
â”‚       â”‚                                                             â”‚
â”‚       â–¼                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚   â”‚ NÅ“ud 1  â”‚      â”‚ NÅ“ud 2  â”‚      â”‚ NÅ“ud 3  â”‚                     â”‚
â”‚   â”‚ X = 10  â”‚  Â·Â·â–º â”‚ X = 5   â”‚      â”‚ X = 5   â”‚                     â”‚
â”‚   â”‚ (Ã  jour)â”‚      â”‚(ancien) â”‚      â”‚(ancien) â”‚                     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                    rÃ©plication en cours...                          â”‚
â”‚                                                                     â”‚
â”‚   T2: Client B lit X (sur NÅ“ud 2)                                   â”‚
â”‚       RÃ©sultat : X = 5 (valeur obsolÃ¨te !)                          â”‚
â”‚                                                                     â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚                                                                     â”‚
â”‚   T3: RÃ©plication terminÃ©e                                          â”‚
â”‚       â”‚                                                             â”‚
â”‚       â–¼                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚   â”‚ NÅ“ud 1  â”‚      â”‚ NÅ“ud 2  â”‚      â”‚ NÅ“ud 3  â”‚                     â”‚
â”‚   â”‚ X = 10  â”‚      â”‚ X = 10  â”‚      â”‚ X = 10  â”‚                     â”‚
â”‚   â”‚         â”‚      â”‚(Ã  jour) â”‚      â”‚(Ã  jour) â”‚                     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                     â”‚
â”‚   T4: Client B lit X (sur n'importe quel nÅ“ud)                      â”‚
â”‚       RÃ©sultat : X = 10 (cohÃ©rent)                                  â”‚
â”‚                                                                     â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                     â”‚
â”‚   "Ã‰ventuellement" = aprÃ¨s un dÃ©lai (millisecondes Ã  secondes)      â”‚
â”‚   tous les nÅ“uds convergent vers la mÃªme valeur                     â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### CaractÃ©ristiques

| CaractÃ©ristique | Description |
|-----------------|-------------|
| **Garantie** | Convergence des donnÃ©es "Ã  terme" |
| **FenÃªtre d'incohÃ©rence** | PÃ©riode oÃ¹ les donnÃ©es peuvent diffÃ©rer |
| **Latence** | Minimale (pas d'attente de synchronisation) |
| **DisponibilitÃ©** | Maximale |
| **ImplÃ©mentation** | RÃ©plication asynchrone |

### La fenÃªtre d'incohÃ©rence

Le concept clÃ© de la cohÃ©rence Ã©ventuelle est la **fenÃªtre d'incohÃ©rence** (inconsistency window) :

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  FenÃªtre d'incohÃ©rence                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   Temps â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º     â”‚
â”‚                                                                     â”‚
â”‚         Ã‰criture                          CohÃ©rence                 â”‚
â”‚         confirmÃ©e                         atteinte                  â”‚
â”‚             â”‚                                 â”‚                     â”‚
â”‚             â–¼                                 â–¼                     â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚             â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                      â”‚
â”‚             â”‚                                 â”‚                     â”‚
â”‚             â”‚    FENÃŠTRE D'INCOHÃ‰RENCE        â”‚                     â”‚
â”‚             â”‚                                 â”‚                     â”‚
â”‚             â”‚  â€¢ DiffÃ©rents nÅ“uds peuvent     â”‚                     â”‚
â”‚             â”‚    retourner des valeurs        â”‚                     â”‚
â”‚             â”‚    diffÃ©rentes                  â”‚                     â”‚
â”‚             â”‚                                 â”‚                     â”‚
â”‚             â”‚  â€¢ DurÃ©e typique : quelques     â”‚                     â”‚
â”‚             â”‚    millisecondes Ã  secondes     â”‚                     â”‚
â”‚             â”‚                                 â”‚                     â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚                                                                     â”‚
â”‚   Facteurs influenÃ§ant la durÃ©e :                                   â”‚
â”‚   â€¢ Latence rÃ©seau entre les nÅ“uds                                  â”‚
â”‚   â€¢ Charge du systÃ¨me                                               â”‚
â”‚   â€¢ Distance gÃ©ographique                                           â”‚
â”‚   â€¢ Taille des donnÃ©es Ã  rÃ©pliquer                                  â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Comment MongoDB implÃ©mente la cohÃ©rence Ã©ventuelle

Par dÃ©faut, avec certaines configurations, MongoDB offre une cohÃ©rence Ã©ventuelle :

```javascript
// Configuration pour cohÃ©rence Ã©ventuelle (haute performance)
// Ã‰criture rapide sans attendre la rÃ©plication
await db.collection("analytics").insertOne(
  { event: "page_view", page: "/home", timestamp: new Date() },
  { writeConcern: { w: 1 } }  // Confirme seulement sur le Primary
);

// Lecture sur un Secondary (peut retourner des donnÃ©es obsolÃ¨tes)
const recentViews = await db.collection("analytics")
  .find({ page: "/home" })
  .readPreference("secondary")  // Lit sur un Secondary
  .readConcern("local")          // DonnÃ©es locales, pas forcÃ©ment rÃ©pliquÃ©es
  .toArray();
```

### Quand utiliser la cohÃ©rence Ã©ventuelle ?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Cas d'usage pour la cohÃ©rence Ã©ventuelle                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   ğŸ“Š ANALYTICS ET MÃ‰TRIQUES                                         â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                         â”‚
â”‚   â€¢ Compteurs de pages vues                                         â”‚
â”‚   â€¢ Statistiques d'utilisation                                      â”‚
â”‚   â€¢ Tableaux de bord                                                â”‚
â”‚   â†’ Une valeur lÃ©gÃ¨rement obsolÃ¨te est acceptable                   â”‚
â”‚                                                                     â”‚
â”‚   ğŸ‘ RÃ‰SEAUX SOCIAUX                                                â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                â”‚
â”‚   â€¢ Nombre de likes                                                 â”‚
â”‚   â€¢ Compteur de followers                                           â”‚
â”‚   â€¢ Timeline de posts                                               â”‚
â”‚   â†’ 1000 likes vs 1003 likes, peu importe                           â”‚
â”‚                                                                     â”‚
â”‚   ğŸ›’ PANIER D'ACHAT (lecture)                                       â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                         â”‚
â”‚   â€¢ Affichage du contenu du panier                                  â”‚
â”‚   â€¢ Suggestions de produits                                         â”‚
â”‚   â†’ La validation finale vÃ©rifiera la cohÃ©rence                     â”‚
â”‚                                                                     â”‚
â”‚   ğŸ“ SYSTÃˆMES DE LOGS                                               â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                               â”‚
â”‚   â€¢ Logs applicatifs                                                â”‚
â”‚   â€¢ Traces d'Ã©vÃ©nements                                             â”‚
â”‚   â€¢ Audit trail (non critique)                                      â”‚
â”‚   â†’ Volume Ã©levÃ©, cohÃ©rence moins critique                          â”‚
â”‚                                                                     â”‚
â”‚   ğŸ”” NOTIFICATIONS                                                  â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                  â”‚
â”‚   â€¢ Alertes non critiques                                           â”‚
â”‚   â€¢ Badges de notification                                          â”‚
â”‚   â†’ Un lÃ©ger dÃ©lai est acceptable                                   â”‚
â”‚                                                                     â”‚
â”‚   ğŸ’¾ CACHE ET SESSIONS                                              â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                              â”‚
â”‚   â€¢ DonnÃ©es de session                                              â”‚
â”‚   â€¢ Cache d'application                                             â”‚
â”‚   â†’ Performance prioritaire                                         â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Comparaison dÃ©taillÃ©e

### Tableau comparatif

| Aspect | CohÃ©rence forte | CohÃ©rence Ã©ventuelle |
|--------|-----------------|----------------------|
| **Garantie** | Lecture = derniÃ¨re Ã©criture | Convergence Ã  terme |
| **Latence Ã©criture** | Ã‰levÃ©e (attend synchronisation) | Faible |
| **Latence lecture** | Variable | Faible |
| **DisponibilitÃ©** | RÃ©duite si partition | Haute |
| **ScalabilitÃ©** | Plus difficile | Plus facile |
| **ComplexitÃ© applicative** | Faible | Plus Ã©levÃ©e |
| **CoÃ»t rÃ©seau** | Ã‰levÃ© | Faible |

### Visualisation des diffÃ©rences

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          CohÃ©rence forte vs CohÃ©rence Ã©ventuelle                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   COHÃ‰RENCE FORTE                                                   â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                   â”‚
â”‚                                                                     â”‚
â”‚   Client â”€â”€â–º Ã‰criture â”€â”€â–º PRIMARY â”€â”€â”¬â”€â”€â–º SECONDARY 1                â”‚
â”‚                             â”‚       â”‚                               â”‚
â”‚                             â”‚       â””â”€â”€â–º SECONDARY 2                â”‚
â”‚                             â”‚                 â”‚                     â”‚
â”‚                             â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                             â”‚    (attend confirmation)              â”‚
â”‚                             â–¼                                       â”‚
â”‚                          "OK" â”€â”€â–º Client                            â”‚
â”‚                                                                     â”‚
â”‚   Temps total : ~50-200ms (selon rÃ©seau)                            â”‚
â”‚   Garantie : DonnÃ©es visibles partout immÃ©diatement                 â”‚
â”‚                                                                     â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚                                                                     â”‚
â”‚   COHÃ‰RENCE Ã‰VENTUELLE                                              â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                              â”‚
â”‚                                                                     â”‚
â”‚   Client â”€â”€â–º Ã‰criture â”€â”€â–º PRIMARY â”€â”€â–º "OK" â”€â”€â–º Client               â”‚
â”‚                             â”‚                                       â”‚
â”‚                             â”‚ (rÃ©plication asynchrone)              â”‚
â”‚                             â–¼                                       â”‚
â”‚                          SECONDARY 1                                â”‚
â”‚                             â”‚                                       â”‚
â”‚                             â–¼                                       â”‚
â”‚                          SECONDARY 2                                â”‚
â”‚                                                                     â”‚
â”‚   Temps pour "OK" : ~5-20ms                                         â”‚
â”‚   Temps rÃ©plication : ~10-100ms supplÃ©mentaires                     â”‚
â”‚   Garantie : DonnÃ©es cohÃ©rentes "Ã©ventuellement"                    â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Impact sur les lectures

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Impact sur les lectures                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   ScÃ©nario : Mise Ã  jour du profil utilisateur                      â”‚
â”‚                                                                     â”‚
â”‚   T0: User met Ã  jour son nom "Jean" â†’ "Jean-Pierre"                â”‚
â”‚                                                                     â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚                                                                     â”‚
â”‚   COHÃ‰RENCE FORTE (readConcern: "linearizable")                     â”‚
â”‚                                                                     â”‚
â”‚   T1: User rafraÃ®chit la page                                       â”‚
â”‚       â†’ Voit "Jean-Pierre" âœ… (garanti)                             â”‚
â”‚                                                                     â”‚
â”‚   T1: Autre utilisateur consulte le profil                          â”‚
â”‚       â†’ Voit "Jean-Pierre" âœ… (garanti)                             â”‚
â”‚                                                                     â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚                                                                     â”‚
â”‚   COHÃ‰RENCE Ã‰VENTUELLE (readPreference: "secondary")                â”‚
â”‚                                                                     â”‚
â”‚   T1: User rafraÃ®chit la page (lit sur Secondary)                   â”‚
â”‚       â†’ Peut voir "Jean" âš ï¸ (rÃ©plication en cours)                  â”‚
â”‚       â†’ Ou "Jean-Pierre" âœ… (si rÃ©plication terminÃ©e)               â”‚
â”‚                                                                     â”‚
â”‚   T2: Quelques millisecondes plus tard                              â”‚
â”‚       â†’ Voit "Jean-Pierre" âœ… (cohÃ©rent)                            â”‚
â”‚                                                                     â”‚
â”‚   L'utilisateur peut avoir l'impression que sa modification         â”‚
â”‚   n'a pas Ã©tÃ© prise en compte (frustrant !)                         â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Le problÃ¨me du "Read Your Own Writes"

### DÃ©finition du problÃ¨me

Un problÃ¨me courant avec la cohÃ©rence Ã©ventuelle est le **"Read Your Own Writes"** : un utilisateur fait une modification mais ne la voit pas immÃ©diatement lors de la lecture suivante.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ProblÃ¨me "Read Your Own Writes"                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   ScÃ©nario problÃ©matique :                                          â”‚
â”‚                                                                     â”‚
â”‚   1. Alice modifie son avatar                                       â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â”‚
â”‚      â”‚ Alice   â”‚â”€â”€â”€â”€ PUT /avatar â”€â”€â”€â”€â–º PRIMARY                      â”‚
â”‚      â”‚         â”‚â—„â”€â”€â”€ "OK" â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚                         â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚                         â”‚
â”‚                                           â–¼ (rÃ©plication...)        â”‚
â”‚                                       SECONDARY                     â”‚
â”‚                                                                     â”‚
â”‚   2. Alice rafraÃ®chit sa page (lecture sur Secondary)               â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â”‚
â”‚      â”‚ Alice   â”‚â”€â”€â”€â”€ GET /profile â”€â”€â”€â–º SECONDARY                    â”‚
â”‚      â”‚   ğŸ˜•    â”‚â—„â”€â”€â”€ ancien avatar â”€â”€     â”‚                         â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚                         â”‚
â”‚                                           â”‚                         â”‚
â”‚      "OÃ¹ est mon nouvel avatar ?!"        â”‚                         â”‚
â”‚                                           â”‚                         â”‚
â”‚   3. La rÃ©plication se termine                                      â”‚
â”‚                                       SECONDARY (avatar Ã  jour)     â”‚
â”‚                                                                     â”‚
â”‚   4. Alice rafraÃ®chit encore                                        â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                    â”‚
â”‚      â”‚ Alice   â”‚â”€â”€â”€â”€ GET /profile â”€â”€â”€â–º SECONDARY                    â”‚
â”‚      â”‚   ğŸ˜Š    â”‚â—„â”€â”€â”€ nouvel avatar â”€â”€â”€    â”‚                         â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                    â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Solutions dans MongoDB

#### Solution 1 : Lire sur le Primary aprÃ¨s Ã©criture

```javascript
// AprÃ¨s une Ã©criture, forcer la lecture sur le Primary
async function updateAndRead(userId, newData) {
  // Ã‰criture
  await db.collection("users").updateOne(
    { _id: userId },
    { $set: newData }
  );

  // Lecture immÃ©diate sur le Primary
  const user = await db.collection("users")
    .findOne(
      { _id: userId },
      { readPreference: "primary" }  // Force le Primary
    );

  return user;
}
```

#### Solution 2 : Utiliser readConcern "majority" aprÃ¨s writeConcern "majority"

```javascript
// Garantit que la lecture voit l'Ã©criture
async function updateAndReadConsistent(userId, newData) {
  // Ã‰criture avec confirmation majoritÃ©
  await db.collection("users").updateOne(
    { _id: userId },
    { $set: newData },
    { writeConcern: { w: "majority" } }
  );

  // Lecture avec readConcern majority
  const user = await db.collection("users")
    .findOne(
      { _id: userId },
      { readConcern: { level: "majority" } }
    );

  return user;
}
```

#### Solution 3 : Causal Consistency (sessions)

MongoDB supporte la **cohÃ©rence causale** via les sessions :

```javascript
// La cohÃ©rence causale garantit "read your own writes"
const session = client.startSession({ causalConsistency: true });

try {
  const usersCollection = db.collection("users");

  // Ã‰criture dans la session
  await usersCollection.updateOne(
    { _id: userId },
    { $set: { name: "Jean-Pierre" } },
    { session }
  );

  // Lecture dans la mÃªme session - verra l'Ã©criture prÃ©cÃ©dente
  const user = await usersCollection.findOne(
    { _id: userId },
    { session, readPreference: "secondary" }  // MÃªme sur un Secondary !
  );

  console.log(user.name);  // "Jean-Pierre" garanti

} finally {
  session.endSession();
}
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CohÃ©rence causale                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   Sans cohÃ©rence causale :                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚   â”‚Ã‰critureâ”‚â”€â”€â”€â–ºâ”‚Lecture â”‚    â”‚RÃ©sultatâ”‚                            â”‚
â”‚   â”‚  (T1)  â”‚    â”‚  (T2)  â”‚â”€â”€â”€â–ºâ”‚ ???    â”‚                            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚   Aucune garantie que T2 voit T1                                    â”‚
â”‚                                                                     â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚                                                                     â”‚
â”‚   Avec cohÃ©rence causale (session) :                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚   â”‚Ã‰critureâ”‚â”€â”€â”€â–ºâ”‚Lecture â”‚â”€â”€â”€â–ºâ”‚RÃ©sultatâ”‚                            â”‚
â”‚   â”‚  (T1)  â”‚    â”‚  (T2)  â”‚    â”‚  âœ…    â”‚                            â”‚
â”‚   â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚       â”‚             â”‚                                               â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚       Session avec causalConsistency: true                          â”‚
â”‚       T2 est garanti de voir T1                                     â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Niveaux de cohÃ©rence intermÃ©diaires

Entre la cohÃ©rence forte et Ã©ventuelle, il existe des niveaux intermÃ©diaires :

### 1. CohÃ©rence causale (Causal Consistency)

Garantit que les opÃ©rations causalement liÃ©es sont vues dans le bon ordre.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CohÃ©rence causale                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   Exemple : Conversation de chat                                    â”‚
â”‚                                                                     â”‚
â”‚   Alice: "Bonjour !"           (message 1)                          â”‚
â”‚      â”‚                                                              â”‚
â”‚      â””â”€â”€â–º cause â”€â”€â–º                                                 â”‚
â”‚                    Bob: "Salut Alice !"    (message 2)              â”‚
â”‚                       â”‚                                             â”‚
â”‚                       â””â”€â”€â–º cause â”€â”€â–º                                â”‚
â”‚                                      Alice: "Ã‡a va ?" (message 3)   â”‚
â”‚                                                                     â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚                                                                     â”‚
â”‚   CohÃ©rence causale garantit :                                      â”‚
â”‚   â€¢ Message 2 toujours vu APRÃˆS message 1                           â”‚
â”‚   â€¢ Message 3 toujours vu APRÃˆS message 2                           â”‚
â”‚   â€¢ L'ordre causal est prÃ©servÃ©                                     â”‚
â”‚                                                                     â”‚
â”‚   Ne garantit PAS :                                                 â”‚
â”‚   â€¢ L'ordre des messages non liÃ©s causalement                       â”‚
â”‚   â€¢ La visibilitÃ© immÃ©diate sur tous les nÅ“uds                      â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. CohÃ©rence de session (Session Consistency)

Garantit la cohÃ©rence au sein d'une session utilisateur.

```javascript
// Tous les reads/writes dans cette session sont cohÃ©rents
const session = client.startSession();

await collection.insertOne({ x: 1 }, { session });
await collection.findOne({ x: 1 }, { session });  // Verra l'insert

session.endSession();
```

### 3. Read Your Writes Consistency

Garantit qu'un client voit ses propres Ã©critures.

### 4. Monotonic Read Consistency

Garantit que les lectures ne "reculent" jamais dans le temps.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Monotonic Read Consistency                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   âŒ SANS monotonic reads :                                         â”‚
â”‚                                                                     â”‚
â”‚   T1: Lecture â†’ X = 10                                              â”‚
â”‚   T2: Lecture â†’ X = 5  (recul dans le temps !)                      â”‚
â”‚   T3: Lecture â†’ X = 10                                              â”‚
â”‚                                                                     â”‚
â”‚   Peut arriver si les lectures vont sur diffÃ©rents nÅ“uds            â”‚
â”‚   avec des Ã©tats de rÃ©plication diffÃ©rents.                         â”‚
â”‚                                                                     â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚                                                                     â”‚
â”‚   âœ… AVEC monotonic reads :                                         â”‚
â”‚                                                                     â”‚
â”‚   T1: Lecture â†’ X = 10                                              â”‚
â”‚   T2: Lecture â†’ X = 10 ou plus rÃ©cent                               â”‚
â”‚   T3: Lecture â†’ X = 10 ou plus rÃ©cent                               â”‚
â”‚                                                                     â”‚
â”‚   Les valeurs ne peuvent que progresser, jamais reculer.            â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Configuration MongoDB pour chaque niveau

### RÃ©capitulatif des configurations

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Configurations MongoDB par niveau de cohÃ©rence           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   COHÃ‰RENCE FORTE (Linearizable)                                    â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                    â”‚
â”‚   writeConcern: { w: "majority", j: true }                          â”‚
â”‚   readConcern: "linearizable"                                       â”‚
â”‚   readPreference: "primary"                                         â”‚
â”‚                                                                     â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚                                                                     â”‚
â”‚   COHÃ‰RENCE MAJORITAIRE                                             â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                             â”‚
â”‚   writeConcern: { w: "majority" }                                   â”‚
â”‚   readConcern: "majority"                                           â”‚
â”‚   readPreference: "primary" ou "primaryPreferred"                   â”‚
â”‚                                                                     â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚                                                                     â”‚
â”‚   COHÃ‰RENCE CAUSALE                                                 â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                  â”‚
â”‚   Session avec causalConsistency: true                              â”‚
â”‚   writeConcern: { w: "majority" }                                   â”‚
â”‚   readConcern: "majority"                                           â”‚
â”‚   readPreference: n'importe (mÃªme "secondary")                      â”‚
â”‚                                                                     â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚                                                                     â”‚
â”‚   COHÃ‰RENCE Ã‰VENTUELLE                                              â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                              â”‚
â”‚   writeConcern: { w: 1 }                                            â”‚
â”‚   readConcern: "local"                                              â”‚
â”‚   readPreference: "secondary" ou "nearest"                          â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Exemples de code complets

```javascript
// === COHÃ‰RENCE FORTE ===
async function transfertBancaire(source, dest, montant) {
  const session = client.startSession();
  try {
    session.startTransaction({
      readConcern: { level: "snapshot" },
      writeConcern: { w: "majority" }
    });

    await comptes.updateOne(
      { _id: source, solde: { $gte: montant } },
      { $inc: { solde: -montant } },
      { session }
    );

    await comptes.updateOne(
      { _id: dest },
      { $inc: { solde: montant } },
      { session }
    );

    await session.commitTransaction();
  } catch (error) {
    await session.abortTransaction();
    throw error;
  } finally {
    session.endSession();
  }
}

// === COHÃ‰RENCE CAUSALE ===
async function posterEtLireCommentaire(userId, postId, texte) {
  const session = client.startSession({ causalConsistency: true });

  try {
    // Poster le commentaire
    await comments.insertOne(
      { userId, postId, texte, createdAt: new Date() },
      { session, writeConcern: { w: "majority" } }
    );

    // Lire tous les commentaires (y compris le nouveau)
    const allComments = await comments
      .find({ postId })
      .sort({ createdAt: 1 })
      .session(session)
      .readPreference("secondaryPreferred")  // Peut lire sur Secondary
      .toArray();

    return allComments;  // Contient le nouveau commentaire
  } finally {
    session.endSession();
  }
}

// === COHÃ‰RENCE Ã‰VENTUELLE (Analytics) ===
async function enregistrerVisite(pageId, userId) {
  // Fire and forget - trÃ¨s rapide
  await analytics.insertOne(
    { pageId, userId, timestamp: new Date() },
    { writeConcern: { w: 1 } }
  );
}

async function getStatistiquesPage(pageId) {
  // Lecture sur Secondary pour dÃ©charger le Primary
  return await analytics
    .aggregate([
      { $match: { pageId } },
      { $group: { _id: null, count: { $sum: 1 } } }
    ])
    .readPreference("secondaryPreferred")
    .readConcern("local")
    .toArray();
}
```

---

## Choisir le bon niveau de cohÃ©rence

### Arbre de dÃ©cision

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Arbre de dÃ©cision : niveau de cohÃ©rence                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   Les donnÃ©es sont-elles critiques ?                                â”‚
â”‚   (argent, inventaire, rÃ©servations)                                â”‚
â”‚            â”‚                                                        â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                                                  â”‚
â”‚      â”‚           â”‚                                                  â”‚
â”‚     OUI         NON                                                 â”‚
â”‚      â”‚           â”‚                                                  â”‚
â”‚      â–¼           â–¼                                                  â”‚
â”‚   COHÃ‰RENCE    L'utilisateur doit-il voir                           â”‚
â”‚   FORTE        ses propres modifications ?                          â”‚
â”‚                        â”‚                                            â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                                      â”‚
â”‚                  â”‚           â”‚                                      â”‚
â”‚                 OUI         NON                                     â”‚
â”‚                  â”‚           â”‚                                      â”‚
â”‚                  â–¼           â–¼                                      â”‚
â”‚             COHÃ‰RENCE     La performance est-elle                   â”‚
â”‚             CAUSALE       critique ?                                â”‚
â”‚             (sessions)           â”‚                                  â”‚
â”‚                            â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                            â”‚
â”‚                            â”‚           â”‚                            â”‚
â”‚                           OUI         NON                           â”‚
â”‚                            â”‚           â”‚                            â”‚
â”‚                            â–¼           â–¼                            â”‚
â”‚                       COHÃ‰RENCE    COHÃ‰RENCE                        â”‚
â”‚                       Ã‰VENTUELLE   MAJORITAIRE                      â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Matrice de dÃ©cision par cas d'usage

| Cas d'usage | Niveau recommandÃ© | Configuration |
|-------------|-------------------|---------------|
| Transactions financiÃ¨res | Forte | `linearizable` + `w: "majority"` |
| Profil utilisateur (Ã©criture) | Causale | Session + `w: "majority"` |
| Profil utilisateur (lecture) | Majoritaire | `readConcern: "majority"` |
| Compteur de likes | Ã‰ventuelle | `w: 1` + `secondary` |
| Logs d'application | Ã‰ventuelle | `w: 1` + `nearest` |
| Chat/Messaging | Causale | Session causale |
| Inventaire e-commerce | Forte | Transaction + `w: "majority"` |
| Cache de session | Ã‰ventuelle | `w: 1` + `local` |
| Configuration systÃ¨me | Forte | `linearizable` |

---

## Bonnes pratiques

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Bonnes pratiques                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   1. NE PAS sur-utiliser la cohÃ©rence forte                         â”‚
â”‚      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                          â”‚
â”‚      â€¢ CoÃ»teuse en performance                                      â”‚
â”‚      â€¢ RÃ©servez-la aux donnÃ©es vraiment critiques                   â”‚
â”‚                                                                     â”‚
â”‚   2. UTILISER les sessions pour "read your own writes"              â”‚
â”‚      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                 â”‚
â”‚      â€¢ causalConsistency: true                                      â”‚
â”‚      â€¢ Permet de lire sur Secondary tout en voyant ses writes       â”‚
â”‚                                                                     â”‚
â”‚   3. DOCUMENTER les choix de cohÃ©rence                              â”‚
â”‚      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                              â”‚
â”‚      â€¢ Expliquer pourquoi tel niveau pour telle collection          â”‚
â”‚      â€¢ Facilite la maintenance                                      â”‚
â”‚                                                                     â”‚
â”‚   4. TESTER avec des latences rÃ©seau                                â”‚
â”‚      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                               â”‚
â”‚      â€¢ Simuler des partitions                                       â”‚
â”‚      â€¢ VÃ©rifier le comportement de l'application                    â”‚
â”‚                                                                     â”‚
â”‚   5. MONITORER la latence de rÃ©plication                            â”‚
â”‚      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                               â”‚
â”‚      â€¢ rs.printSecondaryReplicationInfo()                           â”‚
â”‚      â€¢ Alerter si le lag dÃ©passe un seuil                           â”‚
â”‚                                                                     â”‚
â”‚   6. MIXER les niveaux selon les opÃ©rations                         â”‚
â”‚      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”‚
â”‚      â€¢ Une mÃªme application peut utiliser plusieurs niveaux         â”‚
â”‚      â€¢ Adapter au cas par cas                                       â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Conclusion

La cohÃ©rence dans MongoDB n'est pas un choix binaire. Vous disposez d'un **spectre de niveaux** allant de la cohÃ©rence Ã©ventuelle (haute performance, haute disponibilitÃ©) Ã  la cohÃ©rence forte (garanties maximales, latence plus Ã©levÃ©e).

Le choix du niveau de cohÃ©rence dÃ©pend de :
- La **criticitÃ© des donnÃ©es**
- Les **besoins en performance**
- L'**expÃ©rience utilisateur** attendue
- La **tolÃ©rance aux donnÃ©es obsolÃ¨tes**

MongoDB vous offre la flexibilitÃ© de mixer ces niveaux dans une mÃªme application, permettant d'optimiser chaque opÃ©ration selon ses besoins spÃ©cifiques.

---

## Points clÃ©s Ã  retenir

- **CohÃ©rence forte** : lectures toujours Ã  jour, mais latence Ã©levÃ©e
- **CohÃ©rence Ã©ventuelle** : haute performance, mais donnÃ©es temporairement obsolÃ¨tes
- La **fenÃªtre d'incohÃ©rence** est le dÃ©lai avant convergence
- Le problÃ¨me **"Read Your Own Writes"** peut frustrer les utilisateurs
- Les **sessions causales** rÃ©solvent ce problÃ¨me efficacement
- **Mixer les niveaux** selon les opÃ©rations est une bonne pratique
- **writeConcern** + **readConcern** + **readPreference** = contrÃ´le total
- La cohÃ©rence forte n'est pas toujours nÃ©cessaire ni souhaitable

---


â­ï¸ [Cas d'usage et quand choisir MongoDB](/01-introduction-a-mongodb/05-cas-usage-et-choix.md)
